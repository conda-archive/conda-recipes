diff -urN a/ar/Makefile.in b/ar/Makefile.in
--- a/ar/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/ar/Makefile.in	2013-11-18 23:05:40.325457690 +0000
@@ -0,0 +1,71 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix	= @prefix@
+exec_prefix	= @exec_prefix@
+bindir		= @bindir@
+datarootdir	= @datarootdir@
+mandir		= @mandir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+CFLAGS               = @CFLAGS@
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA	= @INSTALL_DATA@
+transform	= @program_transform_name@
+RANLIBPROG      = $(shell echo ranlib | sed '$(transform)')
+
+MYINCLUDES      = -I$(srcdir) -I$(top_builddir)/include \
+			-I$(top_srcdir)/include -include $(top_builddir)/include/config.h $(FORHDRS)
+MYWARNINGS      =
+MYDEFS          = -DBINDIR="\"$(bindir)\"" -DRANLIBPROG="\"$(RANLIBPROG)\""
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= -lstuff
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)
+
+CFILES = append.c ar.c archive.c contents.c delete.c extract.c misc.c \
+	move.c print.c replace.c
+OBJS = $(CFILES:.c=.o)
+
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default install clean distclean
+
+default: ar
+
+ar: $(OBJS)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+
+install: ar
+	mkdir -p $(DESTDIR)$(bindir)
+	mkdir -p $(DESTDIR)$(mandir)/man1
+	mkdir -p $(DESTDIR)$(mandir)/man5
+	$(INSTALL_PROGRAM) ar \
+		$(DESTDIR)$(bindir)/`echo ar | sed '$(transform)'`
+	$(INSTALL_DATA) $(srcdir)/ar.1 $(DESTDIR)$(mandir)/man1
+	$(INSTALL_DATA) $(srcdir)/ar.5 $(DESTDIR)$(mandir)/man5
+
+
+clean:
+	rm -r -f *.o
+	rm -f ar
diff -urN a/as/arm/Makefile.in b/as/arm/Makefile.in
--- a/as/arm/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/arm/Makefile.in	2013-11-18 23:05:40.333457590 +0000
@@ -0,0 +1,5 @@
+ARCH	=	arm
+
+CFILES_arm	=	arm.c
+MYDEFS_arm	=	-DARM
+MYLIBS_arm	=	-lstuff
diff -urN a/as/i386/Makefile.in b/as/i386/Makefile.in
--- a/as/i386/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/i386/Makefile.in	2013-11-18 23:05:40.333457590 +0000
@@ -0,0 +1,6 @@
+ARCH	=	i386
+
+CFILES_i386	=	i386.c
+MYDEFS_i386	=	-DI386 -Di486 -Di586 -Di686
+MYLIBS_i386	=	-lstuff
+
diff -urN a/as/Makefile.arch.in b/as/Makefile.arch.in
--- a/as/Makefile.arch.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/Makefile.arch.in	2013-11-18 23:05:40.333457590 +0000
@@ -0,0 +1,63 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix	= @prefix@
+exec_prefix	= @exec_prefix@
+libexecdir	= @libexecdir@
+
+VPATH = @srcdir@:@srcdir@/..
+
+CC                   = @CC@
+WARNINGS             = @WARNINGS@
+CFLAGS               = @CFLAGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM	= @INSTALL_PROGRAM@
+ASLIBEXECDIR    = @ASLIBEXECDIR@
+
+MYINCLUDES      = -I$(builddir) -I$(srcdir)/.. -I$(top_builddir)/include \
+			-I$(top_srcdir)/include -include $(top_builddir)/include/config.h $(FORHDRS)
+MYWARNINGS      =
+MYDEFS          = -DNeXT_MOD -DASLIBEXECDIR="\"$(ASLIBEXECDIR)/\"" $(MYDEFS_$(ARCH))
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= $(MYLIBS_$(ARCH))
+
+MYCOMPILEFLAGS  = $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)
+
+CFILES = app.c as.c atof-generic.c atof-ieee.c expr.c fixes.c flonum-const.c \
+         flonum-copy.c flonum-mult.c frags.c hash.c hex-value.c input-file.c \
+         input-scrub.c layout.c messages.c obstack.c read.c sections.c \
+         symbols.c write_object.c xmalloc.c dwarf2dbg.c $(CFILES_$(ARCH))
+
+OBJS = $(CFILES:.c=.o)
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default clean distclean install
+
+default: as
+
+as: $(OBJS)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+
+install: as
+	mkdir -p $(DESTDIR)$(ASLIBEXECDIR)/$(ARCH)
+	$(INSTALL_PROGRAM) as $(DESTDIR)$(ASLIBEXECDIR)/$(ARCH)/as
+
+clean:
+	rm -r -f *.o
+	rm -f as
diff -urN a/as/Makefile.in b/as/Makefile.in
--- a/as/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/Makefile.in	2013-11-18 23:05:40.329457640 +0000
@@ -0,0 +1,78 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix	= @prefix@
+exec_prefix	= @exec_prefix@
+libexecdir	= @libexecdir@
+bindir		= @bindir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+CFLAGS               = @CFLAGS@
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+ASLIBEXECDIR    = @ASLIBEXECDIR@
+transform	= @program_transform_name@
+
+MYINCLUDES      = -I$(srcdir) -I$(top_builddir)/include \
+                  -I$(top_srcdir)/include -include $(top_builddir)/include/config.h \
+                  $(FORHDRS)
+
+MYWARNINGS      =
+MYDEFS          = -DNeXT_MOD -DASLIBEXECDIR="\"$(ASLIBEXECDIR)/\""
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= -lstuff
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)
+
+ASTARGETS = @ASTARGETS@
+
+CFILES = driver.c
+OBJS = $(CFILES:.c=.o)
+
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default install clean distclean $(ASTARGETS)
+
+default: driver $(ASTARGETS)
+
+$(ASTARGETS):
+	cd $@ && $(MAKE)
+
+driver: $(OBJS)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+
+install: driver install-arch
+	mkdir -p $(DESTDIR)$(bindir)
+	$(INSTALL_PROGRAM) driver \
+		$(DESTDIR)$(bindir)/`echo as | sed '$(transform)'`
+
+install-arch:
+	for ast in $(ASTARGETS); do				\
+		(cd $${ast} && $(MAKE) install) || exit 1;	\
+	done
+
+clean:
+	rm -r -f *.o
+	rm -f driver
+	for ast in $(ASTARGETS); do			\
+		(cd $${ast} && $(MAKE) $@) || exit 1;	\
+	done
diff -urN a/as/ppc/Makefile.in b/as/ppc/Makefile.in
--- a/as/ppc/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/ppc/Makefile.in	2013-11-18 23:05:40.329457640 +0000
@@ -0,0 +1,5 @@
+ARCH	=	ppc
+
+CFILES_ppc	=	ppc.c
+MYDEFS_ppc	=	-DPPC
+MYLIBS_ppc	=	-lstuff
diff -urN a/as/ppc64/Makefile.in b/as/ppc64/Makefile.in
--- a/as/ppc64/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/ppc64/Makefile.in	2013-11-18 23:05:40.329457640 +0000
@@ -0,0 +1,5 @@
+ARCH	=	ppc64
+
+CFILES_ppc64	=	ppc.c
+MYDEFS_ppc64	=	-DPPC -DARCH64
+MYLIBS_ppc64	=	-lstuff
diff -urN a/as/x86_64/Makefile.in b/as/x86_64/Makefile.in
--- a/as/x86_64/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/as/x86_64/Makefile.in	2013-11-18 23:05:40.333457590 +0000
@@ -0,0 +1,6 @@
+ARCH	=	x86_64
+
+CFILES_x86_64	=	i386.c
+MYDEFS_x86_64	=	-DI386 -Di486 -Di586 -Di686 -DARCH64
+MYLIBS_x86_64	=	-lstuff
+
diff -urN a/config.guess b/config.guess
--- a/config.guess	1970-01-01 01:00:00.000000000 +0100
+++ b/config.guess	2013-11-18 23:05:40.077460808 +0000
@@ -0,0 +1,1535 @@
+#! /bin/sh
+# Attempt to guess a canonical system name.
+#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012, 2013 Free Software Foundation, Inc.
+
+timestamp='2012-12-30'
+
+# This file is free software; you can redistribute it and/or modify it
+# under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 3 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
+#
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that
+# program.  This Exception is an additional permission under section 7
+# of the GNU General Public License, version 3 ("GPLv3").
+#
+# Originally written by Per Bothner.
+#
+# You can get the latest version of this script from:
+# http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
+#
+# Please send patches with a ChangeLog entry to config-patches@gnu.org.
+
+
+me=`echo "$0" | sed -e 's,.*/,,'`
+
+usage="\
+Usage: $0 [OPTION]
+
+Output the configuration name of the system \`$me' is run on.
+
+Operation modes:
+  -h, --help         print this help, then exit
+  -t, --time-stamp   print date of last modification, then exit
+  -v, --version      print version number, then exit
+
+Report bugs and patches to <config-patches@gnu.org>."
+
+version="\
+GNU config.guess ($timestamp)
+
+Originally written by Per Bothner.
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011,
+2012, 2013 Free Software Foundation, Inc.
+
+This is free software; see the source for copying conditions.  There is NO
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
+
+help="
+Try \`$me --help' for more information."
+
+# Parse command line
+while test $# -gt 0 ; do
+  case $1 in
+    --time-stamp | --time* | -t )
+       echo "$timestamp" ; exit ;;
+    --version | -v )
+       echo "$version" ; exit ;;
+    --help | --h* | -h )
+       echo "$usage"; exit ;;
+    -- )     # Stop option processing
+       shift; break ;;
+    - )	# Use stdin as input.
+       break ;;
+    -* )
+       echo "$me: invalid option $1$help" >&2
+       exit 1 ;;
+    * )
+       break ;;
+  esac
+done
+
+if test $# != 0; then
+  echo "$me: too many arguments$help" >&2
+  exit 1
+fi
+
+trap 'exit 1' 1 2 15
+
+# CC_FOR_BUILD -- compiler used by this script. Note that the use of a
+# compiler to aid in system detection is discouraged as it requires
+# temporary files to be created and, as you can see below, it is a
+# headache to deal with in a portable fashion.
+
+# Historically, `CC_FOR_BUILD' used to be named `HOST_CC'. We still
+# use `HOST_CC' if defined, but it is deprecated.
+
+# Portable tmp directory creation inspired by the Autoconf team.
+
+set_cc_for_build='
+trap "exitcode=\$?; (rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null) && exit \$exitcode" 0 ;
+trap "rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null; exit 1" 1 2 13 15 ;
+: ${TMPDIR=/tmp} ;
+ { tmp=`(umask 077 && mktemp -d "$TMPDIR/cgXXXXXX") 2>/dev/null` && test -n "$tmp" && test -d "$tmp" ; } ||
+ { test -n "$RANDOM" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir $tmp) ; } ||
+ { tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir $tmp) && echo "Warning: creating insecure temp directory" >&2 ; } ||
+ { echo "$me: cannot create a temporary directory in $TMPDIR" >&2 ; exit 1 ; } ;
+dummy=$tmp/dummy ;
+tmpfiles="$dummy.c $dummy.o $dummy.rel $dummy" ;
+case $CC_FOR_BUILD,$HOST_CC,$CC in
+ ,,)    echo "int x;" > $dummy.c ;
+	for c in cc gcc c89 c99 ; do
+	  if ($c -c -o $dummy.o $dummy.c) >/dev/null 2>&1 ; then
+	     CC_FOR_BUILD="$c"; break ;
+	  fi ;
+	done ;
+	if test x"$CC_FOR_BUILD" = x ; then
+	  CC_FOR_BUILD=no_compiler_found ;
+	fi
+	;;
+ ,,*)   CC_FOR_BUILD=$CC ;;
+ ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
+esac ; set_cc_for_build= ;'
+
+# This is needed to find uname on a Pyramid OSx when run in the BSD universe.
+# (ghazi@noc.rutgers.edu 1994-08-24)
+if (test -f /.attbin/uname) >/dev/null 2>&1 ; then
+	PATH=$PATH:/.attbin ; export PATH
+fi
+
+UNAME_MACHINE=`(uname -m) 2>/dev/null` || UNAME_MACHINE=unknown
+UNAME_RELEASE=`(uname -r) 2>/dev/null` || UNAME_RELEASE=unknown
+UNAME_SYSTEM=`(uname -s) 2>/dev/null`  || UNAME_SYSTEM=unknown
+UNAME_VERSION=`(uname -v) 2>/dev/null` || UNAME_VERSION=unknown
+
+# Note: order is significant - the case branches are not exclusive.
+
+case "${UNAME_MACHINE}:${UNAME_SYSTEM}:${UNAME_RELEASE}:${UNAME_VERSION}" in
+    *:NetBSD:*:*)
+	# NetBSD (nbsd) targets should (where applicable) match one or
+	# more of the tuples: *-*-netbsdelf*, *-*-netbsdaout*,
+	# *-*-netbsdecoff* and *-*-netbsd*.  For targets that recently
+	# switched to ELF, *-*-netbsd* would select the old
+	# object file format.  This provides both forward
+	# compatibility and a consistent mechanism for selecting the
+	# object file format.
+	#
+	# Note: NetBSD doesn't particularly care about the vendor
+	# portion of the name.  We always set it to "unknown".
+	sysctl="sysctl -n hw.machine_arch"
+	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
+	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
+	case "${UNAME_MACHINE_ARCH}" in
+	    armeb) machine=armeb-unknown ;;
+	    arm*) machine=arm-unknown ;;
+	    sh3el) machine=shl-unknown ;;
+	    sh3eb) machine=sh-unknown ;;
+	    sh5el) machine=sh5le-unknown ;;
+	    *) machine=${UNAME_MACHINE_ARCH}-unknown ;;
+	esac
+	# The Operating System including object format, if it has switched
+	# to ELF recently, or will in the future.
+	case "${UNAME_MACHINE_ARCH}" in
+	    arm*|i386|m68k|ns32k|sh3*|sparc|vax)
+		eval $set_cc_for_build
+		if echo __ELF__ | $CC_FOR_BUILD -E - 2>/dev/null \
+			| grep -q __ELF__
+		then
+		    # Once all utilities can be ECOFF (netbsdecoff) or a.out (netbsdaout).
+		    # Return netbsd for either.  FIX?
+		    os=netbsd
+		else
+		    os=netbsdelf
+		fi
+		;;
+	    *)
+		os=netbsd
+		;;
+	esac
+	# The OS release
+	# Debian GNU/NetBSD machines have a different userland, and
+	# thus, need a distinct triplet. However, they do not need
+	# kernel version information, so it can be replaced with a
+	# suitable tag, in the style of linux-gnu.
+	case "${UNAME_VERSION}" in
+	    Debian*)
+		release='-gnu'
+		;;
+	    *)
+		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		;;
+	esac
+	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
+	# contains redundant information, the shorter form:
+	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
+	echo "${machine}-${os}${release}"
+	exit ;;
+    *:Bitrig:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/Bitrig.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-bitrig${UNAME_RELEASE}
+	exit ;;
+    *:OpenBSD:*:*)
+	UNAME_MACHINE_ARCH=`arch | sed 's/OpenBSD.//'`
+	echo ${UNAME_MACHINE_ARCH}-unknown-openbsd${UNAME_RELEASE}
+	exit ;;
+    *:ekkoBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
+	exit ;;
+    *:SolidBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-solidbsd${UNAME_RELEASE}
+	exit ;;
+    macppc:MirBSD:*:*)
+	echo powerpc-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
+    *:MirBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
+	exit ;;
+    alpha:OSF1:*:*)
+	case $UNAME_RELEASE in
+	*4.0)
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
+		;;
+	*5.*)
+		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		;;
+	esac
+	# According to Compaq, /usr/sbin/psrinfo has been available on
+	# OSF/1 and Tru64 systems produced since 1995.  I hope that
+	# covers most systems running today.  This code pipes the CPU
+	# types through head -n 1, so we only detect the type of CPU 0.
+	ALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \(.*\) processor.*$/\1/p' | head -n 1`
+	case "$ALPHA_CPU_TYPE" in
+	    "EV4 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV4.5 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "LCA4 (21066/21068)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV5 (21164)")
+		UNAME_MACHINE="alphaev5" ;;
+	    "EV5.6 (21164A)")
+		UNAME_MACHINE="alphaev56" ;;
+	    "EV5.6 (21164PC)")
+		UNAME_MACHINE="alphapca56" ;;
+	    "EV5.7 (21164PC)")
+		UNAME_MACHINE="alphapca57" ;;
+	    "EV6 (21264)")
+		UNAME_MACHINE="alphaev6" ;;
+	    "EV6.7 (21264A)")
+		UNAME_MACHINE="alphaev67" ;;
+	    "EV6.8CB (21264C)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8AL (21264B)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8CX (21264D)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.9A (21264/EV69A)")
+		UNAME_MACHINE="alphaev69" ;;
+	    "EV7 (21364)")
+		UNAME_MACHINE="alphaev7" ;;
+	    "EV7.9 (21364A)")
+		UNAME_MACHINE="alphaev79" ;;
+	esac
+	# A Pn.n version is a patched version.
+	# A Vn.n version is a released version.
+	# A Tn.n version is a released field test version.
+	# A Xn.n version is an unreleased experimental baselevel.
+	# 1.2 uses "1.2" for uname -r.
+	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	# Reset EXIT trap before exiting to avoid spurious non-zero exit code.
+	exitcode=$?
+	trap '' 0
+	exit $exitcode ;;
+    Alpha\ *:Windows_NT*:*)
+	# How do we know it's Interix rather than the generic POSIX subsystem?
+	# Should we change UNAME_MACHINE based on the output of uname instead
+	# of the specific Alpha model?
+	echo alpha-pc-interix
+	exit ;;
+    21064:Windows_NT:50:3)
+	echo alpha-dec-winnt3.5
+	exit ;;
+    Amiga*:UNIX_System_V:4.0:*)
+	echo m68k-unknown-sysv4
+	exit ;;
+    *:[Aa]miga[Oo][Ss]:*:*)
+	echo ${UNAME_MACHINE}-unknown-amigaos
+	exit ;;
+    *:[Mm]orph[Oo][Ss]:*:*)
+	echo ${UNAME_MACHINE}-unknown-morphos
+	exit ;;
+    *:OS/390:*:*)
+	echo i370-ibm-openedition
+	exit ;;
+    *:z/VM:*:*)
+	echo s390-ibm-zvmoe
+	exit ;;
+    *:OS400:*:*)
+	echo powerpc-ibm-os400
+	exit ;;
+    arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
+	echo arm-acorn-riscix${UNAME_RELEASE}
+	exit ;;
+    arm*:riscos:*:*|arm*:RISCOS:*:*)
+	echo arm-unknown-riscos
+	exit ;;
+    SR2?01:HI-UX/MPP:*:* | SR8000:HI-UX/MPP:*:*)
+	echo hppa1.1-hitachi-hiuxmpp
+	exit ;;
+    Pyramid*:OSx*:*:* | MIS*:OSx*:*:* | MIS*:SMP_DC-OSx*:*:*)
+	# akee@wpdis03.wpafb.af.mil (Earle F. Ake) contributed MIS and NILE.
+	if test "`(/bin/universe) 2>/dev/null`" = att ; then
+		echo pyramid-pyramid-sysv3
+	else
+		echo pyramid-pyramid-bsd
+	fi
+	exit ;;
+    NILE*:*:*:dcosx)
+	echo pyramid-pyramid-svr4
+	exit ;;
+    DRS?6000:unix:4.0:6*)
+	echo sparc-icl-nx6
+	exit ;;
+    DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
+	case `/usr/bin/uname -p` in
+	    sparc) echo sparc-icl-nx7; exit ;;
+	esac ;;
+    s390x:SunOS:*:*)
+	echo ${UNAME_MACHINE}-ibm-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    sun4H:SunOS:5.*:*)
+	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    sun4*:SunOS:5.*:* | tadpole*:SunOS:5.*:*)
+	echo sparc-sun-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    i86pc:AuroraUX:5.*:* | i86xen:AuroraUX:5.*:*)
+	echo i386-pc-auroraux${UNAME_RELEASE}
+	exit ;;
+    i86pc:SunOS:5.*:* | i86xen:SunOS:5.*:*)
+	eval $set_cc_for_build
+	SUN_ARCH="i386"
+	# If there is a compiler, see if it is configured for 64-bit objects.
+	# Note that the Sun cc does not turn __LP64__ into 1 like gcc does.
+	# This test works for both compilers.
+	if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+	    if (echo '#ifdef __amd64'; echo IS_64BIT_ARCH; echo '#endif') | \
+		(CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		grep IS_64BIT_ARCH >/dev/null
+	    then
+		SUN_ARCH="x86_64"
+	    fi
+	fi
+	echo ${SUN_ARCH}-pc-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    sun4*:SunOS:6*:*)
+	# According to config.sub, this is the proper way to canonicalize
+	# SunOS6.  Hard to guess exactly what SunOS6 will be like, but
+	# it's likely to be more like Solaris than SunOS4.
+	echo sparc-sun-solaris3`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    sun4*:SunOS:*:*)
+	case "`/usr/bin/arch -k`" in
+	    Series*|S4*)
+		UNAME_RELEASE=`uname -v`
+		;;
+	esac
+	# Japanese Language versions have a version number like `4.1.3-JL'.
+	echo sparc-sun-sunos`echo ${UNAME_RELEASE}|sed -e 's/-/_/'`
+	exit ;;
+    sun3*:SunOS:*:*)
+	echo m68k-sun-sunos${UNAME_RELEASE}
+	exit ;;
+    sun*:*:4.2BSD:*)
+	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`
+	test "x${UNAME_RELEASE}" = "x" && UNAME_RELEASE=3
+	case "`/bin/arch`" in
+	    sun3)
+		echo m68k-sun-sunos${UNAME_RELEASE}
+		;;
+	    sun4)
+		echo sparc-sun-sunos${UNAME_RELEASE}
+		;;
+	esac
+	exit ;;
+    aushp:SunOS:*:*)
+	echo sparc-auspex-sunos${UNAME_RELEASE}
+	exit ;;
+    # The situation for MiNT is a little confusing.  The machine name
+    # can be virtually everything (everything which is not
+    # "atarist" or "atariste" at least should have a processor
+    # > m68000).  The system name ranges from "MiNT" over "FreeMiNT"
+    # to the lowercase version "mint" (or "freemint").  Finally
+    # the system name "TOS" denotes a system which is actually not
+    # MiNT.  But MiNT is downward compatible to TOS, so this should
+    # be no problem.
+    atarist[e]:*MiNT:*:* | atarist[e]:*mint:*:* | atarist[e]:*TOS:*:*)
+	echo m68k-atari-mint${UNAME_RELEASE}
+	exit ;;
+    atari*:*MiNT:*:* | atari*:*mint:*:* | atarist[e]:*TOS:*:*)
+	echo m68k-atari-mint${UNAME_RELEASE}
+	exit ;;
+    *falcon*:*MiNT:*:* | *falcon*:*mint:*:* | *falcon*:*TOS:*:*)
+	echo m68k-atari-mint${UNAME_RELEASE}
+	exit ;;
+    milan*:*MiNT:*:* | milan*:*mint:*:* | *milan*:*TOS:*:*)
+	echo m68k-milan-mint${UNAME_RELEASE}
+	exit ;;
+    hades*:*MiNT:*:* | hades*:*mint:*:* | *hades*:*TOS:*:*)
+	echo m68k-hades-mint${UNAME_RELEASE}
+	exit ;;
+    *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
+	echo m68k-unknown-mint${UNAME_RELEASE}
+	exit ;;
+    m68k:machten:*:*)
+	echo m68k-apple-machten${UNAME_RELEASE}
+	exit ;;
+    powerpc:machten:*:*)
+	echo powerpc-apple-machten${UNAME_RELEASE}
+	exit ;;
+    RISC*:Mach:*:*)
+	echo mips-dec-mach_bsd4.3
+	exit ;;
+    RISC*:ULTRIX:*:*)
+	echo mips-dec-ultrix${UNAME_RELEASE}
+	exit ;;
+    VAX*:ULTRIX*:*:*)
+	echo vax-dec-ultrix${UNAME_RELEASE}
+	exit ;;
+    2020:CLIX:*:* | 2430:CLIX:*:*)
+	echo clipper-intergraph-clix${UNAME_RELEASE}
+	exit ;;
+    mips:*:*:UMIPS | mips:*:*:RISCos)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+#ifdef __cplusplus
+#include <stdio.h>  /* for printf() prototype */
+	int main (int argc, char *argv[]) {
+#else
+	int main (argc, argv) int argc; char *argv[]; {
+#endif
+	#if defined (host_mips) && defined (MIPSEB)
+	#if defined (SYSTYPE_SYSV)
+	  printf ("mips-mips-riscos%ssysv\n", argv[1]); exit (0);
+	#endif
+	#if defined (SYSTYPE_SVR4)
+	  printf ("mips-mips-riscos%ssvr4\n", argv[1]); exit (0);
+	#endif
+	#if defined (SYSTYPE_BSD43) || defined(SYSTYPE_BSD)
+	  printf ("mips-mips-riscos%sbsd\n", argv[1]); exit (0);
+	#endif
+	#endif
+	  exit (-1);
+	}
+EOF
+	$CC_FOR_BUILD -o $dummy $dummy.c &&
+	  dummyarg=`echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` &&
+	  SYSTEM_NAME=`$dummy $dummyarg` &&
+	    { echo "$SYSTEM_NAME"; exit; }
+	echo mips-mips-riscos${UNAME_RELEASE}
+	exit ;;
+    Motorola:PowerMAX_OS:*:*)
+	echo powerpc-motorola-powermax
+	exit ;;
+    Motorola:*:4.3:PL8-*)
+	echo powerpc-harris-powermax
+	exit ;;
+    Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
+	echo powerpc-harris-powermax
+	exit ;;
+    Night_Hawk:Power_UNIX:*:*)
+	echo powerpc-harris-powerunix
+	exit ;;
+    m88k:CX/UX:7*:*)
+	echo m88k-harris-cxux7
+	exit ;;
+    m88k:*:4*:R4*)
+	echo m88k-motorola-sysv4
+	exit ;;
+    m88k:*:3*:R3*)
+	echo m88k-motorola-sysv3
+	exit ;;
+    AViiON:dgux:*:*)
+	# DG/UX returns AViiON for all architectures
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	if [ $UNAME_PROCESSOR = mc88100 ] || [ $UNAME_PROCESSOR = mc88110 ]
+	then
+	    if [ ${TARGET_BINARY_INTERFACE}x = m88kdguxelfx ] || \
+	       [ ${TARGET_BINARY_INTERFACE}x = x ]
+	    then
+		echo m88k-dg-dgux${UNAME_RELEASE}
+	    else
+		echo m88k-dg-dguxbcs${UNAME_RELEASE}
+	    fi
+	else
+	    echo i586-dg-dgux${UNAME_RELEASE}
+	fi
+	exit ;;
+    M88*:DolphinOS:*:*)	# DolphinOS (SVR3)
+	echo m88k-dolphin-sysv3
+	exit ;;
+    M88*:*:R3*:*)
+	# Delta 88k system running SVR3
+	echo m88k-motorola-sysv3
+	exit ;;
+    XD88*:*:*:*) # Tektronix XD88 system running UTekV (SVR3)
+	echo m88k-tektronix-sysv3
+	exit ;;
+    Tek43[0-9][0-9]:UTek:*:*) # Tektronix 4300 system running UTek (BSD)
+	echo m68k-tektronix-bsd
+	exit ;;
+    *:IRIX*:*:*)
+	echo mips-sgi-irix`echo ${UNAME_RELEASE}|sed -e 's/-/_/g'`
+	exit ;;
+    ????????:AIX?:[12].1:2)   # AIX 2.2.1 or AIX 2.1.1 is RT/PC AIX.
+	echo romp-ibm-aix     # uname -m gives an 8 hex-code CPU id
+	exit ;;               # Note that: echo "'`uname -s`'" gives 'AIX '
+    i*86:AIX:*:*)
+	echo i386-ibm-aix
+	exit ;;
+    ia64:AIX:*:*)
+	if [ -x /usr/bin/oslevel ] ; then
+		IBM_REV=`/usr/bin/oslevel`
+	else
+		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
+	fi
+	echo ${UNAME_MACHINE}-ibm-aix${IBM_REV}
+	exit ;;
+    *:AIX:2:3)
+	if grep bos325 /usr/include/stdio.h >/dev/null 2>&1; then
+		eval $set_cc_for_build
+		sed 's/^		//' << EOF >$dummy.c
+		#include <sys/systemcfg.h>
+
+		main()
+			{
+			if (!__power_pc())
+				exit(1);
+			puts("powerpc-ibm-aix3.2.5");
+			exit(0);
+			}
+EOF
+		if $CC_FOR_BUILD -o $dummy $dummy.c && SYSTEM_NAME=`$dummy`
+		then
+			echo "$SYSTEM_NAME"
+		else
+			echo rs6000-ibm-aix3.2.5
+		fi
+	elif grep bos324 /usr/include/stdio.h >/dev/null 2>&1; then
+		echo rs6000-ibm-aix3.2.4
+	else
+		echo rs6000-ibm-aix3.2
+	fi
+	exit ;;
+    *:AIX:*:[4567])
+	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
+	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
+		IBM_ARCH=rs6000
+	else
+		IBM_ARCH=powerpc
+	fi
+	if [ -x /usr/bin/oslevel ] ; then
+		IBM_REV=`/usr/bin/oslevel`
+	else
+		IBM_REV=${UNAME_VERSION}.${UNAME_RELEASE}
+	fi
+	echo ${IBM_ARCH}-ibm-aix${IBM_REV}
+	exit ;;
+    *:AIX:*:*)
+	echo rs6000-ibm-aix
+	exit ;;
+    ibmrt:4.4BSD:*|romp-ibm:BSD:*)
+	echo romp-ibm-bsd4.4
+	exit ;;
+    ibmrt:*BSD:*|romp-ibm:BSD:*)            # covers RT/PC BSD and
+	echo romp-ibm-bsd${UNAME_RELEASE}   # 4.3 with uname added to
+	exit ;;                             # report: romp-ibm BSD 4.3
+    *:BOSX:*:*)
+	echo rs6000-bull-bosx
+	exit ;;
+    DPX/2?00:B.O.S.:*:*)
+	echo m68k-bull-sysv3
+	exit ;;
+    9000/[34]??:4.3bsd:1.*:*)
+	echo m68k-hp-bsd
+	exit ;;
+    hp300:4.4BSD:*:* | 9000/[34]??:4.3bsd:2.*:*)
+	echo m68k-hp-bsd4.4
+	exit ;;
+    9000/[34678]??:HP-UX:*:*)
+	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
+	case "${UNAME_MACHINE}" in
+	    9000/31? )            HP_ARCH=m68000 ;;
+	    9000/[34]?? )         HP_ARCH=m68k ;;
+	    9000/[678][0-9][0-9])
+		if [ -x /usr/bin/getconf ]; then
+		    sc_cpu_version=`/usr/bin/getconf SC_CPU_VERSION 2>/dev/null`
+		    sc_kernel_bits=`/usr/bin/getconf SC_KERNEL_BITS 2>/dev/null`
+		    case "${sc_cpu_version}" in
+		      523) HP_ARCH="hppa1.0" ;; # CPU_PA_RISC1_0
+		      528) HP_ARCH="hppa1.1" ;; # CPU_PA_RISC1_1
+		      532)                      # CPU_PA_RISC2_0
+			case "${sc_kernel_bits}" in
+			  32) HP_ARCH="hppa2.0n" ;;
+			  64) HP_ARCH="hppa2.0w" ;;
+			  '') HP_ARCH="hppa2.0" ;;   # HP-UX 10.20
+			esac ;;
+		    esac
+		fi
+		if [ "${HP_ARCH}" = "" ]; then
+		    eval $set_cc_for_build
+		    sed 's/^		//' << EOF >$dummy.c
+
+		#define _HPUX_SOURCE
+		#include <stdlib.h>
+		#include <unistd.h>
+
+		int main ()
+		{
+		#if defined(_SC_KERNEL_BITS)
+		    long bits = sysconf(_SC_KERNEL_BITS);
+		#endif
+		    long cpu  = sysconf (_SC_CPU_VERSION);
+
+		    switch (cpu)
+			{
+			case CPU_PA_RISC1_0: puts ("hppa1.0"); break;
+			case CPU_PA_RISC1_1: puts ("hppa1.1"); break;
+			case CPU_PA_RISC2_0:
+		#if defined(_SC_KERNEL_BITS)
+			    switch (bits)
+				{
+				case 64: puts ("hppa2.0w"); break;
+				case 32: puts ("hppa2.0n"); break;
+				default: puts ("hppa2.0"); break;
+				} break;
+		#else  /* !defined(_SC_KERNEL_BITS) */
+			    puts ("hppa2.0"); break;
+		#endif
+			default: puts ("hppa1.0"); break;
+			}
+		    exit (0);
+		}
+EOF
+		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
+		    test -z "$HP_ARCH" && HP_ARCH=hppa
+		fi ;;
+	esac
+	if [ ${HP_ARCH} = "hppa2.0w" ]
+	then
+	    eval $set_cc_for_build
+
+	    # hppa2.0w-hp-hpux* has a 64-bit kernel and a compiler generating
+	    # 32-bit code.  hppa64-hp-hpux* has the same kernel and a compiler
+	    # generating 64-bit code.  GNU and HP use different nomenclature:
+	    #
+	    # $ CC_FOR_BUILD=cc ./config.guess
+	    # => hppa2.0w-hp-hpux11.23
+	    # $ CC_FOR_BUILD="cc +DA2.0w" ./config.guess
+	    # => hppa64-hp-hpux11.23
+
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) |
+		grep -q __LP64__
+	    then
+		HP_ARCH="hppa2.0w"
+	    else
+		HP_ARCH="hppa64"
+	    fi
+	fi
+	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
+	exit ;;
+    ia64:HP-UX:*:*)
+	HPUX_REV=`echo ${UNAME_RELEASE}|sed -e 's/[^.]*.[0B]*//'`
+	echo ia64-hp-hpux${HPUX_REV}
+	exit ;;
+    3050*:HI-UX:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#include <unistd.h>
+	int
+	main ()
+	{
+	  long cpu = sysconf (_SC_CPU_VERSION);
+	  /* The order matters, because CPU_IS_HP_MC68K erroneously returns
+	     true for CPU_PA_RISC1_0.  CPU_IS_PA_RISC returns correct
+	     results, however.  */
+	  if (CPU_IS_PA_RISC (cpu))
+	    {
+	      switch (cpu)
+		{
+		  case CPU_PA_RISC1_0: puts ("hppa1.0-hitachi-hiuxwe2"); break;
+		  case CPU_PA_RISC1_1: puts ("hppa1.1-hitachi-hiuxwe2"); break;
+		  case CPU_PA_RISC2_0: puts ("hppa2.0-hitachi-hiuxwe2"); break;
+		  default: puts ("hppa-hitachi-hiuxwe2"); break;
+		}
+	    }
+	  else if (CPU_IS_HP_MC68K (cpu))
+	    puts ("m68k-hitachi-hiuxwe2");
+	  else puts ("unknown-hitachi-hiuxwe2");
+	  exit (0);
+	}
+EOF
+	$CC_FOR_BUILD -o $dummy $dummy.c && SYSTEM_NAME=`$dummy` &&
+		{ echo "$SYSTEM_NAME"; exit; }
+	echo unknown-hitachi-hiuxwe2
+	exit ;;
+    9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
+	echo hppa1.1-hp-bsd
+	exit ;;
+    9000/8??:4.3bsd:*:*)
+	echo hppa1.0-hp-bsd
+	exit ;;
+    *9??*:MPE/iX:*:* | *3000*:MPE/iX:*:*)
+	echo hppa1.0-hp-mpeix
+	exit ;;
+    hp7??:OSF1:*:* | hp8?[79]:OSF1:*:* )
+	echo hppa1.1-hp-osf
+	exit ;;
+    hp8??:OSF1:*:*)
+	echo hppa1.0-hp-osf
+	exit ;;
+    i*86:OSF1:*:*)
+	if [ -x /usr/sbin/sysversion ] ; then
+	    echo ${UNAME_MACHINE}-unknown-osf1mk
+	else
+	    echo ${UNAME_MACHINE}-unknown-osf1
+	fi
+	exit ;;
+    parisc*:Lites*:*:*)
+	echo hppa1.1-hp-lites
+	exit ;;
+    C1*:ConvexOS:*:* | convex:ConvexOS:C1*:*)
+	echo c1-convex-bsd
+	exit ;;
+    C2*:ConvexOS:*:* | convex:ConvexOS:C2*:*)
+	if getsysinfo -f scalar_acc
+	then echo c32-convex-bsd
+	else echo c2-convex-bsd
+	fi
+	exit ;;
+    C34*:ConvexOS:*:* | convex:ConvexOS:C34*:*)
+	echo c34-convex-bsd
+	exit ;;
+    C38*:ConvexOS:*:* | convex:ConvexOS:C38*:*)
+	echo c38-convex-bsd
+	exit ;;
+    C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
+	echo c4-convex-bsd
+	exit ;;
+    CRAY*Y-MP:*:*:*)
+	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
+    CRAY*[A-Z]90:*:*:*)
+	echo ${UNAME_MACHINE}-cray-unicos${UNAME_RELEASE} \
+	| sed -e 's/CRAY.*\([A-Z]90\)/\1/' \
+	      -e y/ABCDEFGHIJKLMNOPQRSTUVWXYZ/abcdefghijklmnopqrstuvwxyz/ \
+	      -e 's/\.[^.]*$/.X/'
+	exit ;;
+    CRAY*TS:*:*:*)
+	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
+    CRAY*T3E:*:*:*)
+	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
+    CRAY*SV1:*:*:*)
+	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
+    *:UNICOS/mp:*:*)
+	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit ;;
+    F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
+	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
+	echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
+    5000:UNIX_System_V:4.*:*)
+	FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+	FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+	echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit ;;
+    i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
+	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
+	exit ;;
+    sparc*:BSD/OS:*:*)
+	echo sparc-unknown-bsdi${UNAME_RELEASE}
+	exit ;;
+    *:BSD/OS:*:*)
+	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
+	exit ;;
+    *:FreeBSD:*:*)
+	UNAME_PROCESSOR=`/usr/bin/uname -p`
+	case ${UNAME_PROCESSOR} in
+	    amd64)
+		echo x86_64-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	    *)
+		echo ${UNAME_PROCESSOR}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'` ;;
+	esac
+	exit ;;
+    i*:CYGWIN*:*)
+	echo ${UNAME_MACHINE}-pc-cygwin
+	exit ;;
+    *:MINGW64*:*)
+	echo ${UNAME_MACHINE}-pc-mingw64
+	exit ;;
+    *:MINGW*:*)
+	echo ${UNAME_MACHINE}-pc-mingw32
+	exit ;;
+    *:MSYS*:*)
+	echo ${UNAME_MACHINE}-pc-msys
+	exit ;;
+    i*:windows32*:*)
+	# uname -m includes "-pc" on this system.
+	echo ${UNAME_MACHINE}-mingw32
+	exit ;;
+    i*:PW*:*)
+	echo ${UNAME_MACHINE}-pc-pw32
+	exit ;;
+    *:Interix*:*)
+	case ${UNAME_MACHINE} in
+	    x86)
+		echo i586-pc-interix${UNAME_RELEASE}
+		exit ;;
+	    authenticamd | genuineintel | EM64T)
+		echo x86_64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	    IA64)
+		echo ia64-unknown-interix${UNAME_RELEASE}
+		exit ;;
+	esac ;;
+    [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
+	echo i${UNAME_MACHINE}-pc-mks
+	exit ;;
+    8664:Windows_NT:*)
+	echo x86_64-pc-mks
+	exit ;;
+    i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
+	# How do we know it's Interix rather than the generic POSIX subsystem?
+	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
+	# UNAME_MACHINE based on the output of uname instead of i386?
+	echo i586-pc-interix
+	exit ;;
+    i*:UWIN*:*)
+	echo ${UNAME_MACHINE}-pc-uwin
+	exit ;;
+    amd64:CYGWIN*:*:* | x86_64:CYGWIN*:*:*)
+	echo x86_64-unknown-cygwin
+	exit ;;
+    p*:CYGWIN*:*)
+	echo powerpcle-unknown-cygwin
+	exit ;;
+    prep*:SunOS:5.*:*)
+	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
+	exit ;;
+    *:GNU:*:*)
+	# the GNU system
+	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
+	exit ;;
+    *:GNU/*:*:*)
+	# other systems with GNU libc and userland
+	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	exit ;;
+    i*86:Minix:*:*)
+	echo ${UNAME_MACHINE}-pc-minix
+	exit ;;
+    aarch64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    aarch64_be:Linux:*:*)
+	UNAME_MACHINE=aarch64_be
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    alpha:Linux:*:*)
+	case `sed -n '/^cpu model/s/^.*: \(.*\)/\1/p' < /proc/cpuinfo` in
+	  EV5)   UNAME_MACHINE=alphaev5 ;;
+	  EV56)  UNAME_MACHINE=alphaev56 ;;
+	  PCA56) UNAME_MACHINE=alphapca56 ;;
+	  PCA57) UNAME_MACHINE=alphapca56 ;;
+	  EV6)   UNAME_MACHINE=alphaev6 ;;
+	  EV67)  UNAME_MACHINE=alphaev67 ;;
+	  EV68*) UNAME_MACHINE=alphaev68 ;;
+	esac
+	objdump --private-headers /bin/sh | grep -q ld.so.1
+	if test "$?" = 0 ; then LIBC="libc1" ; else LIBC="" ; fi
+	echo ${UNAME_MACHINE}-unknown-linux-gnu${LIBC}
+	exit ;;
+    arm*:Linux:*:*)
+	eval $set_cc_for_build
+	if echo __ARM_EABI__ | $CC_FOR_BUILD -E - 2>/dev/null \
+	    | grep -q __ARM_EABI__
+	then
+	    echo ${UNAME_MACHINE}-unknown-linux-gnu
+	else
+	    if echo __ARM_PCS_VFP | $CC_FOR_BUILD -E - 2>/dev/null \
+		| grep -q __ARM_PCS_VFP
+	    then
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabi
+	    else
+		echo ${UNAME_MACHINE}-unknown-linux-gnueabihf
+	    fi
+	fi
+	exit ;;
+    avr32*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    cris:Linux:*:*)
+	echo ${UNAME_MACHINE}-axis-linux-gnu
+	exit ;;
+    crisv32:Linux:*:*)
+	echo ${UNAME_MACHINE}-axis-linux-gnu
+	exit ;;
+    frv:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    hexagon:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    i*86:Linux:*:*)
+	LIBC=gnu
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^LIBC'`
+	echo "${UNAME_MACHINE}-pc-linux-${LIBC}"
+	exit ;;
+    ia64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    m32r*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    m68*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    mips:Linux:*:* | mips64:Linux:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#undef CPU
+	#undef ${UNAME_MACHINE}
+	#undef ${UNAME_MACHINE}el
+	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
+	CPU=${UNAME_MACHINE}el
+	#else
+	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
+	CPU=${UNAME_MACHINE}
+	#else
+	CPU=
+	#endif
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep '^CPU'`
+	test x"${CPU}" != x && { echo "${CPU}-unknown-linux-gnu"; exit; }
+	;;
+    or32:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    padre:Linux:*:*)
+	echo sparc-unknown-linux-gnu
+	exit ;;
+    parisc64:Linux:*:* | hppa64:Linux:*:*)
+	echo hppa64-unknown-linux-gnu
+	exit ;;
+    parisc:Linux:*:* | hppa:Linux:*:*)
+	# Look for CPU level
+	case `grep '^cpu[^a-z]*:' /proc/cpuinfo 2>/dev/null | cut -d' ' -f2` in
+	  PA7*) echo hppa1.1-unknown-linux-gnu ;;
+	  PA8*) echo hppa2.0-unknown-linux-gnu ;;
+	  *)    echo hppa-unknown-linux-gnu ;;
+	esac
+	exit ;;
+    ppc64:Linux:*:*)
+	echo powerpc64-unknown-linux-gnu
+	exit ;;
+    ppc:Linux:*:*)
+	echo powerpc-unknown-linux-gnu
+	exit ;;
+    s390:Linux:*:* | s390x:Linux:*:*)
+	echo ${UNAME_MACHINE}-ibm-linux
+	exit ;;
+    sh64*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    sh*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    sparc:Linux:*:* | sparc64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    tile*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    vax:Linux:*:*)
+	echo ${UNAME_MACHINE}-dec-linux-gnu
+	exit ;;
+    x86_64:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    xtensa*:Linux:*:*)
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit ;;
+    i*86:DYNIX/ptx:4*:*)
+	# ptx 4.0 does uname -s correctly, with DYNIX/ptx in there.
+	# earlier versions are messed up and put the nodename in both
+	# sysname and nodename.
+	echo i386-sequent-sysv4
+	exit ;;
+    i*86:UNIX_SV:4.2MP:2.*)
+	# Unixware is an offshoot of SVR4, but it has its own version
+	# number series starting with 2...
+	# I am not positive that other SVR4 systems won't match this,
+	# I just have to hope.  -- rms.
+	# Use sysv4.2uw... so that sysv4* matches it.
+	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
+	exit ;;
+    i*86:OS/2:*:*)
+	# If we were able to find `uname', then EMX Unix compatibility
+	# is probably installed.
+	echo ${UNAME_MACHINE}-pc-os2-emx
+	exit ;;
+    i*86:XTS-300:*:STOP)
+	echo ${UNAME_MACHINE}-unknown-stop
+	exit ;;
+    i*86:atheos:*:*)
+	echo ${UNAME_MACHINE}-unknown-atheos
+	exit ;;
+    i*86:syllable:*:*)
+	echo ${UNAME_MACHINE}-pc-syllable
+	exit ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.[02]*:*)
+	echo i386-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    i*86:*DOS:*:*)
+	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	exit ;;
+    i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
+	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
+	if grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then
+		echo ${UNAME_MACHINE}-univel-sysv${UNAME_REL}
+	else
+		echo ${UNAME_MACHINE}-pc-sysv${UNAME_REL}
+	fi
+	exit ;;
+    i*86:*:5:[678]*)
+	# UnixWare 7.x, OpenUNIX and OpenServer 6.
+	case `/bin/uname -X | grep "^Machine"` in
+	    *486*)	     UNAME_MACHINE=i486 ;;
+	    *Pentium)	     UNAME_MACHINE=i586 ;;
+	    *Pent*|*Celeron) UNAME_MACHINE=i686 ;;
+	esac
+	echo ${UNAME_MACHINE}-unknown-sysv${UNAME_RELEASE}${UNAME_SYSTEM}${UNAME_VERSION}
+	exit ;;
+    i*86:*:3.2:*)
+	if test -f /usr/options/cb.name; then
+		UNAME_REL=`sed -n 's/.*Version //p' </usr/options/cb.name`
+		echo ${UNAME_MACHINE}-pc-isc$UNAME_REL
+	elif /bin/uname -X 2>/dev/null >/dev/null ; then
+		UNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`
+		(/bin/uname -X|grep i80486 >/dev/null) && UNAME_MACHINE=i486
+		(/bin/uname -X|grep '^Machine.*Pentium' >/dev/null) \
+			&& UNAME_MACHINE=i586
+		(/bin/uname -X|grep '^Machine.*Pent *II' >/dev/null) \
+			&& UNAME_MACHINE=i686
+		(/bin/uname -X|grep '^Machine.*Pentium Pro' >/dev/null) \
+			&& UNAME_MACHINE=i686
+		echo ${UNAME_MACHINE}-pc-sco$UNAME_REL
+	else
+		echo ${UNAME_MACHINE}-pc-sysv32
+	fi
+	exit ;;
+    pc:*:*:*)
+	# Left here for compatibility:
+	# uname -m prints for DJGPP always 'pc', but it prints nothing about
+	# the processor, so we play safe by assuming i586.
+	# Note: whatever this is, it MUST be the same as what config.sub
+	# prints for the "djgpp" host, or else GDB configury will decide that
+	# this is a cross-build.
+	echo i586-pc-msdosdjgpp
+	exit ;;
+    Intel:Mach:3*:*)
+	echo i386-pc-mach3
+	exit ;;
+    paragon:*:*:*)
+	echo i860-intel-osf1
+	exit ;;
+    i860:*:4.*:*) # i860-SVR4
+	if grep Stardent /usr/include/sys/uadmin.h >/dev/null 2>&1 ; then
+	  echo i860-stardent-sysv${UNAME_RELEASE} # Stardent Vistra i860-SVR4
+	else # Add other i860-SVR4 vendors below as they are discovered.
+	  echo i860-unknown-sysv${UNAME_RELEASE}  # Unknown i860-SVR4
+	fi
+	exit ;;
+    mini*:CTIX:SYS*5:*)
+	# "miniframe"
+	echo m68010-convergent-sysv
+	exit ;;
+    mc68k:UNIX:SYSTEM5:3.51m)
+	echo m68k-convergent-sysv
+	exit ;;
+    M680?0:D-NIX:5.3:*)
+	echo m68k-diab-dnix
+	exit ;;
+    M68*:*:R3V[5678]*:*)
+	test -r /sysV68 && { echo 'm68k-motorola-sysv'; exit; } ;;
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
+	OS_REL=''
+	test -r /etc/.relid \
+	&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
+	  && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
+    3[34]??:*:4.0:* | 3[34]??,*:*:4.0:*)
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	  && { echo i486-ncr-sysv4; exit; } ;;
+    NCR*:*:4.2:* | MPRAS*:*:4.2:*)
+	OS_REL='.3'
+	test -r /etc/.relid \
+	    && OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
+	/bin/uname -p 2>/dev/null | grep 86 >/dev/null \
+	    && { echo i486-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2>/dev/null | /bin/grep entium >/dev/null \
+	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; }
+	/bin/uname -p 2>/dev/null | /bin/grep pteron >/dev/null \
+	    && { echo i586-ncr-sysv4.3${OS_REL}; exit; } ;;
+    m68*:LynxOS:2.*:* | m68*:LynxOS:3.0*:*)
+	echo m68k-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    mc68030:UNIX_System_V:4.*:*)
+	echo m68k-atari-sysv4
+	exit ;;
+    TSUNAMI:LynxOS:2.*:*)
+	echo sparc-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    rs6000:LynxOS:2.*:*)
+	echo rs6000-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    PowerPC:LynxOS:2.*:* | PowerPC:LynxOS:3.[01]*:* | PowerPC:LynxOS:4.[02]*:*)
+	echo powerpc-unknown-lynxos${UNAME_RELEASE}
+	exit ;;
+    SM[BE]S:UNIX_SV:*:*)
+	echo mips-dde-sysv${UNAME_RELEASE}
+	exit ;;
+    RM*:ReliantUNIX-*:*:*)
+	echo mips-sni-sysv4
+	exit ;;
+    RM*:SINIX-*:*:*)
+	echo mips-sni-sysv4
+	exit ;;
+    *:SINIX-*:*:*)
+	if uname -p 2>/dev/null >/dev/null ; then
+		UNAME_MACHINE=`(uname -p) 2>/dev/null`
+		echo ${UNAME_MACHINE}-sni-sysv4
+	else
+		echo ns32k-sni-sysv
+	fi
+	exit ;;
+    PENTIUM:*:4.0*:*)	# Unisys `ClearPath HMP IX 4000' SVR4/MP effort
+			# says <Richard.M.Bartel@ccMail.Census.GOV>
+	echo i586-unisys-sysv4
+	exit ;;
+    *:UNIX_System_V:4*:FTX*)
+	# From Gerald Hewes <hewes@openmarket.com>.
+	# How about differentiating between stratus architectures? -djm
+	echo hppa1.1-stratus-sysv4
+	exit ;;
+    *:*:*:FTX*)
+	# From seanf@swdc.stratus.com.
+	echo i860-stratus-sysv4
+	exit ;;
+    i*86:VOS:*:*)
+	# From Paul.Green@stratus.com.
+	echo ${UNAME_MACHINE}-stratus-vos
+	exit ;;
+    *:VOS:*:*)
+	# From Paul.Green@stratus.com.
+	echo hppa1.1-stratus-vos
+	exit ;;
+    mc68*:A/UX:*:*)
+	echo m68k-apple-aux${UNAME_RELEASE}
+	exit ;;
+    news*:NEWS-OS:6*:*)
+	echo mips-sony-newsos6
+	exit ;;
+    R[34]000:*System_V*:*:* | R4000:UNIX_SYSV:*:* | R*000:UNIX_SV:*:*)
+	if [ -d /usr/nec ]; then
+		echo mips-nec-sysv${UNAME_RELEASE}
+	else
+		echo mips-unknown-sysv${UNAME_RELEASE}
+	fi
+	exit ;;
+    BeBox:BeOS:*:*)	# BeOS running on hardware made by Be, PPC only.
+	echo powerpc-be-beos
+	exit ;;
+    BeMac:BeOS:*:*)	# BeOS running on Mac or Mac clone, PPC only.
+	echo powerpc-apple-beos
+	exit ;;
+    BePC:BeOS:*:*)	# BeOS running on Intel PC compatible.
+	echo i586-pc-beos
+	exit ;;
+    BePC:Haiku:*:*)	# Haiku running on Intel PC compatible.
+	echo i586-pc-haiku
+	exit ;;
+    x86_64:Haiku:*:*)
+	echo x86_64-unknown-haiku
+	exit ;;
+    SX-4:SUPER-UX:*:*)
+	echo sx4-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-5:SUPER-UX:*:*)
+	echo sx5-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-6:SUPER-UX:*:*)
+	echo sx6-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-7:SUPER-UX:*:*)
+	echo sx7-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8:SUPER-UX:*:*)
+	echo sx8-nec-superux${UNAME_RELEASE}
+	exit ;;
+    SX-8R:SUPER-UX:*:*)
+	echo sx8r-nec-superux${UNAME_RELEASE}
+	exit ;;
+    Power*:Rhapsody:*:*)
+	echo powerpc-apple-rhapsody${UNAME_RELEASE}
+	exit ;;
+    *:Rhapsody:*:*)
+	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
+	exit ;;
+    *:Darwin:*:*)
+	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
+	case $UNAME_PROCESSOR in
+	    i386)
+		eval $set_cc_for_build
+		if [ "$CC_FOR_BUILD" != 'no_compiler_found' ]; then
+		  if (echo '#ifdef __LP64__'; echo IS_64BIT_ARCH; echo '#endif') | \
+		      (CCOPTS= $CC_FOR_BUILD -E - 2>/dev/null) | \
+		      grep IS_64BIT_ARCH >/dev/null
+		  then
+		      UNAME_PROCESSOR="x86_64"
+		  fi
+		fi ;;
+	    unknown) UNAME_PROCESSOR=powerpc ;;
+	esac
+	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
+	exit ;;
+    *:procnto*:*:* | *:QNX:[0123456789]*:*)
+	UNAME_PROCESSOR=`uname -p`
+	if test "$UNAME_PROCESSOR" = "x86"; then
+		UNAME_PROCESSOR=i386
+		UNAME_MACHINE=pc
+	fi
+	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
+	exit ;;
+    *:QNX:*:4*)
+	echo i386-pc-qnx
+	exit ;;
+    NEO-?:NONSTOP_KERNEL:*:*)
+	echo neo-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSE-*:NONSTOP_KERNEL:*:*)
+	echo nse-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    NSR-?:NONSTOP_KERNEL:*:*)
+	echo nsr-tandem-nsk${UNAME_RELEASE}
+	exit ;;
+    *:NonStop-UX:*:*)
+	echo mips-compaq-nonstopux
+	exit ;;
+    BS2000:POSIX*:*:*)
+	echo bs2000-siemens-sysv
+	exit ;;
+    DS/*:UNIX_System_V:*:*)
+	echo ${UNAME_MACHINE}-${UNAME_SYSTEM}-${UNAME_RELEASE}
+	exit ;;
+    *:Plan9:*:*)
+	# "uname -m" is not consistent, so use $cputype instead. 386
+	# is converted to i386 for consistency with other x86
+	# operating systems.
+	if test "$cputype" = "386"; then
+	    UNAME_MACHINE=i386
+	else
+	    UNAME_MACHINE="$cputype"
+	fi
+	echo ${UNAME_MACHINE}-unknown-plan9
+	exit ;;
+    *:TOPS-10:*:*)
+	echo pdp10-unknown-tops10
+	exit ;;
+    *:TENEX:*:*)
+	echo pdp10-unknown-tenex
+	exit ;;
+    KS10:TOPS-20:*:* | KL10:TOPS-20:*:* | TYPE4:TOPS-20:*:*)
+	echo pdp10-dec-tops20
+	exit ;;
+    XKL-1:TOPS-20:*:* | TYPE5:TOPS-20:*:*)
+	echo pdp10-xkl-tops20
+	exit ;;
+    *:TOPS-20:*:*)
+	echo pdp10-unknown-tops20
+	exit ;;
+    *:ITS:*:*)
+	echo pdp10-unknown-its
+	exit ;;
+    SEI:*:*:SEIUX)
+	echo mips-sei-seiux${UNAME_RELEASE}
+	exit ;;
+    *:DragonFly:*:*)
+	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	exit ;;
+    *:*VMS:*:*)
+	UNAME_MACHINE=`(uname -p) 2>/dev/null`
+	case "${UNAME_MACHINE}" in
+	    A*) echo alpha-dec-vms ; exit ;;
+	    I*) echo ia64-dec-vms ; exit ;;
+	    V*) echo vax-dec-vms ; exit ;;
+	esac ;;
+    *:XENIX:*:SysV)
+	echo i386-pc-xenix
+	exit ;;
+    i*86:skyos:*:*)
+	echo ${UNAME_MACHINE}-pc-skyos`echo ${UNAME_RELEASE}` | sed -e 's/ .*$//'
+	exit ;;
+    i*86:rdos:*:*)
+	echo ${UNAME_MACHINE}-pc-rdos
+	exit ;;
+    i*86:AROS:*:*)
+	echo ${UNAME_MACHINE}-pc-aros
+	exit ;;
+    x86_64:VMkernel:*:*)
+	echo ${UNAME_MACHINE}-unknown-esx
+	exit ;;
+esac
+
+eval $set_cc_for_build
+cat >$dummy.c <<EOF
+#ifdef _SEQUENT_
+# include <sys/types.h>
+# include <sys/utsname.h>
+#endif
+main ()
+{
+#if defined (sony)
+#if defined (MIPSEB)
+  /* BFD wants "bsd" instead of "newsos".  Perhaps BFD should be changed,
+     I don't know....  */
+  printf ("mips-sony-bsd\n"); exit (0);
+#else
+#include <sys/param.h>
+  printf ("m68k-sony-newsos%s\n",
+#ifdef NEWSOS4
+	"4"
+#else
+	""
+#endif
+	); exit (0);
+#endif
+#endif
+
+#if defined (__arm) && defined (__acorn) && defined (__unix)
+  printf ("arm-acorn-riscix\n"); exit (0);
+#endif
+
+#if defined (hp300) && !defined (hpux)
+  printf ("m68k-hp-bsd\n"); exit (0);
+#endif
+
+#if defined (NeXT)
+#if !defined (__ARCHITECTURE__)
+#define __ARCHITECTURE__ "m68k"
+#endif
+  int version;
+  version=`(hostinfo | sed -n 's/.*NeXT Mach \([0-9]*\).*/\1/p') 2>/dev/null`;
+  if (version < 4)
+    printf ("%s-next-nextstep%d\n", __ARCHITECTURE__, version);
+  else
+    printf ("%s-next-openstep%d\n", __ARCHITECTURE__, version);
+  exit (0);
+#endif
+
+#if defined (MULTIMAX) || defined (n16)
+#if defined (UMAXV)
+  printf ("ns32k-encore-sysv\n"); exit (0);
+#else
+#if defined (CMU)
+  printf ("ns32k-encore-mach\n"); exit (0);
+#else
+  printf ("ns32k-encore-bsd\n"); exit (0);
+#endif
+#endif
+#endif
+
+#if defined (__386BSD__)
+  printf ("i386-pc-bsd\n"); exit (0);
+#endif
+
+#if defined (sequent)
+#if defined (i386)
+  printf ("i386-sequent-dynix\n"); exit (0);
+#endif
+#if defined (ns32000)
+  printf ("ns32k-sequent-dynix\n"); exit (0);
+#endif
+#endif
+
+#if defined (_SEQUENT_)
+    struct utsname un;
+
+    uname(&un);
+
+    if (strncmp(un.version, "V2", 2) == 0) {
+	printf ("i386-sequent-ptx2\n"); exit (0);
+    }
+    if (strncmp(un.version, "V1", 2) == 0) { /* XXX is V1 correct? */
+	printf ("i386-sequent-ptx1\n"); exit (0);
+    }
+    printf ("i386-sequent-ptx\n"); exit (0);
+
+#endif
+
+#if defined (vax)
+# if !defined (ultrix)
+#  include <sys/param.h>
+#  if defined (BSD)
+#   if BSD == 43
+      printf ("vax-dec-bsd4.3\n"); exit (0);
+#   else
+#    if BSD == 199006
+      printf ("vax-dec-bsd4.3reno\n"); exit (0);
+#    else
+      printf ("vax-dec-bsd\n"); exit (0);
+#    endif
+#   endif
+#  else
+    printf ("vax-dec-bsd\n"); exit (0);
+#  endif
+# else
+    printf ("vax-dec-ultrix\n"); exit (0);
+# endif
+#endif
+
+#if defined (alliant) && defined (i860)
+  printf ("i860-alliant-bsd\n"); exit (0);
+#endif
+
+  exit (1);
+}
+EOF
+
+$CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && SYSTEM_NAME=`$dummy` &&
+	{ echo "$SYSTEM_NAME"; exit; }
+
+# Apollos put the system type in the environment.
+
+test -d /usr/apollo && { echo ${ISP}-apollo-${SYSTYPE}; exit; }
+
+# Convex versions that predate uname can use getsysinfo(1)
+
+if [ -x /usr/convex/getsysinfo ]
+then
+    case `getsysinfo -f cpu_type` in
+    c1*)
+	echo c1-convex-bsd
+	exit ;;
+    c2*)
+	if getsysinfo -f scalar_acc
+	then echo c32-convex-bsd
+	else echo c2-convex-bsd
+	fi
+	exit ;;
+    c34*)
+	echo c34-convex-bsd
+	exit ;;
+    c38*)
+	echo c38-convex-bsd
+	exit ;;
+    c4*)
+	echo c4-convex-bsd
+	exit ;;
+    esac
+fi
+
+cat >&2 <<EOF
+$0: unable to guess system type
+
+This script, last modified $timestamp, has failed to recognize
+the operating system you are using. It is advised that you
+download the most up to date version of the config scripts from
+
+  http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.guess;hb=HEAD
+and
+  http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
+
+If the version you run ($0) is already up to date, please
+send the following data and any information you think might be
+pertinent to <config-patches@gnu.org> in order to provide the needed
+information to handle your system.
+
+config.guess timestamp = $timestamp
+
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null`
+
+hostinfo               = `(hostinfo) 2>/dev/null`
+/bin/universe          = `(/bin/universe) 2>/dev/null`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null`
+/bin/arch              = `(/bin/arch) 2>/dev/null`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null`
+
+UNAME_MACHINE = ${UNAME_MACHINE}
+UNAME_RELEASE = ${UNAME_RELEASE}
+UNAME_SYSTEM  = ${UNAME_SYSTEM}
+UNAME_VERSION = ${UNAME_VERSION}
+EOF
+
+exit 1
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "timestamp='"
+# time-stamp-format: "%:y-%02m-%02d"
+# time-stamp-end: "'"
+# End:
diff -urN a/config.sub b/config.sub
--- a/config.sub	1970-01-01 01:00:00.000000000 +0100
+++ b/config.sub	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,1787 @@
+#! /bin/sh
+# Configuration validation subroutine script.
+#   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
+#   2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010,
+#   2011, 2012, 2013 Free Software Foundation, Inc.
+
+timestamp='2013-01-04'
+
+# This file is free software; you can redistribute it and/or modify it
+# under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 3 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful, but
+# WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, see <http://www.gnu.org/licenses/>.
+#
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that
+# program.  This Exception is an additional permission under section 7
+# of the GNU General Public License, version 3 ("GPLv3").
+
+
+# Please send patches with a ChangeLog entry to config-patches@gnu.org.
+#
+# Configuration subroutine to validate and canonicalize a configuration type.
+# Supply the specified configuration type as an argument.
+# If it is invalid, we print an error message on stderr and exit with code 1.
+# Otherwise, we print the canonical config type on stdout and succeed.
+
+# You can get the latest version of this script from:
+# http://git.savannah.gnu.org/gitweb/?p=config.git;a=blob_plain;f=config.sub;hb=HEAD
+
+# This file is supposed to be the same for all GNU packages
+# and recognize all the CPU types, system types and aliases
+# that are meaningful with *any* GNU software.
+# Each package is responsible for reporting which valid configurations
+# it does not support.  The user should be able to distinguish
+# a failure to support a valid configuration from a meaningless
+# configuration.
+
+# The goal of this file is to map all the various variations of a given
+# machine specification into a single specification in the form:
+#	CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM
+# or in some cases, the newer four-part form:
+#	CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM
+# It is wrong to echo any other type of specification.
+
+me=`echo "$0" | sed -e 's,.*/,,'`
+
+usage="\
+Usage: $0 [OPTION] CPU-MFR-OPSYS
+       $0 [OPTION] ALIAS
+
+Canonicalize a configuration name.
+
+Operation modes:
+  -h, --help         print this help, then exit
+  -t, --time-stamp   print date of last modification, then exit
+  -v, --version      print version number, then exit
+
+Report bugs and patches to <config-patches@gnu.org>."
+
+version="\
+GNU config.sub ($timestamp)
+
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000,
+2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011,
+2012, 2013 Free Software Foundation, Inc.
+
+This is free software; see the source for copying conditions.  There is NO
+warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."
+
+help="
+Try \`$me --help' for more information."
+
+# Parse command line
+while test $# -gt 0 ; do
+  case $1 in
+    --time-stamp | --time* | -t )
+       echo "$timestamp" ; exit ;;
+    --version | -v )
+       echo "$version" ; exit ;;
+    --help | --h* | -h )
+       echo "$usage"; exit ;;
+    -- )     # Stop option processing
+       shift; break ;;
+    - )	# Use stdin as input.
+       break ;;
+    -* )
+       echo "$me: invalid option $1$help"
+       exit 1 ;;
+
+    *local*)
+       # First pass through any local machine types.
+       echo $1
+       exit ;;
+
+    * )
+       break ;;
+  esac
+done
+
+case $# in
+ 0) echo "$me: missing argument$help" >&2
+    exit 1;;
+ 1) ;;
+ *) echo "$me: too many arguments$help" >&2
+    exit 1;;
+esac
+
+# Separate what the user gave into CPU-COMPANY and OS or KERNEL-OS (if any).
+# Here we must recognize all the valid KERNEL-OS combinations.
+maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
+case $maybe_os in
+  nto-qnx* | linux-gnu* | linux-android* | linux-dietlibc | linux-newlib* | \
+  linux-musl* | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | kfreebsd*-gnu* | \
+  knetbsd*-gnu* | netbsd*-gnu* | \
+  kopensolaris*-gnu* | \
+  storm-chaos* | os2-emx* | rtmk-nova*)
+    os=-$maybe_os
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
+    ;;
+  android-linux)
+    os=-linux-android
+    basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`-unknown
+    ;;
+  *)
+    basic_machine=`echo $1 | sed 's/-[^-]*$//'`
+    if [ $basic_machine != $1 ]
+    then os=`echo $1 | sed 's/.*-/-/'`
+    else os=; fi
+    ;;
+esac
+
+### Let's recognize common machines as not being operating systems so
+### that things like config.sub decstation-3100 work.  We also
+### recognize some manufacturers as not being operating systems, so we
+### can provide default operating systems below.
+case $os in
+	-sun*os*)
+		# Prevent following clause from handling this invalid input.
+		;;
+	-dec* | -mips* | -sequent* | -encore* | -pc532* | -sgi* | -sony* | \
+	-att* | -7300* | -3300* | -delta* | -motorola* | -sun[234]* | \
+	-unicom* | -ibm* | -next | -hp | -isi* | -apollo | -altos* | \
+	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
+	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
+	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
+	-apple | -axis | -knuth | -cray | -microblaze*)
+		os=
+		basic_machine=$1
+		;;
+	-bluegene*)
+		os=-cnk
+		;;
+	-sim | -cisco | -oki | -wec | -winbond)
+		os=
+		basic_machine=$1
+		;;
+	-scout)
+		;;
+	-wrs)
+		os=-vxworks
+		basic_machine=$1
+		;;
+	-chorusos*)
+		os=-chorusos
+		basic_machine=$1
+		;;
+	-chorusrdb)
+		os=-chorusrdb
+		basic_machine=$1
+		;;
+	-hiux*)
+		os=-hiuxwe2
+		;;
+	-sco6)
+		os=-sco5v6
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco5)
+		os=-sco3.2v5
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco4)
+		os=-sco3.2v4
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco3.2.[4-9]*)
+		os=`echo $os | sed -e 's/sco3.2./sco3.2v/'`
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco3.2v[4-9]*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco5v6*)
+		# Don't forget version if it is 3.2v4 or newer.
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-sco*)
+		os=-sco3.2v2
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-udk*)
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-isc)
+		os=-isc2.2
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-clix*)
+		basic_machine=clipper-intergraph
+		;;
+	-isc*)
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-pc/'`
+		;;
+	-lynx*178)
+		os=-lynxos178
+		;;
+	-lynx*5)
+		os=-lynxos5
+		;;
+	-lynx*)
+		os=-lynxos
+		;;
+	-ptx*)
+		basic_machine=`echo $1 | sed -e 's/86-.*/86-sequent/'`
+		;;
+	-windowsnt*)
+		os=`echo $os | sed -e 's/windowsnt/winnt/'`
+		;;
+	-psos*)
+		os=-psos
+		;;
+	-mint | -mint[0-9]*)
+		basic_machine=m68k-atari
+		os=-mint
+		;;
+esac
+
+# Decode aliases for certain CPU-COMPANY combinations.
+case $basic_machine in
+	# Recognize the basic CPU types without company name.
+	# Some are omitted here because they have special meanings below.
+	1750a | 580 \
+	| a29k \
+	| aarch64 | aarch64_be \
+	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
+	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
+	| am33_2.0 \
+	| arc \
+	| arm | arm[bl]e | arme[lb] | armv[2-8] | armv[3-8][lb] | armv7[arm] \
+	| avr | avr32 \
+	| be32 | be64 \
+	| bfin \
+	| c4x | clipper \
+	| d10v | d30v | dlx | dsp16xx \
+	| epiphany \
+	| fido | fr30 | frv \
+	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
+	| hexagon \
+	| i370 | i860 | i960 | ia64 \
+	| ip2k | iq2000 \
+	| le32 | le64 \
+	| lm32 \
+	| m32c | m32r | m32rle | m68000 | m68k | m88k \
+	| maxq | mb | microblaze | microblazeel | mcore | mep | metag \
+	| mips | mipsbe | mipseb | mipsel | mipsle \
+	| mips16 \
+	| mips64 | mips64el \
+	| mips64octeon | mips64octeonel \
+	| mips64orion | mips64orionel \
+	| mips64r5900 | mips64r5900el \
+	| mips64vr | mips64vrel \
+	| mips64vr4100 | mips64vr4100el \
+	| mips64vr4300 | mips64vr4300el \
+	| mips64vr5000 | mips64vr5000el \
+	| mips64vr5900 | mips64vr5900el \
+	| mipsisa32 | mipsisa32el \
+	| mipsisa32r2 | mipsisa32r2el \
+	| mipsisa64 | mipsisa64el \
+	| mipsisa64r2 | mipsisa64r2el \
+	| mipsisa64sb1 | mipsisa64sb1el \
+	| mipsisa64sr71k | mipsisa64sr71kel \
+	| mipstx39 | mipstx39el \
+	| mn10200 | mn10300 \
+	| moxie \
+	| mt \
+	| msp430 \
+	| nds32 | nds32le | nds32be \
+	| nios | nios2 \
+	| ns16k | ns32k \
+	| open8 \
+	| or32 \
+	| pdp10 | pdp11 | pj | pjl \
+	| powerpc | powerpc64 | powerpc64le | powerpcle \
+	| pyramid \
+	| rl78 | rx \
+	| score \
+	| sh | sh[1234] | sh[24]a | sh[24]aeb | sh[23]e | sh[34]eb | sheb | shbe | shle | sh[1234]le | sh3ele \
+	| sh64 | sh64le \
+	| sparc | sparc64 | sparc64b | sparc64v | sparc86x | sparclet | sparclite \
+	| sparcv8 | sparcv9 | sparcv9b | sparcv9v \
+	| spu \
+	| tahoe | tic4x | tic54x | tic55x | tic6x | tic80 | tron \
+	| ubicom32 \
+	| v850 | v850e | v850e1 | v850e2 | v850es | v850e2v3 \
+	| we32k \
+	| x86 | xc16x | xstormy16 | xtensa \
+	| z8k | z80)
+		basic_machine=$basic_machine-unknown
+		;;
+	c54x)
+		basic_machine=tic54x-unknown
+		;;
+	c55x)
+		basic_machine=tic55x-unknown
+		;;
+	c6x)
+		basic_machine=tic6x-unknown
+		;;
+	m6811 | m68hc11 | m6812 | m68hc12 | m68hcs12x | picochip)
+		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	m88110 | m680[12346]0 | m683?2 | m68360 | m5200 | v70 | w65 | z8k)
+		;;
+	ms1)
+		basic_machine=mt-unknown
+		;;
+
+	strongarm | thumb | xscale)
+		basic_machine=arm-unknown
+		;;
+	xgate)
+		basic_machine=$basic_machine-unknown
+		os=-none
+		;;
+	xscaleeb)
+		basic_machine=armeb-unknown
+		;;
+
+	xscaleel)
+		basic_machine=armel-unknown
+		;;
+
+	# We use `pc' rather than `unknown'
+	# because (1) that's what they normally are, and
+	# (2) the word "unknown" tends to confuse beginning users.
+	i*86 | x86_64)
+	  basic_machine=$basic_machine-pc
+	  ;;
+	# Object if more than one company name word.
+	*-*-*)
+		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
+		exit 1
+		;;
+	# Recognize the basic CPU types with company name.
+	580-* \
+	| a29k-* \
+	| aarch64-* | aarch64_be-* \
+	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
+	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
+	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
+	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
+	| avr-* | avr32-* \
+	| be32-* | be64-* \
+	| bfin-* | bs2000-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* \
+	| clipper-* | craynv-* | cydra-* \
+	| d10v-* | d30v-* | dlx-* \
+	| elxsi-* \
+	| f30[01]-* | f700-* | fido-* | fr30-* | frv-* | fx80-* \
+	| h8300-* | h8500-* \
+	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
+	| hexagon-* \
+	| i*86-* | i860-* | i960-* | ia64-* \
+	| ip2k-* | iq2000-* \
+	| le32-* | le64-* \
+	| lm32-* \
+	| m32c-* | m32r-* | m32rle-* \
+	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
+	| m88110-* | m88k-* | maxq-* | mcore-* | metag-* \
+	| microblaze-* | microblazeel-* \
+	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
+	| mips16-* \
+	| mips64-* | mips64el-* \
+	| mips64octeon-* | mips64octeonel-* \
+	| mips64orion-* | mips64orionel-* \
+	| mips64r5900-* | mips64r5900el-* \
+	| mips64vr-* | mips64vrel-* \
+	| mips64vr4100-* | mips64vr4100el-* \
+	| mips64vr4300-* | mips64vr4300el-* \
+	| mips64vr5000-* | mips64vr5000el-* \
+	| mips64vr5900-* | mips64vr5900el-* \
+	| mipsisa32-* | mipsisa32el-* \
+	| mipsisa32r2-* | mipsisa32r2el-* \
+	| mipsisa64-* | mipsisa64el-* \
+	| mipsisa64r2-* | mipsisa64r2el-* \
+	| mipsisa64sb1-* | mipsisa64sb1el-* \
+	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipstx39-* | mipstx39el-* \
+	| mmix-* \
+	| mt-* \
+	| msp430-* \
+	| nds32-* | nds32le-* | nds32be-* \
+	| nios-* | nios2-* \
+	| none-* | np1-* | ns16k-* | ns32k-* \
+	| open8-* \
+	| orion-* \
+	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
+	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* \
+	| pyramid-* \
+	| rl78-* | romp-* | rs6000-* | rx-* \
+	| sh-* | sh[1234]-* | sh[24]a-* | sh[24]aeb-* | sh[23]e-* | sh[34]eb-* | sheb-* | shbe-* \
+	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
+	| sparc-* | sparc64-* | sparc64b-* | sparc64v-* | sparc86x-* | sparclet-* \
+	| sparclite-* \
+	| sparcv8-* | sparcv9-* | sparcv9b-* | sparcv9v-* | sv1-* | sx?-* \
+	| tahoe-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tile*-* \
+	| tron-* \
+	| ubicom32-* \
+	| v850-* | v850e-* | v850e1-* | v850es-* | v850e2-* | v850e2v3-* \
+	| vax-* \
+	| we32k-* \
+	| x86-* | x86_64-* | xc16x-* | xps100-* \
+	| xstormy16-* | xtensa*-* \
+	| ymp-* \
+	| z8k-* | z80-*)
+		;;
+	# Recognize the basic CPU types without company name, with glob match.
+	xtensa*)
+		basic_machine=$basic_machine-unknown
+		;;
+	# Recognize the various machine names and aliases which stand
+	# for a CPU type and a company and sometimes even an OS.
+	386bsd)
+		basic_machine=i386-unknown
+		os=-bsd
+		;;
+	3b1 | 7300 | 7300-att | att-7300 | pc7300 | safari | unixpc)
+		basic_machine=m68000-att
+		;;
+	3b*)
+		basic_machine=we32k-att
+		;;
+	a29khif)
+		basic_machine=a29k-amd
+		os=-udi
+		;;
+	abacus)
+		basic_machine=abacus-unknown
+		;;
+	adobe68k)
+		basic_machine=m68010-adobe
+		os=-scout
+		;;
+	alliant | fx80)
+		basic_machine=fx80-alliant
+		;;
+	altos | altos3068)
+		basic_machine=m68k-altos
+		;;
+	am29k)
+		basic_machine=a29k-none
+		os=-bsd
+		;;
+	amd64)
+		basic_machine=x86_64-pc
+		;;
+	amd64-*)
+		basic_machine=x86_64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	amdahl)
+		basic_machine=580-amdahl
+		os=-sysv
+		;;
+	amiga | amiga-*)
+		basic_machine=m68k-unknown
+		;;
+	amigaos | amigados)
+		basic_machine=m68k-unknown
+		os=-amigaos
+		;;
+	amigaunix | amix)
+		basic_machine=m68k-unknown
+		os=-sysv4
+		;;
+	apollo68)
+		basic_machine=m68k-apollo
+		os=-sysv
+		;;
+	apollo68bsd)
+		basic_machine=m68k-apollo
+		os=-bsd
+		;;
+	aros)
+		basic_machine=i386-pc
+		os=-aros
+		;;
+	aux)
+		basic_machine=m68k-apple
+		os=-aux
+		;;
+	balance)
+		basic_machine=ns32k-sequent
+		os=-dynix
+		;;
+	blackfin)
+		basic_machine=bfin-unknown
+		os=-linux
+		;;
+	blackfin-*)
+		basic_machine=bfin-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	bluegene*)
+		basic_machine=powerpc-ibm
+		os=-cnk
+		;;
+	c54x-*)
+		basic_machine=tic54x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c55x-*)
+		basic_machine=tic55x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c6x-*)
+		basic_machine=tic6x-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	c90)
+		basic_machine=c90-cray
+		os=-unicos
+		;;
+	cegcc)
+		basic_machine=arm-unknown
+		os=-cegcc
+		;;
+	convex-c1)
+		basic_machine=c1-convex
+		os=-bsd
+		;;
+	convex-c2)
+		basic_machine=c2-convex
+		os=-bsd
+		;;
+	convex-c32)
+		basic_machine=c32-convex
+		os=-bsd
+		;;
+	convex-c34)
+		basic_machine=c34-convex
+		os=-bsd
+		;;
+	convex-c38)
+		basic_machine=c38-convex
+		os=-bsd
+		;;
+	cray | j90)
+		basic_machine=j90-cray
+		os=-unicos
+		;;
+	craynv)
+		basic_machine=craynv-cray
+		os=-unicosmp
+		;;
+	cr16 | cr16-*)
+		basic_machine=cr16-unknown
+		os=-elf
+		;;
+	crds | unos)
+		basic_machine=m68k-crds
+		;;
+	crisv32 | crisv32-* | etraxfs*)
+		basic_machine=crisv32-axis
+		;;
+	cris | cris-* | etrax*)
+		basic_machine=cris-axis
+		;;
+	crx)
+		basic_machine=crx-unknown
+		os=-elf
+		;;
+	da30 | da30-*)
+		basic_machine=m68k-da30
+		;;
+	decstation | decstation-3100 | pmax | pmax-* | pmin | dec3100 | decstatn)
+		basic_machine=mips-dec
+		;;
+	decsystem10* | dec10*)
+		basic_machine=pdp10-dec
+		os=-tops10
+		;;
+	decsystem20* | dec20*)
+		basic_machine=pdp10-dec
+		os=-tops20
+		;;
+	delta | 3300 | motorola-3300 | motorola-delta \
+	      | 3300-motorola | delta-motorola)
+		basic_machine=m68k-motorola
+		;;
+	delta88)
+		basic_machine=m88k-motorola
+		os=-sysv3
+		;;
+	dicos)
+		basic_machine=i686-pc
+		os=-dicos
+		;;
+	djgpp)
+		basic_machine=i586-pc
+		os=-msdosdjgpp
+		;;
+	dpx20 | dpx20-*)
+		basic_machine=rs6000-bull
+		os=-bosx
+		;;
+	dpx2* | dpx2*-bull)
+		basic_machine=m68k-bull
+		os=-sysv3
+		;;
+	ebmon29k)
+		basic_machine=a29k-amd
+		os=-ebmon
+		;;
+	elxsi)
+		basic_machine=elxsi-elxsi
+		os=-bsd
+		;;
+	encore | umax | mmax)
+		basic_machine=ns32k-encore
+		;;
+	es1800 | OSE68k | ose68k | ose | OSE)
+		basic_machine=m68k-ericsson
+		os=-ose
+		;;
+	fx2800)
+		basic_machine=i860-alliant
+		;;
+	genix)
+		basic_machine=ns32k-ns
+		;;
+	gmicro)
+		basic_machine=tron-gmicro
+		os=-sysv
+		;;
+	go32)
+		basic_machine=i386-pc
+		os=-go32
+		;;
+	h3050r* | hiux*)
+		basic_machine=hppa1.1-hitachi
+		os=-hiuxwe2
+		;;
+	h8300hms)
+		basic_machine=h8300-hitachi
+		os=-hms
+		;;
+	h8300xray)
+		basic_machine=h8300-hitachi
+		os=-xray
+		;;
+	h8500hms)
+		basic_machine=h8500-hitachi
+		os=-hms
+		;;
+	harris)
+		basic_machine=m88k-harris
+		os=-sysv3
+		;;
+	hp300-*)
+		basic_machine=m68k-hp
+		;;
+	hp300bsd)
+		basic_machine=m68k-hp
+		os=-bsd
+		;;
+	hp300hpux)
+		basic_machine=m68k-hp
+		os=-hpux
+		;;
+	hp3k9[0-9][0-9] | hp9[0-9][0-9])
+		basic_machine=hppa1.0-hp
+		;;
+	hp9k2[0-9][0-9] | hp9k31[0-9])
+		basic_machine=m68000-hp
+		;;
+	hp9k3[2-9][0-9])
+		basic_machine=m68k-hp
+		;;
+	hp9k6[0-9][0-9] | hp6[0-9][0-9])
+		basic_machine=hppa1.0-hp
+		;;
+	hp9k7[0-79][0-9] | hp7[0-79][0-9])
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k78[0-9] | hp78[0-9])
+		# FIXME: really hppa2.0-hp
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k8[67]1 | hp8[67]1 | hp9k80[24] | hp80[24] | hp9k8[78]9 | hp8[78]9 | hp9k893 | hp893)
+		# FIXME: really hppa2.0-hp
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k8[0-9][13679] | hp8[0-9][13679])
+		basic_machine=hppa1.1-hp
+		;;
+	hp9k8[0-9][0-9] | hp8[0-9][0-9])
+		basic_machine=hppa1.0-hp
+		;;
+	hppa-next)
+		os=-nextstep3
+		;;
+	hppaosf)
+		basic_machine=hppa1.1-hp
+		os=-osf
+		;;
+	hppro)
+		basic_machine=hppa1.1-hp
+		os=-proelf
+		;;
+	i370-ibm* | ibm*)
+		basic_machine=i370-ibm
+		;;
+	i*86v32)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
+		os=-sysv32
+		;;
+	i*86v4*)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
+		os=-sysv4
+		;;
+	i*86v)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
+		os=-sysv
+		;;
+	i*86sol2)
+		basic_machine=`echo $1 | sed -e 's/86.*/86-pc/'`
+		os=-solaris2
+		;;
+	i386mach)
+		basic_machine=i386-mach
+		os=-mach
+		;;
+	i386-vsta | vsta)
+		basic_machine=i386-unknown
+		os=-vsta
+		;;
+	iris | iris4d)
+		basic_machine=mips-sgi
+		case $os in
+		    -irix*)
+			;;
+		    *)
+			os=-irix4
+			;;
+		esac
+		;;
+	isi68 | isi)
+		basic_machine=m68k-isi
+		os=-sysv
+		;;
+	m68knommu)
+		basic_machine=m68k-unknown
+		os=-linux
+		;;
+	m68knommu-*)
+		basic_machine=m68k-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	m88k-omron*)
+		basic_machine=m88k-omron
+		;;
+	magnum | m3230)
+		basic_machine=mips-mips
+		os=-sysv
+		;;
+	merlin)
+		basic_machine=ns32k-utek
+		os=-sysv
+		;;
+	microblaze*)
+		basic_machine=microblaze-xilinx
+		;;
+	mingw64)
+		basic_machine=x86_64-pc
+		os=-mingw64
+		;;
+	mingw32)
+		basic_machine=i386-pc
+		os=-mingw32
+		;;
+	mingw32ce)
+		basic_machine=arm-unknown
+		os=-mingw32ce
+		;;
+	miniframe)
+		basic_machine=m68000-convergent
+		;;
+	*mint | -mint[0-9]* | *MiNT | *MiNT[0-9]*)
+		basic_machine=m68k-atari
+		os=-mint
+		;;
+	mips3*-*)
+		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`
+		;;
+	mips3*)
+		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
+		;;
+	monitor)
+		basic_machine=m68k-rom68k
+		os=-coff
+		;;
+	morphos)
+		basic_machine=powerpc-unknown
+		os=-morphos
+		;;
+	msdos)
+		basic_machine=i386-pc
+		os=-msdos
+		;;
+	ms1-*)
+		basic_machine=`echo $basic_machine | sed -e 's/ms1-/mt-/'`
+		;;
+	msys)
+		basic_machine=i386-pc
+		os=-msys
+		;;
+	mvs)
+		basic_machine=i370-ibm
+		os=-mvs
+		;;
+	nacl)
+		basic_machine=le32-unknown
+		os=-nacl
+		;;
+	ncr3000)
+		basic_machine=i486-ncr
+		os=-sysv4
+		;;
+	netbsd386)
+		basic_machine=i386-unknown
+		os=-netbsd
+		;;
+	netwinder)
+		basic_machine=armv4l-rebel
+		os=-linux
+		;;
+	news | news700 | news800 | news900)
+		basic_machine=m68k-sony
+		os=-newsos
+		;;
+	news1000)
+		basic_machine=m68030-sony
+		os=-newsos
+		;;
+	news-3600 | risc-news)
+		basic_machine=mips-sony
+		os=-newsos
+		;;
+	necv70)
+		basic_machine=v70-nec
+		os=-sysv
+		;;
+	next | m*-next )
+		basic_machine=m68k-next
+		case $os in
+		    -nextstep* )
+			;;
+		    -ns2*)
+		      os=-nextstep2
+			;;
+		    *)
+		      os=-nextstep3
+			;;
+		esac
+		;;
+	nh3000)
+		basic_machine=m68k-harris
+		os=-cxux
+		;;
+	nh[45]000)
+		basic_machine=m88k-harris
+		os=-cxux
+		;;
+	nindy960)
+		basic_machine=i960-intel
+		os=-nindy
+		;;
+	mon960)
+		basic_machine=i960-intel
+		os=-mon960
+		;;
+	nonstopux)
+		basic_machine=mips-compaq
+		os=-nonstopux
+		;;
+	np1)
+		basic_machine=np1-gould
+		;;
+	neo-tandem)
+		basic_machine=neo-tandem
+		;;
+	nse-tandem)
+		basic_machine=nse-tandem
+		;;
+	nsr-tandem)
+		basic_machine=nsr-tandem
+		;;
+	op50n-* | op60c-*)
+		basic_machine=hppa1.1-oki
+		os=-proelf
+		;;
+	openrisc | openrisc-*)
+		basic_machine=or32-unknown
+		;;
+	os400)
+		basic_machine=powerpc-ibm
+		os=-os400
+		;;
+	OSE68000 | ose68000)
+		basic_machine=m68000-ericsson
+		os=-ose
+		;;
+	os68k)
+		basic_machine=m68k-none
+		os=-os68k
+		;;
+	pa-hitachi)
+		basic_machine=hppa1.1-hitachi
+		os=-hiuxwe2
+		;;
+	paragon)
+		basic_machine=i860-intel
+		os=-osf
+		;;
+	parisc)
+		basic_machine=hppa-unknown
+		os=-linux
+		;;
+	parisc-*)
+		basic_machine=hppa-`echo $basic_machine | sed 's/^[^-]*-//'`
+		os=-linux
+		;;
+	pbd)
+		basic_machine=sparc-tti
+		;;
+	pbb)
+		basic_machine=m68k-tti
+		;;
+	pc532 | pc532-*)
+		basic_machine=ns32k-pc532
+		;;
+	pc98)
+		basic_machine=i386-pc
+		;;
+	pc98-*)
+		basic_machine=i386-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pentium | p5 | k5 | k6 | nexgen | viac3)
+		basic_machine=i586-pc
+		;;
+	pentiumpro | p6 | 6x86 | athlon | athlon_*)
+		basic_machine=i686-pc
+		;;
+	pentiumii | pentium2 | pentiumiii | pentium3)
+		basic_machine=i686-pc
+		;;
+	pentium4)
+		basic_machine=i786-pc
+		;;
+	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
+		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pentiumpro-* | p6-* | 6x86-* | athlon-*)
+		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pentiumii-* | pentium2-* | pentiumiii-* | pentium3-*)
+		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pentium4-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	pn)
+		basic_machine=pn-gould
+		;;
+	power)	basic_machine=power-ibm
+		;;
+	ppc | ppcbe)	basic_machine=powerpc-unknown
+		;;
+	ppc-* | ppcbe-*)
+		basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	ppcle | powerpclittle | ppc-le | powerpc-little)
+		basic_machine=powerpcle-unknown
+		;;
+	ppcle-* | powerpclittle-*)
+		basic_machine=powerpcle-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	ppc64)	basic_machine=powerpc64-unknown
+		;;
+	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
+		basic_machine=powerpc64le-unknown
+		;;
+	ppc64le-* | powerpc64little-*)
+		basic_machine=powerpc64le-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	ps2)
+		basic_machine=i386-ibm
+		;;
+	pw32)
+		basic_machine=i586-unknown
+		os=-pw32
+		;;
+	rdos | rdos64)
+		basic_machine=x86_64-pc
+		os=-rdos
+		;;
+	rdos32)
+		basic_machine=i386-pc
+		os=-rdos
+		;;
+	rom68k)
+		basic_machine=m68k-rom68k
+		os=-coff
+		;;
+	rm[46]00)
+		basic_machine=mips-siemens
+		;;
+	rtpc | rtpc-*)
+		basic_machine=romp-ibm
+		;;
+	s390 | s390-*)
+		basic_machine=s390-ibm
+		;;
+	s390x | s390x-*)
+		basic_machine=s390x-ibm
+		;;
+	sa29200)
+		basic_machine=a29k-amd
+		os=-udi
+		;;
+	sb1)
+		basic_machine=mipsisa64sb1-unknown
+		;;
+	sb1el)
+		basic_machine=mipsisa64sb1el-unknown
+		;;
+	sde)
+		basic_machine=mipsisa32-sde
+		os=-elf
+		;;
+	sei)
+		basic_machine=mips-sei
+		os=-seiux
+		;;
+	sequent)
+		basic_machine=i386-sequent
+		;;
+	sh)
+		basic_machine=sh-hitachi
+		os=-hms
+		;;
+	sh5el)
+		basic_machine=sh5le-unknown
+		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
+	sparclite-wrs | simso-wrs)
+		basic_machine=sparclite-wrs
+		os=-vxworks
+		;;
+	sps7)
+		basic_machine=m68k-bull
+		os=-sysv2
+		;;
+	spur)
+		basic_machine=spur-unknown
+		;;
+	st2000)
+		basic_machine=m68k-tandem
+		;;
+	stratus)
+		basic_machine=i860-stratus
+		os=-sysv4
+		;;
+	strongarm-* | thumb-*)
+		basic_machine=arm-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
+	sun2)
+		basic_machine=m68000-sun
+		;;
+	sun2os3)
+		basic_machine=m68000-sun
+		os=-sunos3
+		;;
+	sun2os4)
+		basic_machine=m68000-sun
+		os=-sunos4
+		;;
+	sun3os3)
+		basic_machine=m68k-sun
+		os=-sunos3
+		;;
+	sun3os4)
+		basic_machine=m68k-sun
+		os=-sunos4
+		;;
+	sun4os3)
+		basic_machine=sparc-sun
+		os=-sunos3
+		;;
+	sun4os4)
+		basic_machine=sparc-sun
+		os=-sunos4
+		;;
+	sun4sol2)
+		basic_machine=sparc-sun
+		os=-solaris2
+		;;
+	sun3 | sun3-*)
+		basic_machine=m68k-sun
+		;;
+	sun4)
+		basic_machine=sparc-sun
+		;;
+	sun386 | sun386i | roadrunner)
+		basic_machine=i386-sun
+		;;
+	sv1)
+		basic_machine=sv1-cray
+		os=-unicos
+		;;
+	symmetry)
+		basic_machine=i386-sequent
+		os=-dynix
+		;;
+	t3e)
+		basic_machine=alphaev5-cray
+		os=-unicos
+		;;
+	t90)
+		basic_machine=t90-cray
+		os=-unicos
+		;;
+	tile*)
+		basic_machine=$basic_machine-unknown
+		os=-linux-gnu
+		;;
+	tx39)
+		basic_machine=mipstx39-unknown
+		;;
+	tx39el)
+		basic_machine=mipstx39el-unknown
+		;;
+	toad1)
+		basic_machine=pdp10-xkl
+		os=-tops20
+		;;
+	tower | tower-32)
+		basic_machine=m68k-ncr
+		;;
+	tpf)
+		basic_machine=s390x-ibm
+		os=-tpf
+		;;
+	udi29k)
+		basic_machine=a29k-amd
+		os=-udi
+		;;
+	ultra3)
+		basic_machine=a29k-nyu
+		os=-sym1
+		;;
+	v810 | necv810)
+		basic_machine=v810-nec
+		os=-none
+		;;
+	vaxv)
+		basic_machine=vax-dec
+		os=-sysv
+		;;
+	vms)
+		basic_machine=vax-dec
+		os=-vms
+		;;
+	vpp*|vx|vx-*)
+		basic_machine=f301-fujitsu
+		;;
+	vxworks960)
+		basic_machine=i960-wrs
+		os=-vxworks
+		;;
+	vxworks68)
+		basic_machine=m68k-wrs
+		os=-vxworks
+		;;
+	vxworks29k)
+		basic_machine=a29k-wrs
+		os=-vxworks
+		;;
+	w65*)
+		basic_machine=w65-wdc
+		os=-none
+		;;
+	w89k-*)
+		basic_machine=hppa1.1-winbond
+		os=-proelf
+		;;
+	xbox)
+		basic_machine=i686-pc
+		os=-mingw32
+		;;
+	xps | xps100)
+		basic_machine=xps100-honeywell
+		;;
+	xscale-* | xscalee[bl]-*)
+		basic_machine=`echo $basic_machine | sed 's/^xscale/arm/'`
+		;;
+	ymp)
+		basic_machine=ymp-cray
+		os=-unicos
+		;;
+	z8k-*-coff)
+		basic_machine=z8k-unknown
+		os=-sim
+		;;
+	z80-*-coff)
+		basic_machine=z80-unknown
+		os=-sim
+		;;
+	none)
+		basic_machine=none-none
+		os=-none
+		;;
+
+# Here we handle the default manufacturer of certain CPU types.  It is in
+# some cases the only manufacturer, in others, it is the most popular.
+	w89k)
+		basic_machine=hppa1.1-winbond
+		;;
+	op50n)
+		basic_machine=hppa1.1-oki
+		;;
+	op60c)
+		basic_machine=hppa1.1-oki
+		;;
+	romp)
+		basic_machine=romp-ibm
+		;;
+	mmix)
+		basic_machine=mmix-knuth
+		;;
+	rs6000)
+		basic_machine=rs6000-ibm
+		;;
+	vax)
+		basic_machine=vax-dec
+		;;
+	pdp10)
+		# there are many clones, so DEC is not a safe bet
+		basic_machine=pdp10-unknown
+		;;
+	pdp11)
+		basic_machine=pdp11-dec
+		;;
+	we32k)
+		basic_machine=we32k-att
+		;;
+	sh[1234] | sh[24]a | sh[24]aeb | sh[34]eb | sh[1234]le | sh[23]ele)
+		basic_machine=sh-unknown
+		;;
+	sparc | sparcv8 | sparcv9 | sparcv9b | sparcv9v)
+		basic_machine=sparc-sun
+		;;
+	cydra)
+		basic_machine=cydra-cydrome
+		;;
+	orion)
+		basic_machine=orion-highlevel
+		;;
+	orion105)
+		basic_machine=clipper-highlevel
+		;;
+	mac | mpw | mac-mpw)
+		basic_machine=m68k-apple
+		;;
+	pmac | pmac-mpw)
+		basic_machine=powerpc-apple
+		;;
+	*-unknown)
+		# Make sure to match an already-canonicalized machine name.
+		;;
+	*)
+		echo Invalid configuration \`$1\': machine \`$basic_machine\' not recognized 1>&2
+		exit 1
+		;;
+esac
+
+# Here we canonicalize certain aliases for manufacturers.
+case $basic_machine in
+	*-digital*)
+		basic_machine=`echo $basic_machine | sed 's/digital.*/dec/'`
+		;;
+	*-commodore*)
+		basic_machine=`echo $basic_machine | sed 's/commodore.*/cbm/'`
+		;;
+	*)
+		;;
+esac
+
+# Decode manufacturer-specific aliases for certain operating systems.
+
+if [ x"$os" != x"" ]
+then
+case $os in
+	# First match some system type aliases
+	# that might get confused with valid system types.
+	# -solaris* is a basic system type, with this one exception.
+	-auroraux)
+		os=-auroraux
+		;;
+	-solaris1 | -solaris1.*)
+		os=`echo $os | sed -e 's|solaris1|sunos4|'`
+		;;
+	-solaris)
+		os=-solaris2
+		;;
+	-svr4*)
+		os=-sysv4
+		;;
+	-unixware*)
+		os=-sysv4.2uw
+		;;
+	-gnu/linux*)
+		os=`echo $os | sed -e 's|gnu/linux|linux-gnu|'`
+		;;
+	# First accept the basic system types.
+	# The portable systems comes first.
+	# Each alternative MUST END IN A *, to match a version number.
+	# -sysv* is not here because it comes later, after sysvr4.
+	-gnu* | -bsd* | -mach* | -minix* | -genix* | -ultrix* | -irix* \
+	      | -*vms* | -sco* | -esix* | -isc* | -aix* | -cnk* | -sunos | -sunos[34]*\
+	      | -hpux* | -unos* | -osf* | -luna* | -dgux* | -auroraux* | -solaris* \
+	      | -sym* | -kopensolaris* | -plan9* \
+	      | -amigaos* | -amigados* | -msdos* | -newsos* | -unicos* | -aof* \
+	      | -aos* | -aros* \
+	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
+	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* \
+	      | -bitrig* | -openbsd* | -solidbsd* \
+	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
+	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
+	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
+	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
+	      | -chorusos* | -chorusrdb* | -cegcc* \
+	      | -cygwin* | -msys* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
+	      | -mingw32* | -mingw64* | -linux-gnu* | -linux-android* \
+	      | -linux-newlib* | -linux-musl* | -linux-uclibc* \
+	      | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
+	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
+	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
+	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
+	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly* \
+	      | -skyos* | -haiku* | -rdos* | -toppers* | -drops* | -es*)
+	# Remember, each alternative MUST END IN *, to match a version number.
+		;;
+	-qnx*)
+		case $basic_machine in
+		    x86-* | i*86-*)
+			;;
+		    *)
+			os=-nto$os
+			;;
+		esac
+		;;
+	-nto-qnx*)
+		;;
+	-nto*)
+		os=`echo $os | sed -e 's|nto|nto-qnx|'`
+		;;
+	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
+	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* | -haiku* \
+	      | -macos* | -mpw* | -magic* | -mmixware* | -mon960* | -lnews*)
+		;;
+	-mac*)
+		os=`echo $os | sed -e 's|mac|macos|'`
+		;;
+	-linux-dietlibc)
+		os=-linux-dietlibc
+		;;
+	-linux*)
+		os=`echo $os | sed -e 's|linux|linux-gnu|'`
+		;;
+	-sunos5*)
+		os=`echo $os | sed -e 's|sunos5|solaris2|'`
+		;;
+	-sunos6*)
+		os=`echo $os | sed -e 's|sunos6|solaris3|'`
+		;;
+	-opened*)
+		os=-openedition
+		;;
+	-os400*)
+		os=-os400
+		;;
+	-wince*)
+		os=-wince
+		;;
+	-osfrose*)
+		os=-osfrose
+		;;
+	-osf*)
+		os=-osf
+		;;
+	-utek*)
+		os=-bsd
+		;;
+	-dynix*)
+		os=-bsd
+		;;
+	-acis*)
+		os=-aos
+		;;
+	-atheos*)
+		os=-atheos
+		;;
+	-syllable*)
+		os=-syllable
+		;;
+	-386bsd)
+		os=-bsd
+		;;
+	-ctix* | -uts*)
+		os=-sysv
+		;;
+	-nova*)
+		os=-rtmk-nova
+		;;
+	-ns2 )
+		os=-nextstep2
+		;;
+	-nsk*)
+		os=-nsk
+		;;
+	# Preserve the version number of sinix5.
+	-sinix5.*)
+		os=`echo $os | sed -e 's|sinix|sysv|'`
+		;;
+	-sinix*)
+		os=-sysv4
+		;;
+	-tpf*)
+		os=-tpf
+		;;
+	-triton*)
+		os=-sysv3
+		;;
+	-oss*)
+		os=-sysv3
+		;;
+	-svr4)
+		os=-sysv4
+		;;
+	-svr3)
+		os=-sysv3
+		;;
+	-sysvr4)
+		os=-sysv4
+		;;
+	# This must come after -sysvr4.
+	-sysv*)
+		;;
+	-ose*)
+		os=-ose
+		;;
+	-es1800*)
+		os=-ose
+		;;
+	-xenix)
+		os=-xenix
+		;;
+	-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+		os=-mint
+		;;
+	-aros*)
+		os=-aros
+		;;
+	-zvmoe)
+		os=-zvmoe
+		;;
+	-dicos*)
+		os=-dicos
+		;;
+	-nacl*)
+		;;
+	-none)
+		;;
+	*)
+		# Get rid of the `-' at the beginning of $os.
+		os=`echo $os | sed 's/[^-]*-//'`
+		echo Invalid configuration \`$1\': system \`$os\' not recognized 1>&2
+		exit 1
+		;;
+esac
+else
+
+# Here we handle the default operating systems that come with various machines.
+# The value should be what the vendor currently ships out the door with their
+# machine or put another way, the most popular os provided with the machine.
+
+# Note that if you're going to try to match "-MANUFACTURER" here (say,
+# "-sun"), then you have to tell the case statement up towards the top
+# that MANUFACTURER isn't an operating system.  Otherwise, code above
+# will signal an error saying that MANUFACTURER isn't an operating
+# system, and we'll never get to this point.
+
+case $basic_machine in
+	score-*)
+		os=-elf
+		;;
+	spu-*)
+		os=-elf
+		;;
+	*-acorn)
+		os=-riscix1.2
+		;;
+	arm*-rebel)
+		os=-linux
+		;;
+	arm*-semi)
+		os=-aout
+		;;
+	c4x-* | tic4x-*)
+		os=-coff
+		;;
+	hexagon-*)
+		os=-elf
+		;;
+	tic54x-*)
+		os=-coff
+		;;
+	tic55x-*)
+		os=-coff
+		;;
+	tic6x-*)
+		os=-coff
+		;;
+	# This must come before the *-dec entry.
+	pdp10-*)
+		os=-tops20
+		;;
+	pdp11-*)
+		os=-none
+		;;
+	*-dec | vax-*)
+		os=-ultrix4.2
+		;;
+	m68*-apollo)
+		os=-domain
+		;;
+	i386-sun)
+		os=-sunos4.0.2
+		;;
+	m68000-sun)
+		os=-sunos3
+		;;
+	m68*-cisco)
+		os=-aout
+		;;
+	mep-*)
+		os=-elf
+		;;
+	mips*-cisco)
+		os=-elf
+		;;
+	mips*-*)
+		os=-elf
+		;;
+	or32-*)
+		os=-coff
+		;;
+	*-tti)	# must be before sparc entry or we get the wrong os.
+		os=-sysv3
+		;;
+	sparc-* | *-sun)
+		os=-sunos4.1.1
+		;;
+	*-be)
+		os=-beos
+		;;
+	*-haiku)
+		os=-haiku
+		;;
+	*-ibm)
+		os=-aix
+		;;
+	*-knuth)
+		os=-mmixware
+		;;
+	*-wec)
+		os=-proelf
+		;;
+	*-winbond)
+		os=-proelf
+		;;
+	*-oki)
+		os=-proelf
+		;;
+	*-hp)
+		os=-hpux
+		;;
+	*-hitachi)
+		os=-hiux
+		;;
+	i860-* | *-att | *-ncr | *-altos | *-motorola | *-convergent)
+		os=-sysv
+		;;
+	*-cbm)
+		os=-amigaos
+		;;
+	*-dg)
+		os=-dgux
+		;;
+	*-dolphin)
+		os=-sysv3
+		;;
+	m68k-ccur)
+		os=-rtu
+		;;
+	m88k-omron*)
+		os=-luna
+		;;
+	*-next )
+		os=-nextstep
+		;;
+	*-sequent)
+		os=-ptx
+		;;
+	*-crds)
+		os=-unos
+		;;
+	*-ns)
+		os=-genix
+		;;
+	i370-*)
+		os=-mvs
+		;;
+	*-next)
+		os=-nextstep3
+		;;
+	*-gould)
+		os=-sysv
+		;;
+	*-highlevel)
+		os=-bsd
+		;;
+	*-encore)
+		os=-bsd
+		;;
+	*-sgi)
+		os=-irix
+		;;
+	*-siemens)
+		os=-sysv4
+		;;
+	*-masscomp)
+		os=-rtu
+		;;
+	f30[01]-fujitsu | f700-fujitsu)
+		os=-uxpv
+		;;
+	*-rom68k)
+		os=-coff
+		;;
+	*-*bug)
+		os=-coff
+		;;
+	*-apple)
+		os=-macos
+		;;
+	*-atari*)
+		os=-mint
+		;;
+	*)
+		os=-none
+		;;
+esac
+fi
+
+# Here we handle the case where we know the os, and the CPU type, but not the
+# manufacturer.  We pick the logical manufacturer.
+vendor=unknown
+case $basic_machine in
+	*-unknown)
+		case $os in
+			-riscix*)
+				vendor=acorn
+				;;
+			-sunos*)
+				vendor=sun
+				;;
+			-cnk*|-aix*)
+				vendor=ibm
+				;;
+			-beos*)
+				vendor=be
+				;;
+			-hpux*)
+				vendor=hp
+				;;
+			-mpeix*)
+				vendor=hp
+				;;
+			-hiux*)
+				vendor=hitachi
+				;;
+			-unos*)
+				vendor=crds
+				;;
+			-dgux*)
+				vendor=dg
+				;;
+			-luna*)
+				vendor=omron
+				;;
+			-genix*)
+				vendor=ns
+				;;
+			-mvs* | -opened*)
+				vendor=ibm
+				;;
+			-os400*)
+				vendor=ibm
+				;;
+			-ptx*)
+				vendor=sequent
+				;;
+			-tpf*)
+				vendor=ibm
+				;;
+			-vxsim* | -vxworks* | -windiss*)
+				vendor=wrs
+				;;
+			-aux*)
+				vendor=apple
+				;;
+			-hms*)
+				vendor=hitachi
+				;;
+			-mpw* | -macos*)
+				vendor=apple
+				;;
+			-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+				vendor=atari
+				;;
+			-vos*)
+				vendor=stratus
+				;;
+		esac
+		basic_machine=`echo $basic_machine | sed "s/unknown/$vendor/"`
+		;;
+esac
+
+echo $basic_machine$os
+exit
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "timestamp='"
+# time-stamp-format: "%:y-%02m-%02d"
+# time-stamp-end: "'"
+# End:
diff -urN a/configure.ac b/configure.ac
--- a/configure.ac	1970-01-01 01:00:00.000000000 +0100
+++ b/configure.ac	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,784 @@
+AC_INIT([cctools], [895], [Ray Donnelly <mingw.android@gmail.com>])
+AC_PREREQ([2.62])
+AC_REVISION([m4_esyscmd_s([git describe --always])])
+
+# Weird. Doesn't seem to do anything...
+AC_CONFIG_MACRO_DIR([m4])
+
+# ...as I still need these:
+m4_include([m4/ax_append_flag.m4])
+m4_include([m4/ax_check_compile_flag.m4])
+m4_include([m4/ax_append_compile_flags.m4])
+m4_include([m4/check_enum.m4])
+
+AC_CONFIG_SRCDIR([APPLE_LICENSE])
+
+# Causes multiply defined warning unfortunately.
+AC_GNU_SOURCE
+
+AC_PROG_INSTALL
+AC_PROG_LN_S
+AC_PROG_CC
+AC_PROG_CXX
+
+AC_PROG_CC_C99
+
+AC_CANONICAL_BUILD
+AC_CANONICAL_HOST
+AC_CANONICAL_TARGET
+
+case $target_os in
+darwin*)
+    :
+    ;;
+*)
+    AC_MSG_ERROR([$PACKAGE_NAME only supports targeting Darwin])
+    ;;
+esac
+
+case $host_os in
+    darwin*)
+      LD_DYNAMIC=
+      LD_STATIC=
+      LD_STATIC_GROUP_START=
+      LD_STATIC_GROUP_END=
+    ;;
+    *)
+      LD_DYNAMIC="-Wl,-Bdynamic"
+      LD_STATIC="-Wl,-Bstatic"
+      LD_STATIC_GROUP_START="-Wl,-Bstatic -Wl,--start-group"
+      LD_STATIC_GROUP_END="-Wl,--end-group -Wl,-Bdynamic"
+    ;;
+esac
+
+AX_APPEND_COMPILE_FLAGS([-D__DARWIN_UNIX03 -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS],CFLAGS)
+AX_APPEND_COMPILE_FLAGS([-D__DARWIN_UNIX03 -D__STDC_LIMIT_MACROS -D__STDC_CONSTANT_MACROS],CXXFLAGS)
+
+# Handle host dependant matters.
+# 1. Append to CFLAGS early so that configure checks use them.
+# 2. __attribute__((visibility("hidden"))) doesn't work on MinGW.
+case $host_os in
+    mingw*)
+      AX_APPEND_COMPILE_FLAGS([-D__USE_MINGW_ANSI_STDIO=1 -D_POSIX -D_POSIX_C_SOURCE -D_GNU_SOURCE],CFLAGS)
+      AX_APPEND_COMPILE_FLAGS([-D__USE_MINGW_ANSI_STDIO=1 -D_POSIX -D_POSIX_C_SOURCE -D_GNU_SOURCE],CXXFLAGS)
+      PRIVEXT=
+      PRIVEXT_DESC="private extern as nothing"
+      ;;
+    *)
+      PRIVEXT="__attribute__((visibility(\"hidden\")))"
+      PRIVEXT_DESC="private extern as hidden visibility"
+      ;;
+esac
+
+AC_CONFIG_HEADERS([include/config.h])
+
+# To minimise impact on the source code, we provide our own versions of
+# missing system headers. This is almost entirely a check for Darwin,
+# but it may also apply to *BSD.
+AC_CHECK_HEADERS([libc.h])
+AM_CONDITIONAL([HAVE_LIBC_H], [test "x$ac_cv_header_libc_h" = xyes])
+AM_COND_IF([HAVE_LIBC_H],
+ [AC_SUBST([HAVE_LIBC_CXX_H], [NO])],
+ [AC_CONFIG_HEADERS([include/libc.h include/libc_cxx.h])
+  AC_SUBST([HAVE_LIBC_CXX_H], [YES])]
+  )
+
+# Need this to happen even on Linux which has it's own dlfcn.h
+AC_CHECK_HEADERS([dlfcn.h])
+AM_CONDITIONAL([HAVE_DLFCN_H], [test "x$ac_cv_header_dlfcn_h" = xyes])
+AM_COND_IF([HAVE_DLFCN_H], [],
+ AC_CONFIG_HEADERS([include/dlfcn.h]))
+
+AC_CHECK_HEADERS([err.h])
+AM_CONDITIONAL([HAVE_ERR_H], [test "x$ac_cv_header_err_h" = xyes])
+AM_COND_IF([HAVE_ERR_H], [],
+ AC_CONFIG_HEADERS([include/err.h]))
+
+AC_CHECK_HEADERS([execinfo.h])
+AM_CONDITIONAL([HAVE_EXECINFO_H], [test "x$ac_cv_header_execinfo_h" = xyes])
+AM_COND_IF([HAVE_EXECINFO_H], [],
+ AC_CONFIG_HEADERS([include/execinfo.h]))
+
+AC_CHECK_HEADERS([sys/cdefs.h])
+AM_CONDITIONAL([HAVE_SYS_CDEFS_H], [test "x$ac_cv_header_sys_cdefs_h" = xyes])
+AM_COND_IF([HAVE_SYS_CDEFS_H], [],
+ AC_CONFIG_HEADERS([include/sys/cdefs.h]))
+
+AC_CHECK_HEADERS([sys/_endian.h])
+AM_CONDITIONAL([HAVE_SYS__ENDIAN_H], [test "x$ac_cv_header_sys__endian_h" = xyes])
+AM_COND_IF([HAVE_SYS__ENDIAN_H], [],
+ AC_CONFIG_HEADERS([include/sys/_endian.h]))
+
+AC_CHECK_HEADERS([sys/mman.h])
+AM_CONDITIONAL([HAVE_SYS_MMAN_H], [test "x$ac_cv_header_sys_mman_h" = xyes])
+AM_COND_IF([HAVE_SYS_MMAN_H], [],
+ AC_CONFIG_HEADERS([include/sys/mman.h]))
+
+AC_CHECK_HEADERS([sys/sysctl.h])
+AM_CONDITIONAL([HAVE_SYS_SYSCTL_H], [test "x$ac_cv_header_sys_sysctl_h" = xyes])
+AM_COND_IF([HAVE_SYS_SYSCTL_H], [],
+ AC_CONFIG_HEADERS([include/sys/sysctl.h]))
+
+AC_CHECK_HEADERS([paths.h])
+AM_CONDITIONAL([HAVE_PATHS_H], [test "x$ac_cv_header_paths_h" = xyes])
+AM_COND_IF([HAVE_PATHS_H], [],
+ AC_CONFIG_HEADERS([include/paths.h]))
+
+AC_CHECK_HEADERS([servers/bootstrap.h])
+AM_CONDITIONAL([HAVE_SERVERS_BOOTSTRAP_H], [test "x$ac_cv_header_servers_bootstrap_h" = xyes])
+AM_COND_IF([HAVE_SERVERS_BOOTSTRAP_H], [],
+ AC_CONFIG_HEADERS([include/servers/bootstrap.h]))
+
+AC_CHECK_HEADERS([malloc/malloc.h])
+AM_CONDITIONAL([HAVE_MALLOC_MALLOC_H], [test "x$ac_cv_header_malloc_malloc_h" = xyes])
+AM_COND_IF([HAVE_MALLOC_MALLOC_H], [],
+ AC_CONFIG_HEADERS([include/malloc/malloc.h]))
+
+AC_CHECK_HEADERS([configure.h])
+AM_CONDITIONAL([HAVE_CONFIGURE_H], [test "x$ac_cv_header_configure_h" = xyes])
+AM_COND_IF([HAVE_CONFIGURE_H], [],
+ AC_CONFIG_HEADERS([include/configure.h]))
+
+AC_CHECK_HEADERS([tzfile.h])
+AM_CONDITIONAL([HAVE_TZFILE_H], [test "x$ac_cv_header_tzfile_h" = xyes])
+AM_COND_IF([HAVE_TZFILE_H], [],
+ AC_CONFIG_HEADERS([include/tzfile.h]))
+
+AC_CHECK_HEADERS([CommonCrypto/CommonDigest.h], [SSL_LIBS=/usr/lib/libcrypto.dylib], [SSL_LIBS="$LD_STATIC -lssl -lcrypto $LD_DYNAMIC"])
+AC_SUBST(SSL_LIBS)
+AM_CONDITIONAL([HAVE_COMMONCRYPTO_COMMONDIGEST_H], [test "x$ac_cv_header_CommonCrypto_CommonDigest_h" = xyes])
+AM_COND_IF([HAVE_COMMONCRYPTO_COMMONDIGEST_H], [],
+ AC_CONFIG_HEADERS([include/CommonCrypto/CommonDigest.h]))
+
+# For Windows:
+AC_TYPE_UID_T
+AC_CHECK_TYPE([caddr_t], [],
+            [AC_DEFINE([caddr_t], [char *],
+               [Define to `char *'
+                if not defined.])])
+
+AC_CHECK_TYPE([sigset_t], [],
+            [AC_DEFINE([sigset_t], [int32_t],
+               [Define to `int32_t'
+                if not defined.])])
+
+AC_CHECK_TYPE([u_int32_t], [],
+            [AC_DEFINE([u_int32_t], [uint32_t],
+               [Define to `uint32_t'])],
+            [#include <sys/types.h>])
+
+AC_CHECK_TYPE([u_char], [],
+            [AC_DEFINE([u_char], [uint8_t],
+               [Define to `uint32_t'])],
+            [#include <sys/types.h>])
+
+AC_CHECK_TYPE([u_short], [],
+            [AC_DEFINE([u_short], [unsigned short],
+               [Define to `unsigned short'])],
+            [#include <sys/types.h>])
+
+AC_CHECK_TYPE([u_int], [],
+            [AC_DEFINE([u_int], [unsigned int],
+               [Define to `unsigned int'])],
+            [#include <sys/types.h>])
+
+AC_CHECK_DECL([MIN], [],
+            [AC_DEFINE([MIN(_a,_b)], [(((_a)<(_b))?(_a):(_b))],
+               [Define MIN(_a,_b) to `(((_a)<(_b))?(_a):(_b))'])],
+            [#include <sys/param.h>])
+
+# MinGW-w64 has sleep() but sometimes not in unistd.h.
+# Older ones and mingw don't. We don't support mingw
+# builds anymore; life's too short. AC_CHECK_DECS is
+# used so that HAVE_DECL_SLEEP can be tested in
+# emulated.h
+AC_CHECK_DECLS([sleep])
+
+# MinGW-w64 has SIGHUP and SIGPIPE so long as _POSIX is defined,
+# otherwise define them to the values 1 and 13 respectively.
+AC_CHECK_DECL([SIGHUP], [],
+            [AC_DEFINE([SIGHUP], [1],
+               [SIGHUP])],
+            [#include <signal.h>])
+
+AC_CHECK_DECL([SIGPIPE], [],
+            [AC_DEFINE([SIGPIPE], [13],
+               [SIGPIPE])],
+            [#include <signal.h>])
+
+# Linux's dlfcn.h has the exact same structure layout for
+# Dl_info as Mac OS X, it's just missing the dl_info alias.
+AC_CHECK_TYPE([dl_info], [],
+            [AC_DEFINE([dl_info], [Dl_info],
+               [Define to `Dl_info'])],
+            [#include <dlfcn.h>])
+
+# For everything but Windows:
+AC_CHECK_DECL([O_BINARY], [],
+            [AC_DEFINE([O_BINARY], [0],
+               [Windows-specific open() flag
+                to disable text mode])],
+            [[#include <io.h>
+              #include <fcntl.h>]])
+
+# For everything but Darwin/BSD:
+AC_CHECK_FUNC([bcmp], [],
+            [AC_DEFINE([bcmp], [memcmp], [memcmp will suffice])])
+
+AC_CHECK_FUNC([bcopy], [],
+            [AC_DEFINE([bcopy(_s,_d,_n)], [memmove(_d,_s,_n)], [memmove will suffice])])
+
+AC_CHECK_FUNC([bzero], [],
+            [AC_DEFINE([bzero(_p,_n)], [memset(_p,0,_n)], [memset will suffice])])
+
+AC_CHECK_FUNC([setbuffer], [],
+            [AC_DEFINE([setbuffer(_f,_b,_n)], [do {} while(0)], [not needed])])
+
+AC_CHECK_FUNC([getwd], [],
+            [AC_DEFINE([getwd(_p)], [getcwd(_p,MAXPATHLEN-1)], [getcwd will suffice])])
+
+AC_CHECK_FUNC([ffs], [],
+            [AC_DEFINE([ffs(_x)], [__builtin_ffs(_x)], [__builtin_ffs will suffice])])
+
+AC_CHECK_FUNC([getc_unlocked], [],
+            [AC_DEFINE([getc_unlocked(_f)], [getc(_f)], [getc will suffice])])
+
+AC_CHECK_DECL([ULLONG_MAX], [],
+            [AC_DEFINE([ULLONG_MAX], [0xffffffffffffffffULL],
+               [ULLONG_MAX])],
+            [#include <limits.h>])
+
+CHECK_ENUM(CTL_KERN, [sys/sysctl.h],
+            [], [AC_DEFINE([CTL_KERN], [1],
+               [CTL_KERN])])
+
+CHECK_ENUM(KERN_OSRELEASE, [sys/sysctl.h],
+            [], [AC_DEFINE([KERN_OSRELEASE], [2],
+               [KERN_OSRELEASE])])
+
+# This must be checked for after CTL_KERN amd KERN_OSRELEASE because
+# on Linux, sysctl.h contains "unsigned long __unused[4];"
+AC_CHECK_DECL([__unused], [],
+            [AC_DEFINE([__UNUSED_NOT_DEFINED], [1],
+               [__unused macro to save some typing])],
+            [#include <sys/cdefs.h>])
+
+AC_CHECK_DECL([FP_PREC_24B], [],
+            [AC_DEFINE([FP_PREC_24B], [0],
+               [FP_PREC_24B])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_PREC_53B], [],
+            [AC_DEFINE([FP_PREC_53B], [2],
+               [FP_PREC_53B])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_PREC_64B], [],
+            [AC_DEFINE([FP_PREC_64B], [3],
+               [FP_PREC_64B])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_RND_NEAR], [],
+            [AC_DEFINE([FP_RND_NEAR], [0],
+               [FP_RND_NEAR])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_RND_DOWN], [],
+            [AC_DEFINE([FP_RND_DOWN], [1],
+               [FP_RND_DOWN])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_RND_UP], [],
+            [AC_DEFINE([FP_RND_UP], [2],
+               [FP_RND_UP])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([FP_CHOP], [],
+            [AC_DEFINE([FP_CHOP], [3],
+               [FP_CHOP])],
+            [#include <_structs.h>])
+
+AC_CHECK_DECL([S_IFSOCK], [],
+            [AC_DEFINE([S_IFSOCK], [0140000], [0140000])])
+
+AC_CHECK_DECL([S_ISUID], [],
+            [AC_DEFINE([S_ISUID], [0004000], [0004000])])
+
+AC_CHECK_DECL([S_IFLNK], [],
+            [AC_DEFINE([S_IFLNK], [0120000], [0120000])])
+
+AC_CHECK_DECL([S_IRGRP], [],
+            [AC_DEFINE([S_IRGRP], [00040], [00040])])
+
+AC_CHECK_DECL([S_IWGRP], [],
+            [AC_DEFINE([S_IWGRP], [00020], [00020])])
+
+AC_CHECK_DECL([S_IXGRP], [],
+            [AC_DEFINE([S_IXGRP], [00010], [00010])])
+
+AC_CHECK_DECL([S_ISGID], [],
+            [AC_DEFINE([S_ISGID], [0002000], [0002000])])
+
+AC_CHECK_DECL([S_IROTH], [],
+            [AC_DEFINE([S_IROTH], [00004], [00004])])
+
+AC_CHECK_DECL([S_IWOTH], [],
+            [AC_DEFINE([S_IWOTH], [00002], [00002])])
+
+AC_CHECK_DECL([S_IXOTH], [],
+            [AC_DEFINE([S_IXOTH], [00001], [00001])])
+
+AC_CHECK_DECL([S_ISVTX], [],
+            [AC_DEFINE([S_ISVTX], [0001000], [0001000])])
+
+AC_CHECK_DECL([EBADRPC], [],
+            [AC_DEFINE([EBADRPC], [72],
+               [EBADRPC])],
+            [#include <sys/errno.h>])
+
+AC_CHECK_DECL([EFTYPE], [],
+            [AC_DEFINE([EFTYPE], [79],
+               [EFTYPE])],
+            [#include <sys/errno.h>])
+
+AC_CHECK_DECL([CPU_SUBTYPE_ARM_V5TEJ], [],
+            [AC_DEFINE([CPU_SUBTYPE_ARM_V5TEJ], [((cpu_subtype_t) 7)],
+               [CPU_SUBTYPE_ARM_V5TEJ])],
+            [#include <mach/machine.h>])
+
+AC_CHECK_DECL([CPU_SUBTYPE_ARM_XSCALE], [],
+            [AC_DEFINE([CPU_SUBTYPE_ARM_XSCALE], [((cpu_subtype_t) 8)],
+               [CPU_SUBTYPE_ARM_XSCALE])],
+            [#include <mach/machine.h>])
+
+AC_CHECK_DECL([CPU_SUBTYPE_ARM_V7], [],
+            [AC_DEFINE([CPU_SUBTYPE_ARM_V7], [((cpu_subtype_t) 9)],
+               [CPU_SUBTYPE_ARM_V7])],
+            [#include <mach/machine.h>])
+
+AC_CHECK_DECL([N_ARM_THUMB_DEF], [],
+            [AC_DEFINE([N_ARM_THUMB_DEF], [0x0008],
+               [CPU_SUBTYPE_ARM_V7])],
+            [#include <mach-o/nlist.h>])
+
+AC_ARG_PROGRAM
+
+AC_ARG_ENABLE([shared],
+  AS_HELP_STRING([--disable-shared], [Disable shared build]))
+
+AC_ARG_ENABLE([static],
+  AS_HELP_STRING([--enable-static], [Enable static build]))
+
+#AS_IF([test "x$enable_shared" != "xno"], [
+#  AS_IF([test "x$enable_static" = "xyes"], [
+#        AC_MSG_ERROR([Can't configure cctools as both static and shared])
+#  ])
+#])
+
+AS_IF([test "$enable_shared" = "$enable_static"], [
+    AC_MSG_ERROR([Please configure as static or shared, not both])
+])
+
+case $target_cpu in
+     powerpc)
+        AC_DEFINE(EMULATED_HOST_CPU_TYPE, 18, [Emulated CPU type])
+        AC_DEFINE(EMULATED_HOST_CPU_SUBTYPE, 100, [Emulated CPU subtype])
+    ;;
+     powerpc64)
+        AC_DEFINE(EMULATED_HOST_CPU_TYPE, 16777234, [Emulated CPU type])
+        AC_DEFINE(EMULATED_HOST_CPU_SUBTYPE, 0, [Emulated CPU subtype])
+       ;;
+     i?86)
+        AC_DEFINE(EMULATED_HOST_CPU_TYPE, 7, [Emulated CPU type])
+        AC_DEFINE(EMULATED_HOST_CPU_SUBTYPE, 10, [Emulated CPU subtype])
+    ;;
+     x86_64)
+        AC_DEFINE(EMULATED_HOST_CPU_TYPE, 16777223, [Emulated CPU type])
+        AC_DEFINE(EMULATED_HOST_CPU_SUBTYPE, 3, [Emulated CPU subtype])
+    ;;
+     arm)
+        AC_DEFINE(EMULATED_HOST_CPU_TYPE, 12, [Emulated CPU type])
+        AC_DEFINE(EMULATED_HOST_CPU_SUBTYPE, 0, [Emulated CPU subtype])
+    ;;
+     *)
+    AC_MSG_ERROR([Unsupported target $target_cpu])
+    ;;
+esac
+
+AC_CHECK_TOOL([HOST_RANLIB], [ranlib], :)
+AC_CHECK_TOOL([HOST_AR], [ar], :)
+
+ASTARGETS=""
+conftargets=""
+AC_MSG_CHECKING([for configured assembler targets])
+AC_ARG_ENABLE([as-targets],
+        AC_HELP_STRING([--enable-as-targets],
+                [space-separated list ("ppc", "ppc64", "i386", "x86_64", "arm", "all")]),
+        [conftargets="$enableval"],
+        [conftargets="default"])
+
+case "$conftargets" in
+    all)
+        ASTARGETS="ppc ppc64 i386 x86_64 arm"
+    ;;
+    default)
+        ASTARGETS="ppc ppc64 i386 x86_64 arm"
+    ;;
+    yes)
+        AC_MSG_ERROR([no assembler targets configured])
+    ;;
+    no)
+        AC_MSG_ERROR([no assembler targets configured])
+    ;;
+    *)
+        if [[ -z "$conftargets" ]]; then
+            AC_MSG_ERROR([no assembler targets configured])
+        fi
+        ASTARGETS="$conftargets"
+    ;;
+esac
+
+AC_MSG_RESULT([$ASTARGETS])
+AC_SUBST([ASTARGETS], [$ASTARGETS])
+
+# On openSUSE, libexec ends up as lib instead. In:
+# /usr/share/site/x86_64-unknown-linux-gnu
+# there's:
+# "If user did not specify libexecdir, guess the correct target:
+# Nor FHS nor openSUSE allow prefix/libexec. Let's default to prefix/lib."
+# libexecdir='${exec_prefix}/lib'
+# ..however, even when I did specify it to configure, it didn't work.
+# Fact is, we always want ${prefix}/libexec for Darwin cross compilers.
+# AC_SUBST([ASLIBEXECDIR], ['${libexecdir}/as'])
+
+AC_SUBST([ASLIBEXECDIR], ['${prefix}/libexec/as'])
+
+AC_ARG_WITH([sysroot],
+        AC_HELP_STRING([--with-sysroot],
+                [filesystem root of cross build environment]),
+        [AC_DEFINE_UNQUOTED([CROSS_SYSROOT],["$withval"],[filesystem root of cross build environment])])
+
+AC_ARG_WITH([llvm],
+        AC_HELP_STRING([--with-llvm],
+                [prefix of llvm to use (final prefix, not builddir)]),
+        llvm="$withval")
+
+if test "x${llvm}" != x; then
+    AC_MSG_NOTICE(["Using llvm in prefix ${llvm}"])
+    # LTO.dll exists in ${llvm}/bin folder and even though
+    # there is libLTO.a in ${llvm}/lib, it isn't an import
+    # library for this dll; rather a static lib. To ensure
+    # the dll is found first -L${llvm}/bin appears infront
+    # of -L${llvm}/lib in LDFLAGS.
+    case $host_os in
+        mingw*)
+            AX_APPEND_COMPILE_FLAGS([-L${llvm}/bin],LDFLAGS)
+        ;;
+    esac
+    AX_APPEND_COMPILE_FLAGS([-I${llvm}/include],CFLAGS)
+    AX_APPEND_COMPILE_FLAGS([-L${llvm}/lib],LDFLAGS)
+    llvm_config=${llvm}/bin/${target}-llvm-config$EXEEXT
+    if ! test -x "${llvm_config}"; then
+        AC_MSG_WARN([llvm-config (${llvm_config}) not found, will use LLVM 2.7 defaults])
+        llvm_config=
+    fi
+else
+    AC_MSG_ERROR(["Please specify --with-llvm=<path>"])
+fi
+
+# Not sure why MDYNAMICNOPIC is used instead of just WARNINGS
+MDYNAMICNOPIC=""
+AX_APPEND_COMPILE_FLAGS([-mdynamic-no-pic], [MDYNAMICNOPIC])
+AC_SUBST([MDYNAMICNOPIC])
+
+AX_APPEND_COMPILE_FLAGS([-fno-builtin-round -fno-builtin-trunc],[CFLAGS])
+
+ORIGCFLAGS=$CFLAGS
+CFLAGS="$CFLAGS -no-cpp-precomp"
+supported=0
+AC_MSG_CHECKING([if -no-cpp-precomp is supported])
+AC_LANG_CONFTEST(
+    [AC_LANG_SOURCE([const char hw[] = "Hello, World\n";])])
+rm -f conftest.$ac_objext conftest$ac_exeext
+out=`$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext 2>&1`
+if [[ $? -ne 0 ]]; then
+   supported=0;
+else
+   unrecog=`echo $out | grep unrecog | wc -l`
+   if [[ $unrecog -gt 0 ]]; then
+      supported=0;
+   else
+      supported=1;
+   fi
+fi
+if [[ $supported -eq 1 ]]; then
+   AC_MSG_RESULT([yes])
+else
+   CFLAGS="$ORIGCFLAGS"
+   AC_MSG_RESULT([no])
+fi
+rm -f conftest.$ac_objext conftest$ac_exeext conftest.$ac_ext
+
+# There's a bug in Google's 4.4.3 GCC where it never reports -Wno-* as missing, unless there are other warnings present as well.
+# i.e. the following command returns an exit code of 0 and reports no error:
+#  /home/nonesuch/i686-linux-glibc2.7-4.4.3/bin/i686-linux-gcc -Wall -Wno-way-this-warning-exists conftest.c
+# whereas this command fails, reporting an error:
+#  /home/nonesuch/i686-linux-glibc2.7-4.4.3/bin/i686-linux-gcc -Wall -Wthis-warning-doesnt-exist conftest.c
+# for this reason, form INVERSE_WARNINGS (containing -Wimport instead of -Wno-import) then transform them afterwards.
+# A cleaner approach might be to create and use AX_ENABLE_WARNING and AX_DISABLE_WARNING where e.g. 'import', 'unused-variable' etc are the names specified.
+# -Wattributes (hence -Wno-attributes) used to be in this list, but I'd rather not disable warnings un-necessarily, in fact, enabling all
+# warnings (or at least not disabling any) and compiling everything with -Werror should be an explicit goal.
+AX_APPEND_COMPILE_FLAGS([-Wimport -Wunused-variable -Wunused-but-set-variable -Wdeprecated-declarations], [INVERSE_WARNINGS], [-Wall -Werror])
+WARNINGS=$(echo ${INVERSE_WARNINGS} | sed -e s/-W/-Wno-/g)
+AC_SUBST([WARNINGS], [$WARNINGS])
+
+# odcctools seemed to think that otool/print_objc*.c needs to be
+# compiled as Objective-c. AFAICT, this is wrong, they're purely
+# c files, I've not deleted it because I'm not 100% sure that it
+# doesn't rely on some structural layout differences between C
+# and Objective-C for these parts to work right.
+# ORIGCFLAGS=$CFLAGS
+# CFLAGS="$CFLAGS -x objective-c"
+# OBJC="-x objective-c"
+# AC_MSG_CHECKING([if -x objective-c is supported])
+# AC_COMPILE_IFELSE(
+#    [AC_LANG_SOURCE([[@class foo;
+# void bar(void) {
+#      [foo alloc];
+# }
+# ]])],
+#    [AC_DEFINE(HAVE_OBJC, 1, [Have Objective-C support])
+#     AC_MSG_RESULT([yes])],
+#    [OBJC=""
+#     AC_MSG_RESULT([no])]
+# )
+# AC_SUBST([OBJC], [$OBJC])
+# CFLAGS=$ORIGCFLAGS
+
+# Again, Objective-C likely not needed.
+# AC_HEADER_STDC
+# AC_CHECK_HEADERS([stdio.h errno.h limits.h])
+# if [[ "x$OBJC" != "x" ]]; then
+#    ORIGCFLAGS=$CFLAGS
+#    CFLAGS="$CFLAGS $OBJC"
+#    AC_CHECK_HEADERS([objc/objc-runtime.h])
+#    CFLAGS="$ORIGCFLAGS"
+# fi
+
+
+AC_MSG_CHECKING([if __private_extern__ is supported])
+AC_COMPILE_IFELSE(
+   [AC_LANG_SOURCE([[__private_extern__ int foo;]])],
+   [AC_MSG_RESULT([yes])],
+   [AC_DEFINE_UNQUOTED([__private_extern__], [$PRIVEXT], [$PRIVEXT_DESC])
+    AC_MSG_RESULT([no])]
+)
+
+ORIGLDFLAGS=$LDFLAGS
+LDFLAGS="$LDFLAGS -multiply_defined suppress"
+AC_MSG_CHECKING([if -multiply_defined suppress is supported])
+AC_LINK_IFELSE([AC_LANG_PROGRAM()],
+    [AC_MSG_RESULT([yes])],
+    [LDFLAGS="$ORIGLDFLAGS"
+     AC_MSG_RESULT([no])]
+)
+
+# Again, work around the -Wno-* bug.
+AC_LANG_PUSH([C++])
+AX_APPEND_COMPILE_FLAGS([-Wtrigraphs -Wdeprecated -Wstrict-aliasing -Wenum-compare -Winvalid-offsetof], [INVERSE_CXXWARNINGS], [-Wall -Werror])
+CXXWARNINGS=$(echo ${INVERSE_CXXWARNINGS} | sed -e s/-W/-Wno-/g)
+CXXFLAGS=$CXXFLAGS" $CXXWARNINGS"
+AC_LANG_POP
+
+# The parameter order of both qsort_r and its callback are different on BSD
+# than they are on Linux.
+AC_CHECK_FUNCS([qsort_r])
+if test $ac_cv_func_qsort_r = yes; then
+    save_cflags=$CFLAGS
+    CFLAGS="$CFLAGS -Wall -Werror -D_USE_GNU_SOURCE"
+    AC_MSG_CHECKING([for BSD-style qsort_r])
+    AC_COMPILE_IFELSE(
+     [AC_LANG_SOURCE([[#include <stdlib.h>
+                       int callback(void* a, const void* b, const void* c) { return 0; }
+                       void test() { qsort_r( (void*)1, 0, 0, callback, callback ); }]])],
+     [AC_DEFINE([HAVE_BSD_QSORT_R], [1], [BSD-syle qsort_r])],
+     [AC_DEFINE([HAVE_GLIBC_QSORT_R], [1], [glibc-syle qsort_r])]
+     )
+    CFLAGS=$save_cflags
+else
+    AC_DEFINE([NEED_BSD_QSORT_R], [1], [need BSD-style qsort_r])
+fi
+
+AC_CHECK_FUNCS([qsort getattrlist NSIsSymbolNameDefined strlcpy strlcat _NSGetExecutablePath])
+AC_CHECK_DECLS([vm_msync], [], [], [[#include <mach/vm_map.h>]])
+
+AC_CHECK_DECLS([backtrace], [], [], [[#include <execinfo.h>]])
+AC_CHECK_DECLS([dlopen, dlsym, dlclose, dlerror, dladdr], [], [], [[#include <dlfcn.h>]])
+AC_CHECK_DECLS([mmap], [], [], [[#include <sys/mman.h>]])
+AC_CHECK_DECLS([flock], [], [], [[#include <sys/file.h>]])
+AC_CHECK_DECLS([sigfillset, sigprocmask], [], [], [[#include <signal.h>]])
+AC_CHECK_DECLS([utimes], [], [], [[#include <sys/time.h>]])
+AC_CHECK_DECLS([asprintf], [], [], [[#include <stdio.h>]])
+AC_CHECK_DECLS([strlcpy, strlcat, rindex, index, strmode, mkstemp, fchmod, fchdir, pwrite, realpath])
+AC_CHECK_DECLS([readlink, getuid, getgid], [], [], [[#include <unistd.h>]])
+
+case $host_os in
+    mingw*)
+      AC_DEFINE([FIO_READ_WRITE],[_S_IREAD|_S_IWRITE],[0666])
+      AC_DEFINE([FIO_READ_WRITE_ME],[_S_IREAD|_S_IWRITE],[0600])
+      AC_DEFINE([FIO_READ_WRITE_EXEC],[_S_IREAD|_S_IWRITE|_S_IEXEC],[0777])
+      AC_DEFINE([FIO_MASK_ALL_4],[_S_IREAD|_S_IWRITE|_S_IEXEC],[07777])
+      ;;
+    *)
+      AC_DEFINE([FIO_READ_WRITE],[0666],[_S_IREAD|_S_IWRITE])
+      AC_DEFINE([FIO_READ_WRITE_ME],[0600],[_S_IREAD|_S_IWRITE])
+      AC_DEFINE([FIO_READ_WRITE_EXEC],[0777],[_S_IREAD|_S_IWRITE|_S_IEXEC])
+      AC_DEFINE([FIO_MASK_ALL_4],[07777],[_S_IREAD|_S_IWRITE|_S_IEXEC])
+      ;;
+esac
+
+case $host_os in
+    darwin*)
+      AC_SUBST([HAVE_FOREIGN_HEADERS],[NO])
+      ;;
+    *)
+      AC_SUBST([HAVE_FOREIGN_HEADERS],[YES])
+      AC_SUBST([EMULATED_OBJ], [emulated.c])
+      AC_C_BIGENDIAN([AC_SUBST([ENDIAN_FLAG],[-D__BIG_ENDIAN__])],
+          [AC_SUBST([ENDIAN_FLAG],[-D__LITTLE_ENDIAN__])])
+      ;;
+esac
+
+# There's no fts.h (included from dylib_roots.c) with MinGW. There is however,
+# http://cygwin.com/cgi-bin/cvsweb.cgi/src/winsup/cygwin/libc/fts.c?cvsroot=src
+# http://cygwin.com/cgi-bin/cvsweb.cgi/~checkout~/src/winsup/cygwin/libc/fts.c?rev=1.4&content-type=text/plain&cvsroot=src
+# from cygwin which is under the BSD license, so I could maybe use that if seg_addr_table is needed.
+case $host_os in
+     mingw*)
+       AC_DEFINE_UNQUOTED([EXEEXT],[".exe"], ["Define executable extension"])
+       ;;
+     *)
+       AC_DEFINE_UNQUOTED([EXEEXT],[""], ["Define executable extension"])
+       AC_SUBST([NOT_FOR_WINDOWS_C],["dylib_roots.c seg_addr_table.c dylib_table.c SymLoc.c"])
+       AC_SUBST([NOT_FOR_WINDOWS_MISC_C],["checksyms.c redo_prebinding.c"])
+       AC_SUBST([NOT_FOR_WINDOWS_PROG],["seg_addr_table checksyms redo_prebinding"])
+       ;;
+esac
+
+# ldclassic has been deprecated by ld64.
+# If you want to enable it you can do so
+# here, but be warned; this has not been
+# tested for an unsigned long long time.
+LD_CLASSIC=
+# LD_CLASSIC=ld
+COMPONENTS="libstuff ar as include libprunetrie libmacho ${LD_CLASSIC} misc otool man ld64"
+AC_SUBST([COMPONENTS], [$COMPONENTS])
+
+AC_CHECK_FUNC([uuid_generate_random],[],
+          [AC_CHECK_LIB([uuid],[uuid_generate_random],
+                [UUID_LIBS="$LD_STATIC -luuid $LD_DYNAMIC"],
+                [AC_MSG_ERROR(
+                 [No uuid_generate_random function found])])])
+AC_SUBST([UUID_LIBS])
+
+AC_CHECK_FUNC([dlopen],[],
+          [AC_CHECK_LIB([dl],[dlopen],
+                [DL_LIBS="-ldl"],
+                [AC_MSG_WARN(
+                 [No dlopen function found in dl])])])
+AC_SUBST([DL_LIBS])
+
+
+# This chunk may not be needed, could just use -l$SHARED_LTO_SEARCH instead probably.
+case $host_os in
+    darwin*|linux*)
+      SHARED_LTO_LIBS="$LD_DYNAMIC -lpthread -lLTO"
+    ;;
+    *)
+      SHARED_LTO_LIBS="$LD_DYNAMIC -lpthread -lLTO"
+    ;;
+esac
+
+# Windows is behaving weirdly, need to specify -llibLTO for it to pick up the dll variant
+# when using AC_CHECK_LIB, if specify -lLTO then libLTO.a used (even after -Wl,-Bdynamic)
+SHARED_LTO_SEARCH="LTO"
+case $host_os in
+    mingw*)
+      STATIC_LTO_EXTRA_LIBS="-ldbghelp -lpsapi"
+      SHARED_LTO_SEARCH="LTO"
+      AS_IF([test "x$enable_shared" = "xno"],
+            [AX_APPEND_COMPILE_FLAGS([--static-libgcc --static-libstdc++], LDFLAGS)])
+      ;;
+    linux*)
+      AS_IF([test "x$enable_shared" != "xno"],
+            [AX_APPEND_COMPILE_FLAGS([-Wl,--rpath,\\\$\$ORIGIN/../lib], LDFLAGS)])
+      ;;
+    darwin*)
+      AS_IF([test "x$enable_shared" != "xno"],
+            [AX_APPEND_COMPILE_FLAGS([-Wl,-rpath,@loader_path/../lib/], LDFLAGS)])
+      ;;
+esac
+
+if test "x${llvm_config}" != x; then
+    STATIC_LTO_LIBS="$(${llvm_config} --libs) -lLTO"
+else
+    STATIC_LTO_LIBS="-lCompilerDriver -lEnhancedDisassembly -lLLVMAlphaAsmPrinter -lLLVMAlphaCodeGen -lLLVMAlphaInfo -lLLVMAnalysis -lLLVMArchive -lLLVMARMAsmParser -lLLVMARMAsmPrinter -lLLVMARMCodeGen -lLLVMARMInfo -lLLVMAsmParser -lLLVMAsmPrinter -lLLVMBitReader -lLLVMBitWriter -lLLVMBlackfinAsmPrinter -lLLVMBlackfinCodeGen -lLLVMBlackfinInfo -lLLVMCBackend -lLLVMCBackendInfo -lLLVMCellSPUAsmPrinter -lLLVMCellSPUCodeGen -lLLVMCellSPUInfo -lLLVMCodeGen -lLLVMCore -lLLVMCppBackend -lLLVMCppBackendInfo -lLLVMExecutionEngine -lLLVMInstCombine -lLLVMInstrumentation -lLLVMInterpreter -lLLVMipa -lLLVMipo -lLLVMJIT -lLLVMLinker -lLLVMMBlazeAsmPrinter -lLLVMMBlazeCodeGen -lLLVMMBlazeInfo -lLLVMMC -lLLVMMCParser -lLLVMMipsAsmPrinter -lLLVMMipsCodeGen -lLLVMMipsInfo -lLLVMMSIL -lLLVMMSILInfo -lLLVMMSP430AsmPrinter -lLLVMMSP430CodeGen -lLLVMMSP430Info -lLLVMPIC16AsmPrinter -lLLVMPIC16CodeGen -lLLVMPIC16Info -lLLVMpic16passes -lLLVMPowerPCAsmPrinter -lLLVMPowerPCCodeGen -lLLVMPowerPCInfo -lLLVMScalarOpts -lLLVMSelectionDAG -lLLVMSparcAsmPrinter -lLLVMSparcCodeGen -lLLVMSparcInfo -lLLVMSupport -lLLVMSystem -lLLVMSystemZAsmPrinter -lLLVMSystemZCodeGen -lLLVMSystemZInfo -lLLVMTarget -lLLVMTransformUtils -lLLVMX86AsmParser -lLLVMX86AsmPrinter -lLLVMX86CodeGen -lLLVMX86Disassembler -lLLVMX86Info -lLLVMXCoreAsmPrinter -lLLVMXCoreCodeGen -lLLVMXCoreInfo -lLTO -lplugin_llvmc_Base -lplugin_llvmc_Clang -lUnitTestMain"
+fi
+
+AC_LANG_PUSH([C++])
+AS_IF([test "x$enable_shared" != "xno"],
+  [AC_CHECK_LIB([$SHARED_LTO_SEARCH],[lto_get_version],
+        [LTO_LIBS="$SHARED_LTO_LIBS"
+         LTO_DEFS="-DLTO_SUPPORT"]
+  )],
+  [AC_CHECK_LIB([$SHARED_LTO_SEARCH],[lto_get_version],
+        [LTO_LIBS="$LD_STATIC_GROUP_START $STATIC_LTO_LIBS $STATIC_LTO_EXTRA_LIBS $LD_STATIC_GROUP_END -lpthread"
+         LTO_DEFS="-DLTO_SUPPORT"]
+  )]
+)
+AC_LANG_POP([C++])
+
+AC_SUBST(LTO_LIBS)
+AC_SUBST(LTO_DEFS)
+
+# So tagged (zzz_and_finally) to ensure that this gets sorted last in config.h
+AH_VERBATIM([zzz_and_finally],[
+#include "emulated.h"
+
+#ifdef __UNUSED_NOT_DEFINED
+#define __unused __attribute__((__unused__))
+#endif
+])
+
+AC_CONFIG_FILES([Makefile include/Makefile libprunetrie/Makefile libstuff/Makefile libmacho/Makefile])
+AC_CONFIG_FILES([ar/Makefile])
+AC_CONFIG_FILES([as/Makefile])
+for ast in $ASTARGETS; do
+    case $ast in
+    ppc)
+    AC_CONFIG_FILES([as/ppc/Makefile:as/ppc/Makefile.in:as/Makefile.arch.in])
+    ;;
+    ppc64)
+    AC_CONFIG_FILES([as/ppc64/Makefile:as/ppc64/Makefile.in:as/Makefile.arch.in])
+    ;;
+    i386)
+    AC_CONFIG_FILES([as/i386/Makefile:as/i386/Makefile.in:as/Makefile.arch.in])
+    ;;
+    x86_64)
+    AC_CONFIG_FILES([as/x86_64/Makefile:as/x86_64/Makefile.in:as/Makefile.arch.in])
+    ;;
+    arm)
+    AC_CONFIG_FILES([as/arm/Makefile:as/arm/Makefile.in:as/Makefile.arch.in])
+    ;;
+    *)
+    AC_MSG_ERROR([Unrecognized assembler target $ast])
+    ;;
+    esac
+done
+
+AC_CONFIG_FILES([ld/Makefile])
+AC_CONFIG_FILES([ld64/Makefile])
+AC_CONFIG_FILES([man/Makefile])
+AC_CONFIG_FILES([misc/Makefile])
+AC_CONFIG_FILES([otool/Makefile])
+AC_OUTPUT
diff -urN a/include/CommonCrypto/CommonDigest.h.in b/include/CommonCrypto/CommonDigest.h.in
--- a/include/CommonCrypto/CommonDigest.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/CommonCrypto/CommonDigest.h.in	2013-11-18 23:05:40.221458998 +0000
@@ -0,0 +1,13 @@
+#ifndef COMMONDIGEST_H_INCLUDED
+#define COMMONDIGEST_H_INCLUDED
+
+#include <openssl/md5.h>
+
+#define CC_MD5               MD5
+#define CC_MD5_DIGEST_LENGTH MD5_DIGEST_LENGTH
+#define CC_MD5_CTX           MD5_CTX
+#define CC_MD5_Init          MD5_Init
+#define CC_MD5_Update        MD5_Update
+#define CC_MD5_Final         MD5_Final
+
+#endif /* COMMONDIGEST_H_INCLUDED */
diff -urN a/include/config.h.in b/include/config.h.in
--- a/include/config.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/config.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,455 @@
+/* include/config.h.in.  Generated from configure.ac by autoheader.  */
+
+/* Define if building universal (internal helper macro) */
+#undef AC_APPLE_UNIVERSAL_BUILD
+
+/* CPU_SUBTYPE_ARM_V5TEJ */
+#undef CPU_SUBTYPE_ARM_V5TEJ
+
+/* CPU_SUBTYPE_ARM_V7 */
+#undef CPU_SUBTYPE_ARM_V7
+
+/* CPU_SUBTYPE_ARM_XSCALE */
+#undef CPU_SUBTYPE_ARM_XSCALE
+
+/* filesystem root of cross build environment */
+#undef CROSS_SYSROOT
+
+/* CTL_KERN */
+#undef CTL_KERN
+
+/* EBADRPC */
+#undef EBADRPC
+
+/* EFTYPE */
+#undef EFTYPE
+
+/* Emulated CPU subtype */
+#undef EMULATED_HOST_CPU_SUBTYPE
+
+/* Emulated CPU type */
+#undef EMULATED_HOST_CPU_TYPE
+
+/* "Define executable extension" */
+#undef EXEEXT
+
+/* _S_IREAD|_S_IWRITE|_S_IEXEC */
+#undef FIO_MASK_ALL_4
+
+/* _S_IREAD|_S_IWRITE */
+#undef FIO_READ_WRITE
+
+/* _S_IREAD|_S_IWRITE|_S_IEXEC */
+#undef FIO_READ_WRITE_EXEC
+
+/* _S_IREAD|_S_IWRITE */
+#undef FIO_READ_WRITE_ME
+
+/* FP_CHOP */
+#undef FP_CHOP
+
+/* FP_PREC_24B */
+#undef FP_PREC_24B
+
+/* FP_PREC_53B */
+#undef FP_PREC_53B
+
+/* FP_PREC_64B */
+#undef FP_PREC_64B
+
+/* FP_RND_DOWN */
+#undef FP_RND_DOWN
+
+/* FP_RND_NEAR */
+#undef FP_RND_NEAR
+
+/* FP_RND_UP */
+#undef FP_RND_UP
+
+/* BSD-syle qsort_r */
+#undef HAVE_BSD_QSORT_R
+
+/* Define to 1 if you have the <CommonCrypto/CommonDigest.h> header file. */
+#undef HAVE_COMMONCRYPTO_COMMONDIGEST_H
+
+/* Define to 1 if you have the <configure.h> header file. */
+#undef HAVE_CONFIGURE_H
+
+/* Define to 1 if you have the declaration of `asprintf', and to 0 if you
+   don't. */
+#undef HAVE_DECL_ASPRINTF
+
+/* Define to 1 if you have the declaration of `backtrace', and to 0 if you
+   don't. */
+#undef HAVE_DECL_BACKTRACE
+
+/* Define to 1 if you have the declaration of `dladdr', and to 0 if you don't.
+   */
+#undef HAVE_DECL_DLADDR
+
+/* Define to 1 if you have the declaration of `dlclose', and to 0 if you
+   don't. */
+#undef HAVE_DECL_DLCLOSE
+
+/* Define to 1 if you have the declaration of `dlerror', and to 0 if you
+   don't. */
+#undef HAVE_DECL_DLERROR
+
+/* Define to 1 if you have the declaration of `dlopen', and to 0 if you don't.
+   */
+#undef HAVE_DECL_DLOPEN
+
+/* Define to 1 if you have the declaration of `dlsym', and to 0 if you don't.
+   */
+#undef HAVE_DECL_DLSYM
+
+/* Define to 1 if you have the declaration of `fchdir', and to 0 if you don't.
+   */
+#undef HAVE_DECL_FCHDIR
+
+/* Define to 1 if you have the declaration of `fchmod', and to 0 if you don't.
+   */
+#undef HAVE_DECL_FCHMOD
+
+/* Define to 1 if you have the declaration of `flock', and to 0 if you don't.
+   */
+#undef HAVE_DECL_FLOCK
+
+/* Define to 1 if you have the declaration of `getgid', and to 0 if you don't.
+   */
+#undef HAVE_DECL_GETGID
+
+/* Define to 1 if you have the declaration of `getuid', and to 0 if you don't.
+   */
+#undef HAVE_DECL_GETUID
+
+/* Define to 1 if you have the declaration of `index', and to 0 if you don't.
+   */
+#undef HAVE_DECL_INDEX
+
+/* Define to 1 if you have the declaration of `mkstemp', and to 0 if you
+   don't. */
+#undef HAVE_DECL_MKSTEMP
+
+/* Define to 1 if you have the declaration of `mmap', and to 0 if you don't.
+   */
+#undef HAVE_DECL_MMAP
+
+/* Define to 1 if you have the declaration of `pwrite', and to 0 if you don't.
+   */
+#undef HAVE_DECL_PWRITE
+
+/* Define to 1 if you have the declaration of `readlink', and to 0 if you
+   don't. */
+#undef HAVE_DECL_READLINK
+
+/* Define to 1 if you have the declaration of `realpath', and to 0 if you
+   don't. */
+#undef HAVE_DECL_REALPATH
+
+/* Define to 1 if you have the declaration of `rindex', and to 0 if you don't.
+   */
+#undef HAVE_DECL_RINDEX
+
+/* Define to 1 if you have the declaration of `sigfillset', and to 0 if you
+   don't. */
+#undef HAVE_DECL_SIGFILLSET
+
+/* Define to 1 if you have the declaration of `sigprocmask', and to 0 if you
+   don't. */
+#undef HAVE_DECL_SIGPROCMASK
+
+/* Define to 1 if you have the declaration of `sleep', and to 0 if you don't.
+   */
+#undef HAVE_DECL_SLEEP
+
+/* Define to 1 if you have the declaration of `strlcat', and to 0 if you
+   don't. */
+#undef HAVE_DECL_STRLCAT
+
+/* Define to 1 if you have the declaration of `strlcpy', and to 0 if you
+   don't. */
+#undef HAVE_DECL_STRLCPY
+
+/* Define to 1 if you have the declaration of `strmode', and to 0 if you
+   don't. */
+#undef HAVE_DECL_STRMODE
+
+/* Define to 1 if you have the declaration of `utimes', and to 0 if you don't.
+   */
+#undef HAVE_DECL_UTIMES
+
+/* Define to 1 if you have the declaration of `vm_msync', and to 0 if you
+   don't. */
+#undef HAVE_DECL_VM_MSYNC
+
+/* Define to 1 if you have the <dlfcn.h> header file. */
+#undef HAVE_DLFCN_H
+
+/* Define to 1 if you have the <err.h> header file. */
+#undef HAVE_ERR_H
+
+/* Define to 1 if you have the <execinfo.h> header file. */
+#undef HAVE_EXECINFO_H
+
+/* Define to 1 if you have the `getattrlist' function. */
+#undef HAVE_GETATTRLIST
+
+/* glibc-syle qsort_r */
+#undef HAVE_GLIBC_QSORT_R
+
+/* Define to 1 if you have the <inttypes.h> header file. */
+#undef HAVE_INTTYPES_H
+
+/* Define to 1 if you have the <libc.h> header file. */
+#undef HAVE_LIBC_H
+
+/* Define to 1 if you have the <malloc/malloc.h> header file. */
+#undef HAVE_MALLOC_MALLOC_H
+
+/* Define to 1 if you have the <memory.h> header file. */
+#undef HAVE_MEMORY_H
+
+/* Define to 1 if you have the `NSIsSymbolNameDefined' function. */
+#undef HAVE_NSISSYMBOLNAMEDEFINED
+
+/* Define to 1 if you have the <paths.h> header file. */
+#undef HAVE_PATHS_H
+
+/* Define to 1 if you have the `qsort' function. */
+#undef HAVE_QSORT
+
+/* Define to 1 if you have the `qsort_r' function. */
+#undef HAVE_QSORT_R
+
+/* Define to 1 if you have the <servers/bootstrap.h> header file. */
+#undef HAVE_SERVERS_BOOTSTRAP_H
+
+/* Define to 1 if you have the <stdint.h> header file. */
+#undef HAVE_STDINT_H
+
+/* Define to 1 if you have the <stdlib.h> header file. */
+#undef HAVE_STDLIB_H
+
+/* Define to 1 if you have the <strings.h> header file. */
+#undef HAVE_STRINGS_H
+
+/* Define to 1 if you have the <string.h> header file. */
+#undef HAVE_STRING_H
+
+/* Define to 1 if you have the `strlcat' function. */
+#undef HAVE_STRLCAT
+
+/* Define to 1 if you have the `strlcpy' function. */
+#undef HAVE_STRLCPY
+
+/* Define to 1 if you have the <sys/cdefs.h> header file. */
+#undef HAVE_SYS_CDEFS_H
+
+/* Define to 1 if you have the <sys/mman.h> header file. */
+#undef HAVE_SYS_MMAN_H
+
+/* Define to 1 if you have the <sys/stat.h> header file. */
+#undef HAVE_SYS_STAT_H
+
+/* Define to 1 if you have the <sys/sysctl.h> header file. */
+#undef HAVE_SYS_SYSCTL_H
+
+/* Define to 1 if you have the <sys/types.h> header file. */
+#undef HAVE_SYS_TYPES_H
+
+/* Define to 1 if you have the <sys/_endian.h> header file. */
+#undef HAVE_SYS__ENDIAN_H
+
+/* Define to 1 if you have the <tzfile.h> header file. */
+#undef HAVE_TZFILE_H
+
+/* Define to 1 if you have the <unistd.h> header file. */
+#undef HAVE_UNISTD_H
+
+/* Define to 1 if you have the `_NSGetExecutablePath' function. */
+#undef HAVE__NSGETEXECUTABLEPATH
+
+/* KERN_OSRELEASE */
+#undef KERN_OSRELEASE
+
+/* Define MIN(_a,_b) to `(((_a)<(_b))?(_a):(_b))' */
+#undef MIN
+
+/* need BSD-style qsort_r */
+#undef NEED_BSD_QSORT_R
+
+/* CPU_SUBTYPE_ARM_V7 */
+#undef N_ARM_THUMB_DEF
+
+/* Windows-specific open() flag to disable text mode */
+#undef O_BINARY
+
+/* Define to the address where bug reports for this package should be sent. */
+#undef PACKAGE_BUGREPORT
+
+/* Define to the full name of this package. */
+#undef PACKAGE_NAME
+
+/* Define to the full name and version of this package. */
+#undef PACKAGE_STRING
+
+/* Define to the one symbol short name of this package. */
+#undef PACKAGE_TARNAME
+
+/* Define to the home page for this package. */
+#undef PACKAGE_URL
+
+/* Define to the version of this package. */
+#undef PACKAGE_VERSION
+
+/* SIGHUP */
+#undef SIGHUP
+
+/* SIGPIPE */
+#undef SIGPIPE
+
+/* Define to 1 if you have the ANSI C header files. */
+#undef STDC_HEADERS
+
+/* 0120000 */
+#undef S_IFLNK
+
+/* 0140000 */
+#undef S_IFSOCK
+
+/* 00040 */
+#undef S_IRGRP
+
+/* 00004 */
+#undef S_IROTH
+
+/* 0002000 */
+#undef S_ISGID
+
+/* 0004000 */
+#undef S_ISUID
+
+/* 0001000 */
+#undef S_ISVTX
+
+/* 00020 */
+#undef S_IWGRP
+
+/* 00002 */
+#undef S_IWOTH
+
+/* 00010 */
+#undef S_IXGRP
+
+/* 00001 */
+#undef S_IXOTH
+
+/* ULLONG_MAX */
+#undef ULLONG_MAX
+
+/* Enable extensions on AIX 3, Interix.  */
+#ifndef _ALL_SOURCE
+# undef _ALL_SOURCE
+#endif
+/* Enable GNU extensions on systems that have them.  */
+#ifndef _GNU_SOURCE
+# undef _GNU_SOURCE
+#endif
+/* Enable threading extensions on Solaris.  */
+#ifndef _POSIX_PTHREAD_SEMANTICS
+# undef _POSIX_PTHREAD_SEMANTICS
+#endif
+/* Enable extensions on HP NonStop.  */
+#ifndef _TANDEM_SOURCE
+# undef _TANDEM_SOURCE
+#endif
+/* Enable general extensions on Solaris.  */
+#ifndef __EXTENSIONS__
+# undef __EXTENSIONS__
+#endif
+
+
+/* Define WORDS_BIGENDIAN to 1 if your processor stores words with the most
+   significant byte first (like Motorola and SPARC, unlike Intel). */
+#if defined AC_APPLE_UNIVERSAL_BUILD
+# if defined __BIG_ENDIAN__
+#  define WORDS_BIGENDIAN 1
+# endif
+#else
+# ifndef WORDS_BIGENDIAN
+#  undef WORDS_BIGENDIAN
+# endif
+#endif
+
+/* Define to 1 if on MINIX. */
+#undef _MINIX
+
+/* Define to 2 if the system does not provide POSIX.1 features except with
+   this defined. */
+#undef _POSIX_1_SOURCE
+
+/* Define to 1 if you need to in order for `stat' and other things to work. */
+#undef _POSIX_SOURCE
+
+/* __unused macro to save some typing */
+#undef __UNUSED_NOT_DEFINED
+
+/* $PRIVEXT_DESC */
+#undef __private_extern__
+
+/* memcmp will suffice */
+#undef bcmp
+
+/* memmove will suffice */
+#undef bcopy
+
+/* memset will suffice */
+#undef bzero
+
+/* Define to `char *' if not defined. */
+#undef caddr_t
+
+/* Define to `Dl_info' */
+#undef dl_info
+
+/* __builtin_ffs will suffice */
+#undef ffs
+
+/* getc will suffice */
+#undef getc_unlocked
+
+/* getcwd will suffice */
+#undef getwd
+
+/* Define to `int' if <sys/types.h> doesn't define. */
+#undef gid_t
+
+/* not needed */
+#undef setbuffer
+
+/* Define to `int32_t' if not defined. */
+#undef sigset_t
+
+/* Define to `uint32_t' */
+#undef u_char
+
+/* Define to `unsigned int' */
+#undef u_int
+
+/* Define to `uint32_t' */
+#undef u_int32_t
+
+/* Define to `unsigned short' */
+#undef u_short
+
+/* Define to `int' if <sys/types.h> doesn't define. */
+#undef uid_t
+
+
+#include "emulated.h"
+
+#ifdef __UNUSED_NOT_DEFINED
+#define __unused __attribute__((__unused__))
+#endif
+
diff -urN a/include/configure.h.in b/include/configure.h.in
--- a/include/configure.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/configure.h.in	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,4 @@
+#ifndef FAKE_CONFIGURE_H_INCLUDED
+#define FAKE_CONFIGURE_H_INCLUDED
+
+#endif /* FAKE_CONFIGURE_H_INCLUDED */
diff -urN a/include/dlfcn.h.in b/include/dlfcn.h.in
--- a/include/dlfcn.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/dlfcn.h.in	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,27 @@
+#ifndef FAKE_DLFCN_H_INCLUDED
+#define FAKE_DLFCN_H_INCLUDED
+
+#ifdef __cplusplus
+extern "C"
+{
+#endif
+
+typedef struct
+{
+    const char *dli_fname;
+    void       *dli_fbase;
+    const char *dli_sname;
+    void       *dli_saddr;
+} Dl_info;
+
+#define RTLD_LAZY 0
+#define RTLD_NOW 1
+
+typedef Dl_info dyldInfo;
+typedef Dl_info dl_info;
+
+#ifdef __cplusplus
+}
+#endif
+
+#endif /* FAKE_DLFCN_H_INCLUDED */
diff -urN a/include/emulated.h b/include/emulated.h
--- a/include/emulated.h	1970-01-01 01:00:00.000000000 +0100
+++ b/include/emulated.h	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,179 @@
+#ifndef EMULATED_H_INCLUDED
+#define EMULATED_H_INCLUDED
+
+#ifdef __cplusplus
+# include <cstddef>
+#else
+# include <stddef.h>
+#endif /* __cplusplus */
+
+#ifdef __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+#if (HAVE_DECL_SLEEP==0)
+unsigned int __cdecl sleep (unsigned int _Duration);
+#endif /* HAVE_DECL_SLEEP */
+
+/*
+The following 2 includes *were* inside the
+#if (HAVE_DECL_MMAP==0) block. This change
+(and also libc.h not including  sys/stat.h)
+are because '__unused' is a define used in
+a single Apple header and Linux x86-64 uses
+an array called '__unused' in stat.h. It will
+be cleaner to instead remove __unused from
+the Apple header and then never worry about it
+again. Once done, we must also remove all the
+autoconf logic responsible for checing and
+defining __unused.
+*/
+
+#include <sys/stat.h>
+#include <unistd.h>
+
+#if (HAVE_DECL_MMAP==0)
+#define PROT_READ 0
+#define PROT_WRITE 0
+#define MAP_FILE 0
+#define MAP_PRIVATE 0
+#define O_FSYNC 0
+#define MAXNAMLEN 255
+#define DEFFILEMODE (0666)
+#define L_SET SEEK_SET
+void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset);
+int munmap(void *start, size_t length);
+#endif /* HAVE_DECL_MMAP */
+
+#if (HAVE_FLOCK==0)
+#define LOCK_EX 2
+#define LOCK_NB 4
+#define EOVERFLOW 75
+#define ESTALE 116
+#define ENOTSUP 95
+#define EHOSTUNREACH 113
+int flock (int __fd, int __operation);
+#endif /* HAVE_FLOCK */
+
+#if (HAVE_DECL_GETUID==0)
+uid_t getuid(void);
+#endif /* HAVE_DECL_GETUID */
+
+#if (HAVE_DECL_GETUID==0)
+gid_t getgid(void);
+#endif /* HAVE_DECL_GETGID */
+
+#if (HAVE_DECL_RINDEX==0)
+char *rindex(const char *s, int c);
+#endif /* HAVE_DECL_RINDEX */
+
+#if (HAVE_DECL_INDEX==0)
+char *index(const char *s, int c);
+#endif /* HAVE_DECL_INDEX */
+
+#if (HAVE_DECL_STRMODE==0)
+void strmode(int mode, char *p);
+#endif /* HAVE_DECL_STRMODE */
+
+#if (HAVE_DECL_MKSTEMP==0)
+int mkstemp(char *tmplate);
+#endif /* HAVE_DECL_MKSTEMP */
+
+#if (HAVE_DECL_SIGFILLSET==0)
+#define SIG_BLOCK 0
+#define SIG_SETMASK 0
+int sigfillset (sigset_t *__set);
+#endif /* HAVE_DECL_SIGFILLSET */
+
+#if (HAVE_DECL_SIGPROCMASK==0)
+int sigprocmask (int __how, __const sigset_t * __set, sigset_t * __oset);
+#endif /* HAVE_DECL_SIGPROCMASK */
+
+#if (HAVE_DECL_FCHMOD==0)
+int fchmod(int fildes, mode_t mode);
+#endif /* HAVE_DECL_FCHMOD */
+
+#if (HAVE_DECL_FCHDIR==0)
+int fchdir(int fildes);
+#endif /* HAVE_DECL_FCHDIR */
+
+#if (HAVE_DECL_UTIMES==0)
+#include <sys/time.h>
+int utimes(const char *filename, const struct timeval times[2]);
+#endif /* HAVE_DECL_UTIMES */
+
+#if (HAVE_DECL_DLOPEN==0)
+void *dlopen(const char* file, int mode);
+#endif /* HAVE_DECL_DLOPEN */
+
+#if (HAVE_DECL_DLSYM==0)
+void *dlsym(void* handle, const char* name);
+#endif /* HAVE_DECL_DLSYM */
+
+#if (HAVE_DECL_DLCLOSE==0)
+#include <dlfcn.h>
+int dlclose(void* handle);
+int dladdr(void *addr, Dl_info *info);
+#endif /* HAVE_DECL_DLCLOSE */
+
+#if (HAVE_DECL_DLERROR==0)
+const char *dlerror(void);
+#endif /* HAVE_DECL_DLERROR */
+
+#if (HAVE_DECL_ASPRINTF==0)
+int asprintf( char **sptr, char *fmt, ... );
+#endif /* HAVE_DECL_ASPRINTF */
+
+#if (HAVE_DECL_BACKTRACE==0)
+int backtrace(void **__array, int __size);
+#endif /* HAVE_DECL_BACKTRACE */
+
+#if (HAVE_DECL_PWRITE==0)
+ssize_t pwrite(int fd, const void *buf, size_t count, off_t offset);
+#endif /* HAVE_DECL_PWRITE */
+
+#ifdef NEED_BSD_QSORT_R
+void qsort_r(void *base, size_t nmemb, size_t size, void *thunk, int (*compar)(void *, const void *, const void *));
+#define HAVE_BSD_QSORT_R
+#endif /* NEED_BSD_QSORT_R */
+
+/* if 0 because include/mach-o/dyld.h:240 also declares _NSGetExecutablePath */
+#if 0 && !defined(HAVE__NSGETEXECUTABLEPATH)
+#include <stdint.h>
+int _NSGetExecutablePath(char* buf, unsigned long* bufsize);
+#endif /* HAVE__NSGETEXECUTABLEPATH */
+
+#if (HAVE_DECL_REALPATH==0)
+char *realpath(const char *path, char *resolved);
+#endif /* HAVE_DECL_REALPATH */
+
+#ifndef HAVE_STRLCPY
+size_t strlcpy(char *dst, const char *src, size_t siz);
+#endif /* HAVE_STRLCPY */
+
+#ifndef HAVE_STRLCAT
+size_t strlcat(char *dst, const char *src, size_t siz);
+#endif /* HAVE_STRLCAT */
+
+#if (HAVE_GETATTRLIST==0)
+int getattrlist(const char* a, void* b, void* c, size_t d, unsigned int e);
+#endif /* HAVE_DECL_GETATTRLIST */
+
+/*
+kern_return_t mach_timebase_info( mach_timebase_info_t info);
+char* mach_error_string(mach_error_t error_value);
+mach_port_t mach_host_self(void);
+kern_return_t host_info(host_t host, host_flavor_t flavor, host_info_t host_info_out, mach_msg_type_number_t *host_info_outCnt);
+kern_return_t mach_port_deallocate(ipc_space_t task, mach_port_name_t name);
+kern_return_t vm_allocate(vm_map_t target_task, vm_address_t *address, vm_size_t size, int flags);
+kern_return_t vm_deallocate(vm_map_t target_task, vm_address_t address, vm_size_t size);
+kern_return_t host_statistics(host_t host_priv, host_flavor_t flavor, host_info_t host_info_out, mach_msg_type_number_t *host_info_outCnt);
+kern_return_t map_fd(int fd, vm_offset_t offset, vm_offset_t *va, boolean_t findspace, vm_size_t size);
+uint64_t mach_absolute_time(void);
+*/
+
+#ifdef __cplusplus
+}
+#endif /* __cplusplus */
+
+#endif /* EMULATED_H_INCLUDED */
diff -urN a/include/err.h.in b/include/err.h.in
--- a/include/err.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/err.h.in	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,28 @@
+#ifndef ERR_H_INCLUDED
+#define ERR_H_INCLUDED
+
+#include <stdlib.h>
+
+#define warn(...) do {                 \
+        fprintf (stderr, __VA_ARGS__); \
+        fprintf (stderr, "\n");        \
+} while (0)
+
+#define warnx(...) do {                \
+        fprintf (stderr, __VA_ARGS__); \
+        fprintf (stderr, "\n");        \
+} while (0)
+
+#define err(code, ...) do {            \
+        fprintf (stderr, __VA_ARGS__); \
+        fprintf (stderr, "\n");        \
+        exit (code);                   \
+} while (0)
+
+#define errx(code, ...) do {           \
+        fprintf (stderr, __VA_ARGS__); \
+        fprintf (stderr, "\n");        \
+        exit (code);                   \
+} while (0)
+
+#endif /* ERR_H_INCLUDED */
diff -urN a/include/execinfo.h.in b/include/execinfo.h.in
--- a/include/execinfo.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/execinfo.h.in	2013-11-18 23:05:40.225458948 +0000
@@ -0,0 +1,4 @@
+#ifndef EXECINFO_H_INCLUDED
+#define EXECINFO_H_INCLUDED
+
+#endif /* EXECINFO_H_INCLUDED */
diff -urN a/include/extern.h b/include/extern.h
--- a/include/extern.h	1970-01-01 01:00:00.000000000 +0100
+++ b/include/extern.h	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,26 @@
+/*
+   These includes are needed by all .cpp
+   files as they don't include libc
+*/
+
+/*
+   For *printf and strcmp
+*/
+#if defined(__linux__)
+# include <stdio.h>
+# include <string.h>
+#elif defined(__MINGW32__)
+# include <stdio.h>
+# include <string.h>
+#endif
+
+/*
+   For PATH_MAX, MAXPATHLEN, va_*
+*/
+#if !defined(__APPLE__)
+# include <limits.h>
+# include <sys/param.h>
+# include <stdarg.h>
+#endif
+
+#include <sys/sysctl.h>
diff -urN a/include/libc_cxx.h.in b/include/libc_cxx.h.in
--- a/include/libc_cxx.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/libc_cxx.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,26 @@
+/*
+   These includes are needed by all .cpp
+   files as they don't include libc
+*/
+
+/*
+   For *printf and strcmp
+*/
+#if defined(__linux__)
+# include <stdio.h>
+# include <string.h>
+#elif defined(__MINGW32__)
+# include <stdio.h>
+# include <string.h>
+#endif
+
+/*
+   For PATH_MAX, MAXPATHLEN, va_*
+*/
+#if !defined(__APPLE__)
+# include <limits.h>
+# include <sys/param.h>
+# include <stdarg.h>
+#endif
+
+#include <sys/sysctl.h>
diff -urN a/include/libc.h.in b/include/libc.h.in
--- a/include/libc.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/libc.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,24 @@
+#ifndef FAKE_LIBC_H_INCLUDED
+#define FAKE_LIBC_H_INCLUDED
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <fcntl.h>
+#include <sys/param.h>
+#include <string.h>
+#include <stdint.h>
+
+#ifdef __linux__
+ /* - see comment in emulated.h
+ #include <sys/stat.h>
+ */
+ #include <time.h>
+ #include <unistd.h>
+#endif
+
+#ifdef __MINGW32__
+ #include <io.h>
+ #include <malloc.h>
+#endif
+
+#endif /* FAKE_LIBC_H_INCLUDED */
diff -urN a/include/mach-o/arch-install.h b/include/mach-o/arch-install.h
--- a/include/mach-o/arch-install.h	1970-01-01 01:00:00.000000000 +0100
+++ b/include/mach-o/arch-install.h	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,110 @@
+/*
+ * Copyright (c) 1999 Apple Computer, Inc. All rights reserved.
+ *
+ * @APPLE_LICENSE_HEADER_START@
+ * 
+ * This file contains Original Code and/or Modifications of Original Code
+ * as defined in and that are subject to the Apple Public Source License
+ * Version 2.0 (the 'License'). You may not use this file except in
+ * compliance with the License. Please obtain a copy of the License at
+ * http://www.opensource.apple.com/apsl/ and read it before using this
+ * file.
+ * 
+ * The Original Code and all software distributed under the License are
+ * distributed on an 'AS IS' basis, WITHOUT WARRANTY OF ANY KIND, EITHER
+ * EXPRESS OR IMPLIED, AND APPLE HEREBY DISCLAIMS ALL SUCH WARRANTIES,
+ * INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
+ * FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
+ * Please see the License for the specific language governing rights and
+ * limitations under the License.
+ * 
+ * @APPLE_LICENSE_HEADER_END@
+ */
+#ifndef _MACH_O_ARCH_H_
+#define _MACH_O_ARCH_H_
+/*
+ * Copyright (c) 1997 Apple Computer, Inc.
+ *
+ * Functions that deal with information about architectures.
+ *
+ */
+
+#include <stdint.h>
+#include <mach-o/machine.h>
+
+enum NXByteOrder {
+  NX_UnknownByteOrder,
+  NX_LittleEndian,
+  NX_BigEndian
+};
+
+/* The NXArchInfo structs contain the architectures symbolic name
+ * (such as "ppc"), its CPU type and CPU subtype as defined in
+ * mach/machine.h, the byte order for the architecture, and a
+ * describing string (such as "PowerPC").
+ * There will both be entries for specific CPUs (such as ppc604e) as
+ * well as generic "family" entries (such as ppc).
+ */
+typedef struct {
+    const char *name;
+    cpu_type_t cputype;
+    cpu_subtype_t cpusubtype;
+    enum NXByteOrder byteorder;
+    const char *description;
+} NXArchInfo;
+
+#if __cplusplus
+extern "C" {
+#endif /* __cplusplus */
+
+/* NXGetAllArchInfos() returns a pointer to an array of all known
+ * NXArchInfo structures.  The last NXArchInfo is marked by a NULL name.
+ */
+extern const NXArchInfo *NXGetAllArchInfos(void);
+
+/* NXGetLocalArchInfo() returns the NXArchInfo for the local host, or NULL
+ * if none is known. 
+ */
+extern const NXArchInfo *NXGetLocalArchInfo(void);
+
+/* NXGetArchInfoFromName() and NXGetArchInfoFromCpuType() return the
+ * NXArchInfo from the architecture's name or cputype/cpusubtype
+ * combination.  A cpusubtype of CPU_SUBTYPE_MULTIPLE can be used
+ * to request the most general NXArchInfo known for the given cputype.
+ * NULL is returned if no matching NXArchInfo can be found.
+ */
+extern const NXArchInfo *NXGetArchInfoFromName(const char *name);
+extern const NXArchInfo *NXGetArchInfoFromCpuType(cpu_type_t cputype,
+						  cpu_subtype_t cpusubtype);
+
+/* NXFindBestFatArch() is passed a cputype and cpusubtype and a set of
+ * fat_arch structs and selects the best one that matches (if any) and returns
+ * a pointer to that fat_arch struct (or NULL).  The fat_arch structs must be
+ * in the host byte order and correct such that the fat_archs really points to
+ * enough memory for nfat_arch structs.  It is possible that this routine could
+ * fail if new cputypes or cpusubtypes are added and an old version of this
+ * routine is used.  But if there is an exact match between the cputype and
+ * cpusubtype and one of the fat_arch structs this routine will always succeed.
+ */
+extern struct fat_arch *NXFindBestFatArch(cpu_type_t cputype,
+					  cpu_subtype_t cpusubtype,
+					  struct fat_arch *fat_archs,
+					  uint32_t nfat_archs);
+
+/* NXCombineCpuSubtypes() returns the resulting cpusubtype when combining two
+ * different cpusubtypes for the specified cputype.  If the two cpusubtypes
+ * can't be combined (the specific subtypes are mutually exclusive) -1 is
+ * returned indicating it is an error to combine them.  This can also fail and
+ * return -1 if new cputypes or cpusubtypes are added and an old version of
+ * this routine is used.  But if the cpusubtypes are the same they can always
+ * be combined and this routine will return the cpusubtype pass in.
+ */
+extern cpu_subtype_t NXCombineCpuSubtypes(cpu_type_t cputype,
+					  cpu_subtype_t cpusubtype1,
+					  cpu_subtype_t cpusubtype2);
+
+#if __cplusplus
+};
+#endif /* __cplusplus */
+
+#endif /* _MACH_O_ARCH_H_ */
diff -urN a/include/Makefile.in b/include/Makefile.in
--- a/include/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/Makefile.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,33 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix	= @prefix@
+exec_prefix	= @exec_prefix@
+mandir		= @mandir@
+includedir	= @includedir@
+datarootdir     = @datarootdir@
+VPATH = @srcdir@
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA	= @INSTALL_DATA@
+
+.PHONY: default install clean distclean
+
+default:
+
+install:
+	mkdir -p $(DESTDIR)$(includedir)
+	mkdir -p $(DESTDIR)$(includedir)/mach-o
+	for h in loader.h fat.h; do		\
+		$(INSTALL_DATA) $(srcdir)/mach-o/$$h		\
+			$(DESTDIR)$(includedir)/mach-o/$$h;	\
+	done
+	$(INSTALL_DATA) $(srcdir)/mach-o/arch-install.h \
+		$(DESTDIR)$(includedir)/mach-o/arch.h
+	$(INSTALL_DATA) $(srcdir)/mach/machine.h \
+		$(DESTDIR)$(includedir)/mach-o/
+
+clean:
diff -urN a/include/malloc/malloc.h.in b/include/malloc/malloc.h.in
--- a/include/malloc/malloc.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/malloc/malloc.h.in	2013-11-18 23:05:40.225458948 +0000
@@ -0,0 +1,4 @@
+#ifndef FAKE_MALLOC_H_INCLUDED
+#define FAKE_MALLOC_H_INCLUDED
+
+#endif /* FAKE_MALLOC_H_INCLUDED */
diff -urN a/include/paths.h.in b/include/paths.h.in
--- a/include/paths.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/paths.h.in	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,4 @@
+#ifndef FAKE_PATHS_H_INCLUDED
+#define FAKE_PATHS_H_INCLUDED
+
+#endif /* FAKE_PATHS_H_INCLUDED */
diff -urN a/include/servers/bootstrap.h.in b/include/servers/bootstrap.h.in
--- a/include/servers/bootstrap.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/servers/bootstrap.h.in	2013-11-18 23:05:40.221458998 +0000
@@ -0,0 +1,4 @@
+#ifndef FAKE_SERVER_BOOTSTRAP_H_INCLUDED
+#define FAKE_SERVER_BOOTSTRAP_H_INCLUDED
+
+#endif /* FAKE_SERVER_BOOTSTRAP_H_INCLUDED */
diff -urN a/include/sys/cdefs.h.in b/include/sys/cdefs.h.in
--- a/include/sys/cdefs.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/sys/cdefs.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,14 @@
+#ifndef SYS_CDEFS_H_INCLUDED
+#define SYS_CDEFS_H_INCLUDED
+
+#ifdef __cplusplus
+ #define __BEGIN_DECLS extern "C" {
+ #define __END_DECLS }
+#else
+ #define __BEGIN_DECLS
+ #define __END_DECLS
+#endif
+
+#define	__P(protos) protos
+
+#endif /* SYS_CDEFS_H_INCLUDED */
diff -urN a/include/sys/_endian.h.in b/include/sys/_endian.h.in
--- a/include/sys/_endian.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/sys/_endian.h.in	2013-11-18 23:05:40.233458847 +0000
@@ -0,0 +1,14 @@
+#ifndef SYS__ENDIAN_H_INCLUDED
+#define SYS__ENDIAN_H_INCLUDED
+
+#define HTONS(_h) (((((uint16_t)(_h) & 0xff)) << 8)  | (((uint16_t)(_h) & 0xff00) >> 8))
+#define NTOHS(_n) (((((uint16_t)(_n) & 0xff)) << 8)  | (((uint16_t)(_n) & 0xff00) >> 8))
+#define HTONL(_h) (((((uint32_t)(_h) & 0xff)) << 24) | ((((uint32_t)(_h) & 0xff00)) << 8) | ((((uint32_t)(_h) & 0xff0000)) >> 8) | ((((uint32_t)(_h) & 0xff000000)) >> 24))
+#define NTOHL(_h) (((((uint32_t)(_n) & 0xff)) << 24) | ((((uint32_t)(_n) & 0xff00)) << 8) | ((((uint32_t)(_n) & 0xff0000)) >> 8) | ((((uint32_t)(_n) & 0xff000000)) >> 24))
+
+#define htons(_h) HTONS(_h)
+#define ntohs(_n) NTOHS(_n)
+#define htonl(_h) HTONL(_h)
+#define ntohl(_n) NTOHL(_n)
+
+#endif /* SYS__ENDIAN_H_INCLUDED */
diff -urN a/include/sys/mman.h.in b/include/sys/mman.h.in
--- a/include/sys/mman.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/sys/mman.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,4 @@
+#ifndef SYS_MMAN_H_INCLUDED
+#define SYS_MMAN_H_INCLUDED
+
+#endif /* SYS_MMAN_H_INCLUDED */
diff -urN a/include/sys/sysctl.h.in b/include/sys/sysctl.h.in
--- a/include/sys/sysctl.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/sys/sysctl.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,4 @@
+#ifndef SYS_SYSCTL_H_INCLUDED
+#define SYS_SYSCTL_H_INCLUDED
+
+#endif /* SYS_SYSCTL_H_INCLUDED */
diff -urN a/include/tzfile.h.in b/include/tzfile.h.in
--- a/include/tzfile.h.in	1970-01-01 01:00:00.000000000 +0100
+++ b/include/tzfile.h.in	2013-11-18 23:05:40.229458897 +0000
@@ -0,0 +1,4 @@
+#ifndef FAKE_TZFILE_H_INCLUDED
+#define FAKE_TZFILE_H_INCLUDED
+
+#endif /* FAKE_TZFLIE_H_INCLUDED */
diff -urN a/install-sh b/install-sh
--- a/install-sh	1970-01-01 01:00:00.000000000 +0100
+++ b/install-sh	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,276 @@
+#!/bin/sh
+#
+# install - install a program, script, or datafile
+# This comes from X11R5 (mit/util/scripts/install.sh).
+#
+# Copyright 1991 by the Massachusetts Institute of Technology
+#
+# Permission to use, copy, modify, distribute, and sell this software and its
+# documentation for any purpose is hereby granted without fee, provided that
+# the above copyright notice appear in all copies and that both that
+# copyright notice and this permission notice appear in supporting
+# documentation, and that the name of M.I.T. not be used in advertising or
+# publicity pertaining to distribution of the software without specific,
+# written prior permission.  M.I.T. makes no representations about the
+# suitability of this software for any purpose.  It is provided "as is"
+# without express or implied warranty.
+#
+# Calling this script install-sh is preferred over install.sh, to prevent
+# `make' implicit rules from creating a file called install from it
+# when there is no Makefile.
+#
+# This script is compatible with the BSD install script, but was written
+# from scratch.  It can only install one file at a time, a restriction
+# shared with many OS's install programs.
+
+
+# set DOITPROG to echo to test this script
+
+# Don't use :- since 4.3BSD and earlier shells don't like it.
+doit="${DOITPROG-}"
+
+
+# put in absolute paths if you don't have them in your path; or use env. vars.
+
+mvprog="${MVPROG-mv}"
+cpprog="${CPPROG-cp}"
+chmodprog="${CHMODPROG-chmod}"
+chownprog="${CHOWNPROG-chown}"
+chgrpprog="${CHGRPPROG-chgrp}"
+stripprog="${STRIPPROG-strip}"
+rmprog="${RMPROG-rm}"
+mkdirprog="${MKDIRPROG-mkdir}"
+
+transformbasename=""
+transform_arg=""
+instcmd="$mvprog"
+chmodcmd="$chmodprog 0755"
+chowncmd=""
+chgrpcmd=""
+stripcmd=""
+rmcmd="$rmprog -f"
+mvcmd="$mvprog"
+src=""
+dst=""
+dir_arg=""
+
+while [ x"$1" != x ]; do
+    case $1 in
+	-c) instcmd=$cpprog
+	    shift
+	    continue;;
+
+	-d) dir_arg=true
+	    shift
+	    continue;;
+
+	-m) chmodcmd="$chmodprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-o) chowncmd="$chownprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-g) chgrpcmd="$chgrpprog $2"
+	    shift
+	    shift
+	    continue;;
+
+	-s) stripcmd=$stripprog
+	    shift
+	    continue;;
+
+	-t=*) transformarg=`echo $1 | sed 's/-t=//'`
+	    shift
+	    continue;;
+
+	-b=*) transformbasename=`echo $1 | sed 's/-b=//'`
+	    shift
+	    continue;;
+
+	*)  if [ x"$src" = x ]
+	    then
+		src=$1
+	    else
+		# this colon is to work around a 386BSD /bin/sh bug
+		:
+		dst=$1
+	    fi
+	    shift
+	    continue;;
+    esac
+done
+
+if [ x"$src" = x ]
+then
+	echo "$0: no input file specified" >&2
+	exit 1
+else
+	:
+fi
+
+if [ x"$dir_arg" != x ]; then
+	dst=$src
+	src=""
+
+	if [ -d "$dst" ]; then
+		instcmd=:
+		chmodcmd=""
+	else
+		instcmd=$mkdirprog
+	fi
+else
+
+# Waiting for this to be detected by the "$instcmd $src $dsttmp" command
+# might cause directories to be created, which would be especially bad
+# if $src (and thus $dsttmp) contains '*'.
+
+	if [ -f "$src" ] || [ -d "$src" ]
+	then
+		:
+	else
+		echo "$0: $src does not exist" >&2
+		exit 1
+	fi
+
+	if [ x"$dst" = x ]
+	then
+		echo "$0: no destination specified" >&2
+		exit 1
+	else
+		:
+	fi
+
+# If destination is a directory, append the input filename; if your system
+# does not like double slashes in filenames, you may need to add some logic
+
+	if [ -d "$dst" ]
+	then
+		dst=$dst/`basename "$src"`
+	else
+		:
+	fi
+fi
+
+## this sed command emulates the dirname command
+dstdir=`echo "$dst" | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
+
+# Make sure that the destination directory exists.
+#  this part is taken from Noah Friedman's mkinstalldirs script
+
+# Skip lots of stat calls in the usual case.
+if [ ! -d "$dstdir" ]; then
+defaultIFS='
+	'
+IFS="${IFS-$defaultIFS}"
+
+oIFS=$IFS
+# Some sh's can't handle IFS=/ for some reason.
+IFS='%'
+set - `echo "$dstdir" | sed -e 's@/@%@g' -e 's@^%@/@'`
+IFS=$oIFS
+
+pathcomp=''
+
+while [ $# -ne 0 ] ; do
+	pathcomp=$pathcomp$1
+	shift
+
+	if [ ! -d "$pathcomp" ] ;
+        then
+		$mkdirprog "$pathcomp"
+	else
+		:
+	fi
+
+	pathcomp=$pathcomp/
+done
+fi
+
+if [ x"$dir_arg" != x ]
+then
+	$doit $instcmd "$dst" &&
+
+	if [ x"$chowncmd" != x ]; then $doit $chowncmd "$dst"; else : ; fi &&
+	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd "$dst"; else : ; fi &&
+	if [ x"$stripcmd" != x ]; then $doit $stripcmd "$dst"; else : ; fi &&
+	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd "$dst"; else : ; fi
+else
+
+# If we're going to rename the final executable, determine the name now.
+
+	if [ x"$transformarg" = x ]
+	then
+		dstfile=`basename "$dst"`
+	else
+		dstfile=`basename "$dst" $transformbasename |
+			sed $transformarg`$transformbasename
+	fi
+
+# don't allow the sed command to completely eliminate the filename
+
+	if [ x"$dstfile" = x ]
+	then
+		dstfile=`basename "$dst"`
+	else
+		:
+	fi
+
+# Make a couple of temp file names in the proper directory.
+
+	dsttmp=$dstdir/#inst.$$#
+	rmtmp=$dstdir/#rm.$$#
+
+# Trap to clean up temp files at exit.
+
+	trap 'status=$?; rm -f "$dsttmp" "$rmtmp" && exit $status' 0
+	trap '(exit $?); exit' 1 2 13 15
+
+# Move or copy the file name to the temp name
+
+	$doit $instcmd "$src" "$dsttmp" &&
+
+# and set any options; do chmod last to preserve setuid bits
+
+# If any of these fail, we abort the whole thing.  If we want to
+# ignore errors from any of these, just make sure not to ignore
+# errors from the above "$doit $instcmd $src $dsttmp" command.
+
+	if [ x"$chowncmd" != x ]; then $doit $chowncmd "$dsttmp"; else :;fi &&
+	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd "$dsttmp"; else :;fi &&
+	if [ x"$stripcmd" != x ]; then $doit $stripcmd "$dsttmp"; else :;fi &&
+	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd "$dsttmp"; else :;fi &&
+
+# Now remove or move aside any old file at destination location.  We try this
+# two ways since rm can't unlink itself on some systems and the destination
+# file might be busy for other reasons.  In this case, the final cleanup
+# might fail but the new file should still install successfully.
+
+{
+	if [ -f "$dstdir/$dstfile" ]
+	then
+		$doit $rmcmd -f "$dstdir/$dstfile" 2>/dev/null ||
+		$doit $mvcmd -f "$dstdir/$dstfile" "$rmtmp" 2>/dev/null ||
+		{
+		  echo "$0: cannot unlink or rename $dstdir/$dstfile" >&2
+		  (exit 1); exit
+		}
+	else
+		:
+	fi
+} &&
+
+# Now rename the file to the real destination.
+
+	$doit $mvcmd "$dsttmp" "$dstdir/$dstfile"
+
+fi &&
+
+# The final little trick to "correctly" pass the exit status to the exit trap.
+
+{
+	(exit 0); exit
+}
diff -urN a/ld/Makefile.in b/ld/Makefile.in
--- a/ld/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/ld/Makefile.in	2013-11-18 23:05:40.197459300 +0000
@@ -0,0 +1,72 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix		= @prefix@
+exec_prefix	= @exec_prefix@
+bindir		= @bindir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+CFLAGS               = @CFLAGS@
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+UUID_LIBS	= @UUID_LIBS@
+SSL_LIBS	= @SSL_LIBS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM	= @INSTALL_PROGRAM@
+transform       = @program_transform_name@
+LD64PROG	= $(shell echo ld64 | sed '$(transform)')
+
+MYINCLUDES      = -I$(builddir) -I$(srcdir) -I$(top_builddir)/include \
+                  -I$(top_srcdir)/include -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS      =
+MYDEFS          = -DDEBUG -DBINDIR="\"$(bindir)\"" -DLD64PROG="\"$(LD64PROG)\""
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= -lstuff
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS) $(SSL_LIBS) $(UUID_LIBS)
+
+CFILES = ld.c pass1.c objects.c sections.c cstring_literals.c symbols.c \
+         fvmlibs.c layout.c specs.c pass2.c generic_reloc.c rld.c sets.c \
+         4byte_literals.c 8byte_literals.c literal_pointers.c dylibs.c \
+         indirect_sections.c mod_sections.c i860_reloc.c ppc_reloc.c \
+         m88k_reloc.c hppa_reloc.c sparc_reloc.c coalesced_sections.c uuid.c \
+         debugcompunit.c debugline.c arm_reloc.c
+
+OBJS = $(CFILES:.c=.o)
+
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default clean distclean install
+
+default: ld_classic
+
+ld_classic: $(OBJS)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+
+install: ld_classic
+	mkdir -p $(DESTDIR)$(bindir)
+	$(INSTALL_PROGRAM) ld_classic \
+		$(DESTDIR)$(bindir)/`echo ld_classic | sed '$(transform)'`
+
+clean:
+	rm -r -f *.o
+	rm -f ld
diff -urN a/libmacho/Makefile.in b/libmacho/Makefile.in
--- a/libmacho/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/libmacho/Makefile.in	2013-11-18 23:05:40.081460758 +0000
@@ -0,0 +1,68 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+VPATH = @srcdir@
+
+prefix          = @prefix@
+exec_prefix     = @exec_prefix@
+libdir          = @libdir@
+
+CC                   = @CC@
+AR                   = @HOST_AR@
+RANLIB               = @HOST_RANLIB@
+CFLAGS               = @CFLAGS@
+WARNINGS             = @WARNINGS@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+INSTALL         = @INSTALL@
+INSTALL_DATA    = @INSTALL_DATA@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS		= -I$(top_srcdir)/include/foreign
+endif
+
+MYINCLUDES      = -I$(top_builddir)/include -I$(top_srcdir)/include \
+                  -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS	=
+MYDEFS		=
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS)
+
+CFILES = arch.c
+ECFILES = @EMULATED_OBJ@
+# Arguably, EMULATED_OBJ should be dropped in favour of the more
+# standard AC_LIBOBJS and AC_FUNC_REPLACE (a .c and .o per function)
+# ECFILES = @AC_LIBOBJS@
+
+OBJS = $(CFILES:.c=.o)
+EOBJS = $(ECFILES:.c=.o)
+
+.PHONY: default install clean distclean
+
+default: libmacho.a
+
+libmacho.a: $(OBJS) $(EOBJS)
+	$(AR) cru $@ $^
+	$(RANLIB) $@
+
+$(OBJS): %.o: %.c
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+emulated.o: $(top_srcdir)/libstuff/emulated.c
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+clean:
+	rm -r -f *.o
+	rm -f libmacho.a
+
+install: libmacho.a
+	mkdir -p $(DESTDIR)$(libdir)
+	$(INSTALL_DATA) $< $(DESTDIR)$(libdir)/$<
+	$(RANLIB) $(DESTDIR)$(libdir)/$<
diff -urN a/libprunetrie/Makefile.in b/libprunetrie/Makefile.in
--- a/libprunetrie/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/libprunetrie/Makefile.in	2013-11-18 23:05:40.081460758 +0000
@@ -0,0 +1,69 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix		= @prefix@
+exec_prefix	= @exec_prefix@
+bindir		= @bindir@
+
+VPATH = @srcdir@:@srcdir@/src
+
+CC                   = @CC@
+AR                   = @HOST_AR@
+RANLIB               = @HOST_RANLIB@
+CXX                  = @CXX@
+CFLAGS               = @CFLAGS@
+CXXFLAGS             = @CXXFLAGS@
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_LIBC_CXX_H      = @HAVE_LIBC_CXX_H@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+LTO_DEFS             = @LTO_DEFS@
+LTO_LIBS             = @LTO_LIBS@
+
+ifeq ($(HAVE_LIBC_CXX_H),YES)
+INCLIBCCXX = -include $(top_builddir)/include/libc_cxx.h
+endif
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+MYINCLUDES      = -I$(srcdir)/include -I$(top_srcdir)/include/mach-o -I$(top_srcdir)/include -I$(top_srcdir)/ld64/src/abstraction -I$(top_builddir)/include \
+                  $(INCLIBCCXX) -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS      =
+MYDEFS          = -DDEBUG -DBINDIR="\"$(bindir)\"" -DLDPROG="\"$(LDPROG)\"" \
+		  -DASPROG="\"$(ASPROG)\"" $(LTO_DEFS)
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+		$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+CXXFILES = PruneTrie.cpp
+
+OBJS = $(CXXFILES:.cpp=.o)
+OBJS += $(CFILES:.c=.o)
+
+.cpp.o:
+	$(CXX) $(MYCOMPILEFLAGS) $(CXXFLAGS) -c -o $@ $<
+
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default install clean
+
+default: libprunetrie.a
+
+libprunetrie.a: $(OBJS)
+	$(AR) cru $@ $^
+	$(RANLIB) $@
+
+clean:
+	rm -r -f *.o
+	rm -f libprunetrie.a
+
+install:
diff -urN a/libstuff/apple_version.c b/libstuff/apple_version.c
--- a/libstuff/apple_version.c	1970-01-01 01:00:00.000000000 +0100
+++ b/libstuff/apple_version.c	2013-11-18 23:05:40.189459400 +0000
@@ -0,0 +1,2 @@
+const char apple_version[]= PACKAGE_NAME "-" PACKAGE_VERSION;
+const char ldVersionString[]= "@(#)PROGRAM:ld  PROJECT: ld64-274.2\n";
diff -urN a/libstuff/emulated.c b/libstuff/emulated.c
--- a/libstuff/emulated.c	1970-01-01 01:00:00.000000000 +0100
+++ b/libstuff/emulated.c	2013-11-18 23:05:40.189459400 +0000
@@ -0,0 +1,719 @@
+#if (HAVE_DECL_MMAP==0) || (HAVE_DECL_FCHMOD==0) || (HAVE_DECL_FCHDIR==0) || (HAVE_DECL_UTIMES==0)
+
+/*
+ * WINVER of 0x0600 limits us to Windows Vista and above. There is FileExtd.lib for XP, but it appears
+ * to be broken:
+ * http://social.msdn.microsoft.com/Forums/en-US/windowssdk/thread/78de6b2f-d01f-4394-a5c5-a4253942ae9c
+ * There's also:
+ * http://tranxcoder.wordpress.com/2010/02/02/calling-getfileinformationbyhandleex-in-windows-xp/
+ * ...but there's no license details given and the first comment needs paying attention to also.
+ */
+
+#ifdef WINVER
+# undef WINVER
+#endif
+#define WINVER 0x0600
+
+#ifdef _WIN32_WINNT
+# undef _WIN32_WINNT
+#endif
+#define _WIN32_WINNT 0x0600
+
+#ifndef WIN32_LEAN_AND_MEAN
+# define WIN32_LEAN_AND_MEAN
+#endif
+
+#include <windows.h>
+
+#ifndef ENOTSUP
+# define ENOTSUP 95
+#endif
+
+#endif /* (HAVE_DECL_MMAP==0) || (HAVE_DECL_FCHMOD==0) || (HAVE_DECL_FCHDIR==0) || (HAVE_DECL_UTIMES==0) */
+
+#include <mach/mach.h>
+#include <mach/mach_error.h>
+#include <stdlib.h>
+#include <stdio.h>
+#include <unistd.h>
+#include <sys/types.h>
+#if !defined(__MINGW32__)
+ #include <sys/mman.h>
+#else
+ #include <stddef.h>
+#endif
+#include <errno.h>
+#include <inttypes.h>
+#include <mach/mach_time.h>
+#include <mach/mach_host.h>
+#include <mach/host_info.h>
+#include <sys/time.h>
+
+#if (HAVE_DECL_MMAP==0)
+void *mmap(void *start, size_t length, int prot, int flags, int fd, off_t offset)
+{
+	HANDLE hmap;
+	void *temp;
+	off_t len;
+	struct stat st;
+
+    /* Fix up offset wrt dwAllocationGranularity
+     * after http://msdn.microsoft.com/en-us/library/windows/desktop/aa366548(v=vs.85).aspx
+     */
+    SYSTEM_INFO SysInfo;
+    GetSystemInfo(&SysInfo);
+
+    /* How far into the page is the offset? */
+    off_t PageDelta = offset%(off_t)SysInfo.dwAllocationGranularity;
+	uint64_t o = offset-(uint64_t)PageDelta;
+
+	DWORD Protect = PAGE_READONLY;
+	DWORD DesiredAccess = FILE_MAP_COPY;
+	if (prot != PROT_READ)
+	{
+        Protect = PAGE_READWRITE;
+	    DesiredAccess = FILE_MAP_WRITE;
+	}
+
+	if (!fstat(fd, &st))
+		len = st.st_size;
+	else
+	{
+        fprintf(stderr,"mmap: fstat failed\n");
+        exit(1);
+	}
+
+	if ((length + offset) > len)
+		length = (size_t)len - (size_t)offset;
+
+	hmap = CreateFileMapping((HANDLE)_get_osfhandle(fd), 0, Protect, 0, 0, 0);
+
+	if (!hmap)
+		return (void*)-1;
+
+	temp = MapViewOfFile(hmap, DesiredAccess, (uint32_t)((o>>32)&0xffffffff), (uint32_t)(o&0xffffffff), length+PageDelta);
+
+	if (!CloseHandle(hmap))
+		fprintf(stderr,"mmap: CloseHandle failed\n");
+
+	return temp ? temp+PageDelta : (void*)-1;
+}
+
+int munmap(void *start, size_t length)
+{
+    SYSTEM_INFO SysInfo;
+    GetSystemInfo(&SysInfo);
+    off_t PageDelta = (off_t)start%(off_t)SysInfo.dwAllocationGranularity;
+	return !UnmapViewOfFile((void*)(start-PageDelta));
+}
+#endif /* HAVE_DECL_MMAP */
+
+#if (HAVE_FLOCK==0)
+int flock (int __fd, int __operation)
+{
+    return 0;
+}
+#endif /* HAVE_FLOCK */
+
+#if (HAVE_DECL_GETUID==0)
+uid_t getuid(void)
+{
+    return (uid_t)0;
+}
+#endif /* HAVE_DECL_GETUID */
+
+#if (HAVE_DECL_GETUID==0)
+gid_t getgid(void)
+{
+    return (gid_t)0;
+}
+#endif /* HAVE_DECL_GETGID */
+
+#if (HAVE_DECL_RINDEX==0)
+char *rindex(const char *s, int c)
+{
+    return strrchr(s,c);
+}
+#endif /* HAVE_DECL_RINDEX */
+
+#if (HAVE_DECL_INDEX==0)
+char *index(const char *s, int c)
+{
+    return strchr(s,c);
+}
+#endif /* HAVE_DECL_INDEX */
+
+#if (HAVE_DECL_STRMODE==0)
+#include <sys/stat.h>
+void strmode(int mode, char *p)
+{
+	 /* print type */
+	switch (mode & S_IFMT) {
+	case S_IFDIR:			/* directory */
+		*p++ = 'd';
+		break;
+	case S_IFCHR:			/* character special */
+		*p++ = 'c';
+		break;
+	case S_IFBLK:			/* block special */
+		*p++ = 'b';
+		break;
+	case S_IFREG:			/* regular */
+		*p++ = '-';
+		break;
+	case S_IFLNK:			/* symbolic link */
+		*p++ = 'l';
+		break;
+#ifdef S_IFSOCK
+	case S_IFSOCK:			/* socket */
+		*p++ = 's';
+		break;
+#endif
+#ifdef S_IFIFO
+	case S_IFIFO:			/* fifo */
+		*p++ = 'p';
+		break;
+#endif
+#ifdef S_IFWHT
+	case S_IFWHT:			/* whiteout */
+		*p++ = 'w';
+		break;
+#endif
+	default:			/* unknown */
+		*p++ = '?';
+		break;
+	}
+	/* usr */
+	if (mode & S_IRUSR)
+		*p++ = 'r';
+	else
+		*p++ = '-';
+	if (mode & S_IWUSR)
+		*p++ = 'w';
+	else
+		*p++ = '-';
+	switch (mode & (S_IXUSR | S_ISUID)) {
+	case 0:
+		*p++ = '-';
+		break;
+	case S_IXUSR:
+		*p++ = 'x';
+		break;
+	case S_ISUID:
+		*p++ = 'S';
+		break;
+	case S_IXUSR | S_ISUID:
+		*p++ = 's';
+		break;
+	}
+	/* group */
+	if (mode & S_IRGRP)
+		*p++ = 'r';
+	else
+		*p++ = '-';
+	if (mode & S_IWGRP)
+		*p++ = 'w';
+	else
+		*p++ = '-';
+	switch (mode & (S_IXGRP | S_ISGID)) {
+	case 0:
+		*p++ = '-';
+		break;
+	case S_IXGRP:
+		*p++ = 'x';
+		break;
+	case S_ISGID:
+		*p++ = 'S';
+		break;
+	case S_IXGRP | S_ISGID:
+		*p++ = 's';
+		break;
+	}
+	/* other */
+	if (mode & S_IROTH)
+		*p++ = 'r';
+	else
+		*p++ = '-';
+	if (mode & S_IWOTH)
+		*p++ = 'w';
+	else
+		*p++ = '-';
+	switch (mode & (S_IXOTH | S_ISVTX)) {
+	case 0:
+		*p++ = '-';
+		break;
+	case S_IXOTH:
+		*p++ = 'x';
+		break;
+	case S_ISVTX:
+		*p++ = 'T';
+		break;
+	case S_IXOTH | S_ISVTX:
+		*p++ = 't';
+		break;
+	}
+	*p++ = ' ';		/* will be a '+' if ACL's implemented */
+	*p = '\0';
+}
+#endif /* HAVE_DECL_STRMODE */
+
+#if (HAVE_DECL_MKSTEMP==0)
+#include <io.h>
+#include <sys/stat.h>
+#include <fcntl.h>
+int mkstemp(char *tmplate)
+{
+    int ret;
+    mktemp(tmplate);
+    ret=_open(tmplate,O_RDWR|O_BINARY|O_CREAT|O_EXCL|_O_SHORT_LIVED, _S_IREAD|_S_IWRITE);
+    return ret;
+}
+#endif /* HAVE_DECL_MKSTEMP */
+#if (HAVE_DECL_SIGFILLSET==0)
+int sigfillset (sigset_t *__set)
+{
+    return 0;
+}
+#endif /* HAVE_DECL_SIGFILLSET */
+#if (HAVE_DECL_SIGPROCMASK==0)
+int sigprocmask (int __how, __const sigset_t * __set, sigset_t * __oset)
+{
+    return 0;
+}
+#endif /* HAVE_DECL_SIGPROCMASK */
+
+#if (HAVE_DECL_FCHMOD==0)
+WINBASEAPI BOOL WINAPI SetFileInformationByHandle(HANDLE,FILE_INFO_BY_HANDLE_CLASS,LPVOID,DWORD);
+int fchmod(int fildes, mode_t mode)
+{
+	FILE_BASIC_INFO basicInfo;
+	HANDLE h = (HANDLE)_get_osfhandle(fildes);
+	if(!GetFileInformationByHandleEx(h, FileBasicInfo, &basicInfo, sizeof(FILE_BASIC_INFO)))
+		return -1;
+	if( mode & S_IWUSR )
+		basicInfo.FileAttributes &= ~FILE_ATTRIBUTE_READONLY;
+	else
+		basicInfo.FileAttributes |= FILE_ATTRIBUTE_READONLY;
+	if(!SetFileInformationByHandle(h, FileBasicInfo, &basicInfo, sizeof(FILE_BASIC_INFO)))
+		return -1;
+	return 0;
+}
+#endif /* HAVE_DECL_FCHMOD */
+
+#if (HAVE_DECL_FCHDIR==0)
+WINBASEAPI BOOL WINAPI SetFileInformationByHandle(HANDLE,FILE_INFO_BY_HANDLE_CLASS,LPVOID,DWORD);
+int fchdir(int fildes)
+{
+    char storage[sizeof(FILE_NAME_INFO)+1024*sizeof(WCHAR)];
+	FILE_NAME_INFO* pNameInfo = (FILE_NAME_INFO*)&storage[0];
+	pNameInfo->FileNameLength=1023;
+	HANDLE h = (HANDLE)_get_osfhandle(fildes);
+	if(!GetFileInformationByHandleEx(h, FileNameInfo, pNameInfo, sizeof(FILE_BASIC_INFO)))
+		return -1;
+	if(wcsrchr(pNameInfo->FileName,'\\'))
+	{
+        *wcsrchr(pNameInfo->FileName,'\\') = '\0';
+	}
+	SetCurrentDirectoryW(pNameInfo->FileName);
+	return 0;
+}
+#endif /* HAVE_DECL_FCHDIR */
+
+#if (HAVE_DECL_UTIMES==0)
+#include <time.h>
+#include <sys/time.h>
+static void UnixTimeToFileTime(struct timeval t, LPFILETIME pft)
+{
+    /* Note that LONGLONG is a 64-bit value */
+    LONGLONG ll;
+
+    ll = Int32x32To64(t.tv_sec, 10000000LL) + t.tv_usec*10 + 116444736000000000;
+    pft->dwLowDateTime = (DWORD)ll;
+    pft->dwHighDateTime = ll >> 32;
+}
+int utimes(const char *filename, const struct timeval times[2])
+{
+    FILETIME LastAccessTime;
+    FILETIME LastModificationTime;
+    HANDLE hFile;
+
+    UnixTimeToFileTime(times[0], &LastAccessTime);
+    UnixTimeToFileTime(times[1], &LastModificationTime);
+    hFile=CreateFileA(filename, FILE_WRITE_ATTRIBUTES, FILE_SHARE_DELETE | FILE_SHARE_READ | FILE_SHARE_WRITE, NULL, OPEN_EXISTING, 0, NULL);
+    if(hFile==INVALID_HANDLE_VALUE)
+    {
+        return -1;
+    }
+
+    if(!SetFileTime(hFile, NULL, &LastAccessTime, &LastModificationTime))
+    {
+        return -1;
+    }
+    CloseHandle(hFile);
+    return 0;
+}
+#endif /* HAVE_DECL_UTIMES */
+
+#if (HAVE_DECL_DLOPEN==0)
+void *dlopen(const char* file, int mode)
+{
+    return (void*)LoadLibrary(file);
+}
+#endif /* HAVE_DECL_DLOPEN */
+
+#if (HAVE_DECL_DLSYM==0)
+void *dlsym(void* handle, const char* name)
+{
+    return (void*)GetProcAddress((HMODULE)handle,(LPCSTR)name);
+}
+#endif /* HAVE_DECL_DLSYM */
+
+#if (HAVE_DECL_DLCLOSE==0)
+int dlclose(void* handle)
+{
+    if(FreeLibrary((HMODULE)handle))
+        return 0;
+    return 1;
+}
+
+int dladdr(void *addr, Dl_info *info)
+{
+    memset(info,0,sizeof(info));
+    return 0;
+}
+#endif /* HAVE_DECL_DLCLOSE */
+
+#if (HAVE_DECL_DLERROR==0)
+const char *dlerror(void)
+{
+    return 0;
+}
+#endif/*HAVE_DECL_DLERROR*/
+
+#if (HAVE_DECL_ASPRINTF==0)
+/* From Keith Packard. */
+#include <stdarg.h>
+int vasprintf( char **sptr, const char *fmt, va_list argv )
+{
+    int wanted = vsnprintf( *sptr = NULL, 0, fmt, argv );
+    if( (wanted < 0) || ((*sptr = malloc( 1 + wanted )) == NULL) )
+    return -1;
+
+    return vsprintf( *sptr, fmt, argv );
+}
+int asprintf( char **sptr, char *fmt, ... )
+{
+    int retval;
+    va_list argv;
+    va_start( argv, fmt );
+    retval = vasprintf( sptr, fmt, argv );
+    va_end( argv );
+    return retval;
+}
+#endif /* HAVE_DECL_ASPRINTF */
+
+#if (HAVE_DECL_BACKTRACE==0)
+int backtrace(void **__array, int __size)
+{
+    return 0;
+}
+#endif /* HAVE_DECL_BACKTRACE */
+
+#if (HAVE_DECL_PWRITE==0)
+ssize_t pwrite(int fd, const void *buf, size_t count, off_t offset)
+{
+    ssize_t res;
+    off_t old_pos;
+
+    old_pos = lseek(fd, 0, SEEK_CUR);
+    lseek (fd, offset, SEEK_SET);
+    res = write(fd, buf, count);
+    lseek(fd, old_pos, SEEK_SET);
+
+    return res;
+}
+#endif /* HAVE_DECL_PWRITE */
+
+#ifdef NEED_BSD_QSORT_R
+__thread void *_qsort_thunk = NULL;
+int (*_qsort_saved_func)(void *, const void *, const void *) = NULL;
+
+static int _qsort_comparator(const void *a, const void *b);
+
+static int _qsort_comparator(const void *a, const void *b)
+{
+  return _qsort_saved_func(_qsort_thunk, a, b);
+}
+
+void
+qsort_r(void *base, size_t nmemb, size_t size, void *thunk,
+    int (*compar)(void *, const void *, const void *))
+{
+  _qsort_thunk = thunk;
+  _qsort_saved_func = compar;
+
+  qsort(base, nmemb, size, _qsort_comparator);
+}
+#endif /* NEED_BSD_QSORT_R */
+
+#ifndef HAVE__NSGETEXECUTABLEPATH
+/**
+ * Based on MonetDB's get_bin_path
+ * http://dev.monetdb.org/hg/MonetDB/file/54ad354daff8/common/utils/mutils.c#l340
+ * Really, bufsize should be set to the size required too.
+ */
+int _NSGetExecutablePath(char* buf, unsigned long* bufsize)
+{
+#if defined(_MSC_VER) || defined(__MINGW32__)
+    if (GetModuleFileName(NULL, buf, (DWORD)(*bufsize)) != 0) {
+        /* Early conversion to unix slashes instead of more changes
+         * everywhere else... */
+        char *winslash = strchr(buf,'\\');
+        while (winslash) {
+            *winslash = '/';
+            winslash = strchr(winslash,'\\');
+        }
+		return strlen(buf);
+	}
+	return -1;
+#elif (HAVE_DECL_READLINK) /* Linux */
+    int ret = readlink("/proc/self/exe", buf, (size_t)(*bufsize));
+    if(ret != -1) {
+        buf[ret] = '\0';
+    }
+    return ret;
+#else
+	return -1; /* Fail on all other systems for now */
+#endif /* _MSC_VER */
+}
+#endif/* HAVE__NSGETEXECUTABLEPATH */
+
+#if (HAVE_DECL_REALPATH==0)
+char *realpath(const char *path, char *resolved)
+{
+    char* winslash;
+    _fullpath(resolved,path,255);
+    winslash = strchr(resolved,'\\');
+    while (winslash) {
+        *winslash = '/';
+        winslash = strchr(winslash,'\\');
+    }
+    return resolved;
+}
+#endif /* HAVE_DECL_REALPATH */
+
+#ifndef HAVE_STRLCPY
+
+/*      $OpenBSD: strlcpy.c,v 1.11 2006/05/05 15:27:38 millert Exp $        */
+
+/*
+ * Copyright (c) 1998 Todd C. Miller <Todd.Miller@courtesan.com>
+ *
+ * Permission to use, copy, modify, and distribute this software for any
+ * purpose with or without fee is hereby granted, provided that the above
+ * copyright notice and this permission notice appear in all copies.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
+ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
+ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
+ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
+ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
+ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
+ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ */
+
+#include <sys/types.h>
+#include <string.h>
+
+
+/*
+ * Copy src to string dst of size siz.  At most siz-1 characters
+ * will be copied.  Always NUL terminates (unless siz == 0).
+ * Returns strlen(src); if retval >= siz, truncation occurred.
+ */
+size_t strlcpy(char *dst, const char *src, size_t siz)
+{
+        char *d = dst;
+        const char *s = src;
+        size_t n = siz;
+
+        /* Copy as many bytes as will fit */
+        if (n != 0) {
+                while (--n != 0) {
+                        if ((*d++ = *s++) == '\0')
+                                break;
+                }
+        }
+
+        /* Not enough room in dst, add NUL and traverse rest of src */
+        if (n == 0) {
+                if (siz != 0)
+                        *d = '\0';                /* NUL-terminate dst */
+                while (*s++)
+                        ;
+        }
+
+        return(s - src - 1);        /* count does not include NUL */
+}
+
+#endif /* HAVE_STRLCPY */
+
+#ifndef HAVE_STRLCAT
+
+/*	$OpenBSD: strlcat.c,v 1.13 2005/08/08 08:05:37 espie Exp $	*/
+
+/*
+ * Copyright (c) 1998 Todd C. Miller <Todd.Miller@courtesan.com>
+ *
+ * Permission to use, copy, modify, and distribute this software for any
+ * purpose with or without fee is hereby granted, provided that the above
+ * copyright notice and this permission notice appear in all copies.
+ *
+ * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
+ * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
+ * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
+ * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
+ * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
+ * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
+ * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
+ */
+
+#include <sys/types.h>
+#include <string.h>
+
+/*
+ * Appends src to string dst of size siz (unlike strncat, siz is the
+ * full size of dst, not space left).  At most siz-1 characters
+ * will be copied.  Always NUL terminates (unless siz <= strlen(dst)).
+ * Returns strlen(src) + MIN(siz, strlen(initial dst)).
+ * If retval >= siz, truncation occurred.
+ */
+size_t strlcat(char *dst, const char *src, size_t siz)
+{
+        char *d = dst;
+        const char *s = src;
+        size_t n = siz;
+        size_t dlen;
+
+        /* Find the end of dst and adjust bytes left but don't go past end */
+        while (n-- != 0 && *d != '\0')
+                d++;
+        dlen = d - dst;
+        n = siz - dlen;
+
+        if (n == 0)
+                return(dlen + strlen(s));
+        while (*s != '\0') {
+                if (n != 1) {
+                        *d++ = *s;
+                        n--;
+                }
+                s++;
+        }
+        *d = '\0';
+
+        return(dlen + (s - src));	/* count does not include NUL */
+}
+
+#endif /* HAVE_STRLCAT */
+
+#if (HAVE_GETATTRLIST==0)
+int getattrlist(const char* a,void* b,void* c,size_t d,unsigned int e)
+{
+  errno = ENOTSUP;
+  return -1;
+}
+#endif /* HAVE_DECL_GETATTRLIST */
+
+kern_return_t mach_timebase_info( mach_timebase_info_t info)
+{
+   info->numer = 1;
+   info->denom = 1;
+   return 0;
+}
+
+char* mach_error_string(mach_error_t error_value)
+{
+  return "Unknown mach error";
+}
+
+mach_port_t mach_host_self(void)
+{
+  return 0;
+}
+
+kern_return_t host_info(host_t host, host_flavor_t flavor, host_info_t host_info_out, mach_msg_type_number_t *host_info_outCnt)
+{
+  if(flavor == HOST_BASIC_INFO)
+  {
+    host_basic_info_t      basic_info;
+
+    basic_info = (host_basic_info_t) host_info_out;
+    memset(basic_info, 0x00, sizeof(*basic_info));
+    basic_info->cpu_type = EMULATED_HOST_CPU_TYPE;
+    basic_info->cpu_subtype = EMULATED_HOST_CPU_SUBTYPE;
+  }
+
+  return 0;
+}
+
+mach_port_t mach_task_self_ = 0;
+
+kern_return_t mach_port_deallocate(ipc_space_t task, mach_port_name_t name)
+{
+  return 0;
+}
+
+kern_return_t vm_allocate(vm_map_t target_task, vm_address_t *address, vm_size_t size, int flags)
+{
+  vm_address_t addr = 0;
+
+  addr = (vm_address_t)calloc(size, sizeof(char));
+  if(addr == 0)
+    return 1;
+
+  *address = addr;
+
+  return 0;
+}
+
+kern_return_t vm_deallocate(vm_map_t target_task, vm_address_t address, vm_size_t size)
+{
+  /*  free((void *)address); leak it here */
+  return 0;
+}
+
+kern_return_t host_statistics(host_t host_priv, host_flavor_t flavor,
+    host_info_t host_info_out, mach_msg_type_number_t *host_info_outCnt)
+{
+  return ENOTSUP;
+}
+
+kern_return_t map_fd(int fd, vm_offset_t offset, vm_offset_t *va, boolean_t findspace,
+    vm_size_t size)
+{
+  void *addr = NULL;
+
+  addr = mmap(0, size, PROT_READ|PROT_WRITE,
+          MAP_PRIVATE|MAP_FILE, fd, offset);
+
+  if(addr == (void *)-1)
+  {
+    return 1;
+  }
+
+  *va = (vm_offset_t)addr;
+
+  return 0;
+}
+
+uint64_t mach_absolute_time(void)
+{
+  uint64_t t = 0;
+  struct timeval tv;
+  if (gettimeofday(&tv,NULL)) return t;
+  t = ((uint64_t)tv.tv_sec << 32)  | tv.tv_usec;
+  return t;
+}
+
+vm_size_t vm_page_size = 4096; /* hardcoded to match expectations of darwin */
diff -urN a/libstuff/Makefile.in b/libstuff/Makefile.in
--- a/libstuff/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/libstuff/Makefile.in	2013-11-18 23:05:40.189459400 +0000
@@ -0,0 +1,62 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+AR                   = @HOST_AR@
+RANLIB               = @HOST_RANLIB@
+CFLAGS               = @CFLAGS@  -DLTO_SUPPORT -DTRIE_SUPPORT
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+LTO_DEFS             = @LTO_DEFS@
+LTO_LIBS             = @LTO_LIBS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS		= -I$(top_srcdir)/include/foreign
+endif
+
+MYINCLUDES      = -I$(top_builddir)/include -I$(top_srcdir)/include \
+                  -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS	=
+MYDEFS		=
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC) $(LTO_DEFS)
+
+CFILES = allocate.c errors.c arch.c execute.c bytesex.c rnd.c hppa.c		\
+	  swap_headers.c reloc.c version_number.c get_toc_byte_sex.c		\
+	  best_arch.c fatals.c arch_usage.c ofile.c ofile_error.c print.c	\
+	  set_arch_flag_name.c			\
+	  breakout.c writeout.c checkout.c fatal_arch.c ofile_get_word.c	\
+	  hash_string.c @NOT_FOR_WINDOWS_C@ guess_short_name.c			\
+	  get_arch_from_host.c crc32.c macosx_deployment_target.c	\
+	  symbol_list.c unix_standard_mode.c lto.c @EMULATED_OBJ@ apple_version.c llvm.c
+
+OBJS = $(CFILES:.c=.o)
+OBJS64 = $(CFILES:.c=.64o)
+
+
+.PHONY: default install clean
+
+default: libstuff.a
+
+libstuff.a: $(OBJS)
+	$(AR) cru $@ $^
+	$(RANLIB) $@
+
+$(OBJS): %.o: %.c
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+clean:
+	rm -r -f *.o
+	rm -f libstuff.a
+
+install:
diff -urN a/m4/ax_append_compile_flags.m4 b/m4/ax_append_compile_flags.m4
--- a/m4/ax_append_compile_flags.m4	1970-01-01 01:00:00.000000000 +0100
+++ b/m4/ax_append_compile_flags.m4	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,65 @@
+# ===========================================================================
+#  http://www.gnu.org/software/autoconf-archive/ax_append_compile_flags.html
+# ===========================================================================
+#
+# SYNOPSIS
+#
+#   AX_APPEND_COMPILE_FLAGS([FLAG1 FLAG2 ...], [FLAGS-VARIABLE], [EXTRA-FLAGS])
+#
+# DESCRIPTION
+#
+#   For every FLAG1, FLAG2 it is checked whether the compiler works with the
+#   flag.  If it does, the flag is added FLAGS-VARIABLE
+#
+#   If FLAGS-VARIABLE is not specified, the current language's flags (e.g.
+#   CFLAGS) is used.  During the check the flag is always added to the
+#   current language's flags.
+#
+#   If EXTRA-FLAGS is defined, it is added to the current language's default
+#   flags (e.g. CFLAGS) when the check is done.  The check is thus made with
+#   the flags: "CFLAGS EXTRA-FLAGS FLAG".  This can for example be used to
+#   force the compiler to issue an error when a bad flag is given.
+#
+#   NOTE: This macro depends on the AX_APPEND_FLAG and
+#   AX_CHECK_COMPILE_FLAG. Please keep this macro in sync with
+#   AX_APPEND_LINK_FLAGS.
+#
+# LICENSE
+#
+#   Copyright (c) 2011 Maarten Bosmans <mkbosmans@gmail.com>
+#
+#   This program is free software: you can redistribute it and/or modify it
+#   under the terms of the GNU General Public License as published by the
+#   Free Software Foundation, either version 3 of the License, or (at your
+#   option) any later version.
+#
+#   This program is distributed in the hope that it will be useful, but
+#   WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
+#   Public License for more details.
+#
+#   You should have received a copy of the GNU General Public License along
+#   with this program. If not, see <http://www.gnu.org/licenses/>.
+#
+#   As a special exception, the respective Autoconf Macro's copyright owner
+#   gives unlimited permission to copy, distribute and modify the configure
+#   scripts that are the output of Autoconf when processing the Macro. You
+#   need not follow the terms of the GNU General Public License when using
+#   or distributing such scripts, even though portions of the text of the
+#   Macro appear in them. The GNU General Public License (GPL) does govern
+#   all other use of the material that constitutes the Autoconf Macro.
+#
+#   This special exception to the GPL applies to versions of the Autoconf
+#   Macro released by the Autoconf Archive. When you make and distribute a
+#   modified version of the Autoconf Macro, you may extend this special
+#   exception to the GPL to apply to your modified version as well.
+
+#serial 3
+
+AC_DEFUN([AX_APPEND_COMPILE_FLAGS],
+[AC_REQUIRE([AX_CHECK_COMPILE_FLAG])
+AC_REQUIRE([AX_APPEND_FLAG])
+for flag in $1; do
+  AX_CHECK_COMPILE_FLAG([$flag], [AX_APPEND_FLAG([$flag], [$2])], [], [$3])
+done
+])dnl AX_APPEND_COMPILE_FLAGS
diff -urN a/m4/ax_append_flag.m4 b/m4/ax_append_flag.m4
--- a/m4/ax_append_flag.m4	1970-01-01 01:00:00.000000000 +0100
+++ b/m4/ax_append_flag.m4	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,69 @@
+# ===========================================================================
+#      http://www.gnu.org/software/autoconf-archive/ax_append_flag.html
+# ===========================================================================
+#
+# SYNOPSIS
+#
+#   AX_APPEND_FLAG(FLAG, [FLAGS-VARIABLE])
+#
+# DESCRIPTION
+#
+#   FLAG is appended to the FLAGS-VARIABLE shell variable, with a space
+#   added in between.
+#
+#   If FLAGS-VARIABLE is not specified, the current language's flags (e.g.
+#   CFLAGS) is used.  FLAGS-VARIABLE is not changed if it already contains
+#   FLAG.  If FLAGS-VARIABLE is unset in the shell, it is set to exactly
+#   FLAG.
+#
+#   NOTE: Implementation based on AX_CFLAGS_GCC_OPTION.
+#
+# LICENSE
+#
+#   Copyright (c) 2008 Guido U. Draheim <guidod@gmx.de>
+#   Copyright (c) 2011 Maarten Bosmans <mkbosmans@gmail.com>
+#
+#   This program is free software: you can redistribute it and/or modify it
+#   under the terms of the GNU General Public License as published by the
+#   Free Software Foundation, either version 3 of the License, or (at your
+#   option) any later version.
+#
+#   This program is distributed in the hope that it will be useful, but
+#   WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
+#   Public License for more details.
+#
+#   You should have received a copy of the GNU General Public License along
+#   with this program. If not, see <http://www.gnu.org/licenses/>.
+#
+#   As a special exception, the respective Autoconf Macro's copyright owner
+#   gives unlimited permission to copy, distribute and modify the configure
+#   scripts that are the output of Autoconf when processing the Macro. You
+#   need not follow the terms of the GNU General Public License when using
+#   or distributing such scripts, even though portions of the text of the
+#   Macro appear in them. The GNU General Public License (GPL) does govern
+#   all other use of the material that constitutes the Autoconf Macro.
+#
+#   This special exception to the GPL applies to versions of the Autoconf
+#   Macro released by the Autoconf Archive. When you make and distribute a
+#   modified version of the Autoconf Macro, you may extend this special
+#   exception to the GPL to apply to your modified version as well.
+
+#serial 2
+
+AC_DEFUN([AX_APPEND_FLAG],
+[AC_PREREQ(2.59)dnl for _AC_LANG_PREFIX
+AS_VAR_PUSHDEF([FLAGS], [m4_default($2,_AC_LANG_PREFIX[FLAGS])])dnl
+AS_VAR_SET_IF(FLAGS,
+  [case " AS_VAR_GET(FLAGS) " in
+    *" $1 "*)
+      AC_RUN_LOG([: FLAGS already contains $1])
+      ;;
+    *)
+      AC_RUN_LOG([: FLAGS="$FLAGS $1"])
+      AS_VAR_SET(FLAGS, ["AS_VAR_GET(FLAGS) $1"])
+      ;;
+   esac],
+  [AS_VAR_SET(FLAGS,["$1"])])
+AS_VAR_POPDEF([FLAGS])dnl
+])dnl AX_APPEND_FLAG
diff -urN a/m4/ax_check_compile_flag.m4 b/m4/ax_check_compile_flag.m4
--- a/m4/ax_check_compile_flag.m4	1970-01-01 01:00:00.000000000 +0100
+++ b/m4/ax_check_compile_flag.m4	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,72 @@
+# ===========================================================================
+#   http://www.gnu.org/software/autoconf-archive/ax_check_compile_flag.html
+# ===========================================================================
+#
+# SYNOPSIS
+#
+#   AX_CHECK_COMPILE_FLAG(FLAG, [ACTION-SUCCESS], [ACTION-FAILURE], [EXTRA-FLAGS])
+#
+# DESCRIPTION
+#
+#   Check whether the given FLAG works with the current language's compiler
+#   or gives an error.  (Warnings, however, are ignored)
+#
+#   ACTION-SUCCESS/ACTION-FAILURE are shell commands to execute on
+#   success/failure.
+#
+#   If EXTRA-FLAGS is defined, it is added to the current language's default
+#   flags (e.g. CFLAGS) when the check is done.  The check is thus made with
+#   the flags: "CFLAGS EXTRA-FLAGS FLAG".  This can for example be used to
+#   force the compiler to issue an error when a bad flag is given.
+#
+#   NOTE: Implementation based on AX_CFLAGS_GCC_OPTION. Please keep this
+#   macro in sync with AX_CHECK_{PREPROC,LINK}_FLAG.
+#
+# LICENSE
+#
+#   Copyright (c) 2008 Guido U. Draheim <guidod@gmx.de>
+#   Copyright (c) 2011 Maarten Bosmans <mkbosmans@gmail.com>
+#
+#   This program is free software: you can redistribute it and/or modify it
+#   under the terms of the GNU General Public License as published by the
+#   Free Software Foundation, either version 3 of the License, or (at your
+#   option) any later version.
+#
+#   This program is distributed in the hope that it will be useful, but
+#   WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General
+#   Public License for more details.
+#
+#   You should have received a copy of the GNU General Public License along
+#   with this program. If not, see <http://www.gnu.org/licenses/>.
+#
+#   As a special exception, the respective Autoconf Macro's copyright owner
+#   gives unlimited permission to copy, distribute and modify the configure
+#   scripts that are the output of Autoconf when processing the Macro. You
+#   need not follow the terms of the GNU General Public License when using
+#   or distributing such scripts, even though portions of the text of the
+#   Macro appear in them. The GNU General Public License (GPL) does govern
+#   all other use of the material that constitutes the Autoconf Macro.
+#
+#   This special exception to the GPL applies to versions of the Autoconf
+#   Macro released by the Autoconf Archive. When you make and distribute a
+#   modified version of the Autoconf Macro, you may extend this special
+#   exception to the GPL to apply to your modified version as well.
+
+#serial 2
+
+AC_DEFUN([AX_CHECK_COMPILE_FLAG],
+[AC_PREREQ(2.59)dnl for _AC_LANG_PREFIX
+AS_VAR_PUSHDEF([CACHEVAR],[ax_cv_check_[]_AC_LANG_ABBREV[]flags_$4_$1])dnl
+AC_CACHE_CHECK([whether _AC_LANG compiler accepts $1], CACHEVAR, [
+  ax_check_save_flags=$[]_AC_LANG_PREFIX[]FLAGS
+  _AC_LANG_PREFIX[]FLAGS="$[]_AC_LANG_PREFIX[]FLAGS $4 $1"
+  AC_COMPILE_IFELSE([AC_LANG_PROGRAM()],
+    [AS_VAR_SET(CACHEVAR,[yes])],
+    [AS_VAR_SET(CACHEVAR,[no])])
+  _AC_LANG_PREFIX[]FLAGS=$ax_check_save_flags])
+AS_IF([test x"AS_VAR_GET(CACHEVAR)" = xyes],
+  [m4_default([$2], :)],
+  [m4_default([$3], :)])
+AS_VAR_POPDEF([CACHEVAR])dnl
+])dnl AX_CHECK_COMPILE_FLAGS
diff -urN a/m4/check_enum.m4 b/m4/check_enum.m4
--- a/m4/check_enum.m4	1970-01-01 01:00:00.000000000 +0100
+++ b/m4/check_enum.m4	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,47 @@
+dnl CHECK_ENUM and GET_DEFINE autoconf macros are
+dnl Copyright 2004,2006 Bernhard R. Link
+dnl and hereby in the public domain
+# Check for an enum, which seem to be forgotten in autoconf,
+# as this can neighter be checked with cpp, nor is it a symbol
+m4_define([CHECK_ENUM],
+[AS_VAR_PUSHDEF([check_Enum], [rr_cv_check_enum_$1])dnl
+AC_CACHE_CHECK([for $1 in $2], check_Enum,
+[AC_COMPILE_IFELSE([AC_LANG_PROGRAM([AC_INCLUDES_DEFAULT([$5])
+@%:@include <$2>],
+[ if( $1 == 0 )
+	return 0;
+])],
+		[AS_VAR_SET(check_Enum, yes)],
+		[AS_VAR_SET(check_Enum, no)])])
+AS_IF([test AS_VAR_GET(check_Enum) = yes], [$3], [$4])[]dnl
+AS_VAR_POPDEF([check_Enum])dnl
+])dnl
+# extract the value of a #define from a header
+m4_define([GET_DEFINE],
+[AC_LANG_PREPROC_REQUIRE()dnl
+AS_VAR_PUSHDEF(get_Define, [rr_cv_get_define_$1])dnl
+AC_CACHE_CHECK([for $1], get_Define,
+[dnl
+	m4_ifvaln([$2],[dnl
+		echo "#include <$2>" > conftest.$ac_ext
+		echo "$1" >> conftest.$ac_ext
+	],[dnl
+		echo "$1" > conftest.$ac_ext
+	])
+	if _AC_EVAL_STDERR([$ac_cpp conftest.$ac_ext >conftest.out]) >/dev/null; then
+		if test -s conftest.err; then
+			AS_VAR_SET(get_Define, $1)
+		else
+			AS_VAR_SET(get_Define, "$(tail -1 conftest.out)")
+		fi
+	else
+		AS_VAR_SET(get_Define, $1)
+	fi
+	rm -f conftest.err conftest.out conftest.$ac_ext
+])
+TMP_GET_DEFINE=AS_VAR_GET(get_Define)
+TMP_GET_DEFINE=${TMP_GET_DEFINE% }
+TMP_GET_DEFINE=${TMP_GET_DEFINE% }
+AS_IF([test "$TMP_GET_DEFINE" = $1], [$3], [$1="$TMP_GET_DEFINE"])[]dnl
+AS_VAR_POPDEF([get_Define])dnl
+])dnl GET_DEFINE
diff -urN a/Makefile.in b/Makefile.in
--- a/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/Makefile.in	2013-11-18 23:05:40.189459400 +0000
@@ -0,0 +1,52 @@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+DEFS = @DEFS@
+LDFLAGS = @LDFLAGS@
+
+builddir = @builddir@
+abs_builddir = @abs_builddir@
+top_builddir = @top_builddir@
+abs_top_builddir = @abs_top_builddir@
+srcdir = @srcdir@
+abs_srcdir = @abs_srcdir@
+top_srcdir = @top_srcdir@
+abs_top_srcdir = @abs_top_srcdir@
+
+VPATH = @srcdir@
+
+COMPONENTS = @COMPONENTS@
+
+.PHONY: default install clean distclean $(COMPONENTS)
+
+default: $(COMPONENTS)
+
+$(COMPONENTS):
+	cd $@ && $(MAKE)
+
+as ar misc otool: libstuff
+
+ld ld64 : libstuff libprunetrie
+
+clean distclean install:
+	for c in $(COMPONENTS); do              	\
+		(cd $$c && $(MAKE) $@) || exit 1;	\
+	done
+
+$(srcdir)/configure: configure.ac
+	cd $(srcdir) && autoconf
+
+$(srcdir)/include/config.h.in: include/stamp-h.in
+$(srcdir)/include/stamp-h.in: configure.ac
+	cd $(srcdir) && autoheader
+	echo timestamp > $(srcdir)/include/stamp-h.in
+
+include/config.h: include/stamp-h
+include/stamp-h: include/config.h.in config.status
+	./config.status
+
+Makefile: Makefile.in config.status
+	./config.status
+
+config.status: configure
+	./config.status --recheck
+
diff -urN a/man/Makefile.in b/man/Makefile.in
--- a/man/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/man/Makefile.in	2013-11-18 23:05:40.085460708 +0000
@@ -0,0 +1,50 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+datarootdir = @datarootdir@
+prefix	= @prefix@
+exec_prefix	= @exec_prefix@
+mandir		= @mandir@
+includedir	= @includedir@
+
+VPATH = @srcdir@
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA	= @INSTALL_DATA@
+
+MANPAGES1	= as.1 nm.1 otool.1 ranlib.1 \
+		segedit.1 size.1 strings.1 strip.1 lipo.1 \
+		libtool.1 pagestuff.1 redo_prebinding.1 \
+		nmedit.1 install_name_tool.1 checksyms.1 \
+		seg_addr_table.1
+
+MANPAGES3	= arch.3
+
+MANPAGES5	= Mach-O.5 a.out.5 ranlib.5 stab.5
+
+.PHONY: default install clean distclean
+
+default:
+
+install:
+	mkdir -p $(DESTDIR)$(mandir)
+	mkdir -p $(DESTDIR)$(mandir)/man1
+	mkdir -p $(DESTDIR)$(mandir)/man3
+	mkdir -p $(DESTDIR)$(mandir)/man5
+	for m in $(MANPAGES1); do				\
+		$(INSTALL_DATA) $(srcdir)/$$m			\
+			$(DESTDIR)$(mandir)/man1/$$m;		\
+	done
+	for m in $(MANPAGES3); do				\
+		$(INSTALL_DATA) $(srcdir)/$$m			\
+			$(DESTDIR)$(mandir)/man3/$$m;		\
+	done
+	for m in $(MANPAGES5); do				\
+		$(INSTALL_DATA) $(srcdir)/$$m			\
+			$(DESTDIR)$(mandir)/man5/$$m;		\
+	done
+
+
+clean:
diff -urN a/misc/Makefile.in b/misc/Makefile.in
--- a/misc/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/misc/Makefile.in	2013-11-18 23:05:40.077460808 +0000
@@ -0,0 +1,162 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix		= @prefix@
+exec_prefix	= @exec_prefix@
+bindir		= @bindir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+CXX                  = @CXX@
+CFLAGS               = @CFLAGS@ -DLTO_SUPPORT -DTRIE_SUPPORT
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+LTO_DEFS             = @LTO_DEFS@
+LTO_LIBS             = @LTO_LIBS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM	= @INSTALL_PROGRAM@
+transform       = @program_transform_name@
+LDPROG		= $(shell echo ld | sed '$(transform)')
+LIPOPROG	= $(shell echo lipo | sed '$(transform)')
+
+MYINCLUDES      = -I$(builddir) -I$(srcdir) -I$(top_builddir)/include \
+                  -I$(top_srcdir)/include -I$(top_srcdir)/libprunetrie -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS      =
+MYDEFS          = -DBINDIR="\"$(bindir)\"" -DLDPROG="\"$(LDPROG)\"" \
+		  -DLIPOPROG="\"$(LIPOPROG)\"" $(LTO_DEFS)
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= -lstuff @DL_LIBS@
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)
+
+PROGRAMS = lipo size strings nm libtool @NOT_FOR_WINDOWS_PROG@ \
+		seg_hack install_name_tool indr strip nmedit segedit pagestuff \
+		ranlib codesign_allocate
+
+CFILES_checksyms	= checksyms.c
+OBJS_checksyms	= $(CFILES_checksyms:.c=.o)
+
+CFILES_lipo	= lipo.c
+OBJS_lipo	= $(CFILES_lipo:.c=.o)
+
+CFILES_size	= size.c
+OBJS_size	= $(CFILES_size:.c=.o)
+
+CFILES_strings	= strings.c
+OBJS_strings	= $(CFILES_strings:.c=.o)
+
+CFILES_nm	= nm.c
+OBJS_nm		= $(CFILES_nm:.c=.o)
+
+CFILES_libtool	= libtool.c
+OBJS_libtool	= $(CFILES_libtool:.c=.o)
+
+CFILES_ranlib	= libtool.c
+OBJS_ranlib	= ranlib.o
+
+CFILES_redo_prebinding	= redo_prebinding.o
+OBJS_redo_prebinding	= $(CFILES_redo_prebinding:.c=.o)
+
+CFILES_seg_addr_table	= seg_addr_table.c
+OBJS_seg_addr_table	= $(CFILES_seg_addr_table:.c=.o)
+
+CFILES_seg_hack	= seg_hack.c
+OBJS_seg_hack	= $(CFILES_seg_hack:.c=.o)
+
+CFILES_install_name_tool	= install_name_tool.c
+OBJS_install_name_tool		= $(CFILES_install_name_tool:.c=.o)
+
+CFILES_indr	= indr.c
+OBJS_indr	= $(CFILES_indr:.c=.o)
+
+CFILES_strip	= strip.c
+OBJS_strip	= $(CFILES_strip:.c=.o)
+
+CFILES_codesign_allocate	= codesign_allocate.c
+OBJS_codesign_allocate	= $(CFILES_codesign_allocate:.c=.o)
+
+CFILES_nmedit	= strip.c
+OBJS_nmedit	= nmedit.o
+
+CFILES_segedit	= segedit.c
+OBJS_segedit	= $(CFILES_segedit:.c=.o)
+
+CFILES_pagestuff	= pagestuff.c
+OBJS_pagestuff	= $(CFILES_pagestuff:.c=.o)
+
+.c.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.o:
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+.PHONY: default clean distclean install
+
+default: $(PROGRAMS)
+
+ranlib.o: libtool.c
+	$(CC) -DRANLIB $(MYCOMPILEFLAGS) -c -o $@ $<
+
+nmedit.o: strip.c
+	$(CC) -DNMEDIT $(MYCOMPILEFLAGS) -c -o $@ $<
+
+checksyms: $(OBJS_checksyms)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+lipo: $(OBJS_lipo)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+size: $(OBJS_size)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+strings: $(OBJS_strings)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+nm: $(OBJS_nm)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+libtool: $(OBJS_libtool)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+redo_prebinding: $(OBJS_redo_prebinding)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+seg_addr_table: $(OBJS_seg_addr_table)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+seg_hack: $(OBJS_seg_hack)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+install_name_tool: $(OBJS_install_name_tool)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+indr: $(OBJS_indr)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+strip: $(OBJS_strip)
+	$(CXX) -o $@ $^ $(MYLINKFLAGS) -L$(top_builddir)/libprunetrie -lprunetrie
+codesign_allocate: $(OBJS_codesign_allocate)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+nmedit: $(OBJS_nmedit)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+segedit: $(OBJS_segedit)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+pagestuff: $(OBJS_pagestuff)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+ranlib: $(OBJS_ranlib)
+	$(CC) -o $@ $^ $(MYLINKFLAGS)
+
+install: $(PROGRAMS)
+	mkdir -p $(DESTDIR)$(bindir)
+	for p in $(PROGRAMS); do					\
+		$(INSTALL_PROGRAM) $$p 					\
+			$(DESTDIR)$(bindir)/`echo $$p | sed '$(transform)'`;	\
+	done
+clean:
+	rm -r -f *.o
+	rm -f $(PROGRAMS)
diff -urN a/otool/Makefile.in b/otool/Makefile.in
--- a/otool/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ b/otool/Makefile.in	2013-11-18 23:05:40.201459249 +0000
@@ -0,0 +1,82 @@
+builddir = @builddir@
+top_builddir = @top_builddir@
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+
+prefix		= @prefix@
+exec_prefix	= @exec_prefix@
+bindir		= @bindir@
+
+VPATH = @srcdir@
+
+CC                   = @CC@
+CXX                  = @CXX@
+CFLAGS               = @CFLAGS@
+WARNINGS             = @WARNINGS@
+MDYNAMICNOPIC        = @MDYNAMICNOPIC@
+CPPFLAGS             = @CPPFLAGS@
+DEFS                 = @DEFS@ @ENDIAN_FLAG@
+LDFLAGS              = @LDFLAGS@
+# See comments in configure.ac, there's no
+# Objective-c code in cctools.
+# This used to end up with -x objective-c.
+# OBJC                 = @OBJC@
+HAVE_FOREIGN_HEADERS = @HAVE_FOREIGN_HEADERS@
+
+ifeq ($(HAVE_FOREIGN_HEADERS),YES)
+FORHDRS         = -I$(top_srcdir)/include/foreign
+endif
+
+INSTALL		= @INSTALL@
+INSTALL_PROGRAM	= @INSTALL_PROGRAM@
+transform       = @program_transform_name@
+
+MYINCLUDES      = -I$(builddir) -I$(srcdir) -I$(top_builddir)/include \
+                  -I$(top_srcdir)/include -include $(top_builddir)/include/config.h $(FORHDRS)
+
+MYWARNINGS      =
+MYDEFS          =
+MYLDFLAGS	= -L$(top_builddir)/libstuff
+MYLIBS		= @DL_LIBS@
+
+MYCOMPILEFLAGS	= $(WARNINGS) $(MYWARNINGS) $(DEFS) $(MYDEFS) \
+	$(CPPFLAGS) $(MYINCLUDES) $(CFLAGS) $(MDYNAMICNOPIC)
+
+MYLINKFLAGS	= $(LDFLAGS) $(MYLDFLAGS) $(MYLIBS)
+MYLINKFLAGSO	= $(LDFLAGS) $(MYLDFLAGS) -lstuff $(MYLIBS)
+
+CFILES = main.c ofile_print.c m68k_disasm.c i860_disasm.c \
+         m88k_disasm.c i386_disasm.c ppc_disasm.c hppa_disasm.c \
+         sparc_disasm.c arm_disasm.c arm64_disasm.c dyld_bind_info.c print_bitcode.c
+
+#ifneq ($(OBJC),)
+OBJCFILES = print_objc.c print_objc2_32bit.c print_objc2_64bit.c
+OBJCOBJS = $(OBJCFILES:.c=.o)
+#endif
+OBJS = $(CFILES:.c=.o)
+
+.PHONY: default clean distclean install
+
+default: otool
+
+$(OBJS): %.o: %.c
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+$(OBJCOBJS): %.o: %.c
+	$(CC) $(MYCOMPILEFLAGS) -c -o $@ $<
+#	$(CC) $(OBJC) $(MYCOMPILEFLAGS) -c -o $@ $<
+
+otool: $(OBJS) $(OBJCOBJS) ofile.o
+	$(CXX) -o $@ $^ $(MYLINKFLAGSO)
+
+ofile.o: $(top_srcdir)/libstuff/ofile.c
+	$(CC) -DOTOOL $(MYCOMPILEFLAGS) -c -o $@ $<
+
+install: otool
+	mkdir -p $(DESTDIR)$(bindir)
+	$(INSTALL_PROGRAM) otool \
+		$(DESTDIR)$(bindir)/`echo otool | sed '$(transform)'`
+
+clean:
+	rm -r -f *.o
+	rm -f otool
diff -urN a/APPLE_LICENSE b/APPLE_LICENSE
--- a/APPLE_LICENSE	2017-08-07 16:01:54.768269414 +0100
+++ b/APPLE_LICENSE	2017-08-07 16:05:08.446223376 +0100
@@ -364,4 +364,4 @@
 INCLUDING WITHOUT LIMITATION, ANY WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE, QUIET ENJOYMENT OR NON-INFRINGEMENT.
 Please see the License for the specific language governing rights and
-limitations under the License."
+limitations under the License." 
