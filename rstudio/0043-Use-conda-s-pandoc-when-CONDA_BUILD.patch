From 423bfe16388d6dc73fa345083ef34d7f6597dfcc Mon Sep 17 00:00:00 2001
From: Ray Donnelly <mingw.android@gmail.com>
Date: Sat, 4 Feb 2017 13:29:12 -0500
Subject: [PATCH] Use conda's pandoc when CONDA_BUILD

---
 src/cpp/session/CMakeLists.txt     | 2 +-
 src/cpp/session/SessionOptions.cpp | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/cpp/session/CMakeLists.txt b/src/cpp/session/CMakeLists.txt
index d446bc9..0ebb392 100644
--- a/src/cpp/session/CMakeLists.txt
+++ b/src/cpp/session/CMakeLists.txt
@@ -25,7 +25,7 @@ endif()
 if(NOT EXISTS "${RSTUDIO_DEPENDENCIES_DIR}/common/mathjax-26")
   message(FATAL_ERROR "Mathjax 2.6 not found (re-run install-dependencies script to install)")
 endif()
-if(NOT EXISTS "${RSTUDIO_DEPENDENCIES_DIR}/common/pandoc")
+if(NOT DEFINED ENV{CONDA_BUILD} AND NOT EXISTS "${RSTUDIO_DEPENDENCIES_DIR}/common/pandoc")
   message(FATAL_ERROR "pandoc not found (re-run install-dependencies script to install)")
 endif()
 
diff --git a/src/cpp/session/SessionOptions.cpp b/src/cpp/session/SessionOptions.cpp
index 0a772b9..828aed3 100644
--- a/src/cpp/session/SessionOptions.cpp
+++ b/src/cpp/session/SessionOptions.cpp
@@ -72,7 +72,7 @@ const char* const kDefaultMsysSshPath = "bin/msys-ssh-1000-18";
 // resources directory so this gets us to prefix/bin
 // For gnudiff, gnugrep and msysssh we use conda's
 // m2w64-diffutils, m2w64-grep and m2-openssh respectively.
-const char* const kDefaultPandocPath = "../../bin/pandoc";
+const char* const kDefaultPandocPath = "../../bin";
 const char* const kDefaultPostbackPath = "../../bin/rpostback";
 const char* const kDefaultDiagnosticsPath = "../../bin/diagnostics";
 const char* const kDefaultConsoleIoPath = "../../bin/consoleio";
-- 
1.8.2.3

